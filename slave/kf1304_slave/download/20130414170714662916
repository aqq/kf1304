
url:bbs.csdn.net/topics/1196
HTTP/1.1 200 OK
Content-Type: text/html; charset=utf-8
Transfer-Encoding: chunked
Connection: close
Vary: Accept-Encoding
Status: 200
X-Powered-By: Phusion Passenger (mod_rails/mod_rack)
ETag: "2633fb2b9026acf505aad1d40a2a0793"
Cache-Control: max-age=0, private, must-revalidate
Set-Cookie: _csdn_newbbs_session=BAh7B0kiD3Nlc3Npb25faWQGOgZFRkkiJTIzYWNkNmM5YzE5OWUxOTZhN2Y5MTJiNDIwNjE3ODM3BjsAVEkiEF9jc3JmX3Rva2VuBjsARkkiMVc2VnVkcW1wOGdVWVRXWlJFMUZoM2lDbjVjeExoOHJ2QXQzRENDMitFZ289BjsARg%3D%3D--658712615ca3a360b69266ef7ff84018ffeb4dd0; path=/; HttpOnly
Server: nginx/1.2.4 + Phusion Passenger (mod_rails/mod_rack)
X-UA-Compatible: IE=Edge,chrome=1

1e11
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>请注意:网络winsock控件实现数据传输的问题! - CSDN论坛 - CSDN.NET</title>
    <link href="/assets/main-c65d6b72001ff03e3698df226a4e4ffe.css" media="screen" rel="stylesheet" type="text/css" />
    <script src="/assets/application-e72cd54f9ebb368ac82561934f7b9c72.js" type="text/javascript"></script>
    <meta content="authenticity_token" name="csrf-param" />
<meta content="W6Vudqmp8gUYTWZRE1Fh3iCn5cxLh8rvAt3DCC2+Ego=" name="csrf-token" />
    <link href="http://csdnimg.cn/www/images/favicon.ico" rel="SHORTCUT ICON">

      <link href="/assets/sh-2bfcf65754f6d04d58df6ed87a3b6faf.css" media="all" rel="stylesheet" type="text/css" />
  <script src="/assets/sh-d778121d099d6e5ed8bb7ce42824a371.js" type="text/javascript"></script>
  <script src="http://passport.csdn.net/content/loginbox/login.js" type="text/javascript"></script>

  </head>
  <body>
    <div class="wraper">
      <script type="text/javascript" src="http://csdnimg.cn/pubnav/js/pub_topnav_2011.js"></script>

        <!-- 页顶通栏 -->
  <iframe id="Topic_Top" marginwidth="0" marginheight="0" frameborder="0" scrolling="no" width="100%" src="/sda/TopicPageTop.htm"></iframe>

      <div id="nav">
        <a href="/" class="logo" target="_top"></a>
        <div class="nav_list">
          <a href="/home" title="CSDN论坛首页" class="home">首页</a><a href="/help" class=""><span>论坛帮助</span></a><a href="/rank" class=""><span>论坛牛人</span></a><a href="/map" class=""><span>论坛地图</span></a>
        </div>

        <div class="nav_sear">
          <form action="http://so.csdn.net/search" target="_blank">
            <input name="t" type="hidden" value="thread" />
            <input name="q" type="text" />
          </form>
        </div>
      </div>
      <!--[if IE]>
<style type="text/css" media="screen">
.control_area .control .drop_menu{border:3px solid #ccc \9; _*border:3px solid #ccc;}
</style>
<![endif]-->

  <!-- 页顶Button (D3) -->
  <iframe id="frm_tt1" marginwidth="0" marginheight="0" frameborder="0" scrolling="no" width="100%" src="/sda/TopicBodyTop.htm?v=1"></iframe>
  <script type="text/javascript">
    setTimeout(function () { document.getElementById("frm_tt1").src = "/sda/TopicBodyTop.htm?v="+new Date().getTime(); }, 5000);
  </script>

<div class="bread_nav">
  <a href="http://www.csdn.net" target="_blank">CSDN</a> <em>&gt;</em>
  <a href="/" target="_blank">CSDN论坛</a> <em>&gt;</em>
    <a href="/forums/VB" target="_blank">VB</a> <em>&gt;</em>
  <a href="/forums/VB_Controls" target="_blank">控件</a>
</div>

<div class="flash_messages">
</div>


<div class="control_area">
  <form name="form" id="form">
    
    <div class="control">
      <ul>
        <li class="drop_menu_wrap drop_menu_down"><a href="#" class="drop_toggle btn_1"><span><img src="/assets/ico_set.gif" alt="" />管理菜单<img src="/assets/arrow_down.gif" alt="" /></span></a>
        <ul class="drop_menu" style="display: none; top:26px;">
            <li><a href="/topics/1196/top" class="fancybox" rel="nofollow">置顶</a></li>

  <li><a href="/topics/1196/recommend" data-confirm="确定要将该帖推荐(加精)吗？被推荐的帖子将给帖主奖励可用分88分!" data-method="put" rel="nofollow">推荐</a></li>

  <li><a href="/topics/1196/lock" class="fancybox" rel="nofollow">锁定</a></li>

<li><a href="/topics/1196/move" class="fancybox" rel="nofollow">移动</a></li>
<li><a href="/topics/1196/edit" class="fancybox" rel="nofollow">编辑</a></li>
<li><a href="/topics/1196/destroy_edit" class="fancybox" rel="nofollow">删除</a></li>
<li><a href="/topics/1196/add_point" class="fancybox" rel="nofollow">帖子加分</a></li>
  <li><a href="/topics/1196/highlight" class="fancybox" rel="nofollow">帖子高亮</a></li>

        </ul>
        </li>
        <li><a href="/topics/1196/close" class="btn_1" rel='nofollow'><span><img src="/assets/ico_over.gif" alt="" />结帖</span></a></li>
        <li><a href="/topics/new?forum_id=VB_Controls" class="btn_1"><span><img src="/assets/ico_publish.gif" alt="" />发帖</span></a></li>
        <li><a href="#new_post" class="btn_1"><span><img src="/assets/ico_return.gif" alt="" />回复</span></a></li>
      </ul>
    </div>
  </form>
</div>
<div class="detail_title">
  <h1>
      请注意:网络winsock控件实现数据传输的问题!
    <span>
      [问题点数：0分]
    </span>
  </h1>
  <div class="fr">
    <select name="filter_posts">
      <option value="default">不显示删除回复</option>
      <option value="all">显示所有回复</option>
      <option value="star">显示星级回复</option>
      <option value="pointed">显示得分回复</option>
      <option value="lz">只显示楼主</option>
    </select>
    <a href="http://my.csdn.net/my/favorite/miniadd?u=http://bbs.csdn.net/topics/1196&amp;t=%E8%AF%B7%E6%B3%A8%E6%84%8F:%E7%BD%91%E7%BB%9Cwinsock%E6%8E%A7%E4%BB%B6%E5%AE%9E%E7%8E%B0%E6%95%B0%E6%8D%AE%E4%BC%A0%E8%BE%93%E7%9A%84%E9%97%AE%E9%A2%98!" id="fav" class="fav" rel='nofollow'><img src="/assets/nolines_plus.gif" alt="" />收藏</a>
  </div>
</div>
<div class="detailed">
    <table border="0" cellspacing="0" cellpadding="0" id="post-1196" class="post topic " data-post-id="1196" data-is-topic-locked="false">
  <colgroup><col width="180" /><col /></colgroup>
  <tr>
      <td rowspan="2" valign="top" class="wirter">
                <dl class="user_info ">
          <dt class="user_head" data-username="shlp">
            <a href="http://my.csdn.net/shlp" target="_blank"><img alt="shlp" class="avatar" src="http://avatar.profile.csdn.net/1/3/3/1_shlp.jpg" /></a>
          </dt>
          <dd class="username">
            <a href="http://my.csdn.net/shlp" target="_blank">shlp</a>
            
          </dd>
          <dd class="nickname">
            <span class="name2nick">shlp</span>
          </dd>
          <dd title="总技术分：0；总技术排名：525272">等级：<img alt="Blank" class="grade user1" src="/assets/blank.gif" /></dd>
          <dd class="close_rate" title="用户结帖率：100%
总发帖：8
正常结帖：8
未结帖：0">结帖率：100%</dd>
          
        </dl>

      </td>
      <td valign="top" class="post_info topic" data-username="shlp" data-floor="">
                <div class="data">
            <strong class="fr">
              楼主
            </strong>
          <span class="time">
              发表于：
            2000-02-01 12:02:00
          </span>
        </div>
        <div class="post_body">
            我想通过Winsock控件,在服务机与客户机之间传递文件,不知用什么方法实现.<br />
Winsock控件的SendDate和GetDate方法只能支持发送接受字符串和字节数组.<br />
不知各位有什么见解,但说无妨.<br />
<br />
<br />

              <div class="tag ">
              </div>
        </div>
          <!-- 主帖下Banner (D4) -->
          <!-- 主帖下文字 (D5) -->
          <iframe id="tad2" marginwidth="0" marginheight="0" frameborder="0" scrolling="no" width="100%" src="/sda/TopicBodyBottom.htm"></iframe>

      </td>
    </tr>
    <tr>
      <td valign="bottom">
          <div class="control">
  <div class="fr">
    <a href="/posts/1196/digg?topic_id=1196" class="red digg" data-method="put" data-remote="true" rel="nofollow">对我有用[0]</a>
    <a href="/posts/1196/bury?topic_id=1196" class="bury" data-method="put" data-remote="true" rel="nofollow">丢个板砖[0]</a>
    <a href="
2000
#quote" class="quote">引用</a> |
    <a href="/posts/1196/report?topic_id=1196" class="fancybox red" rel="nofollow">举报 </a> |
    <span class="manage-toggle">
      <div class="manage" style="display: none;">
          <a href="/topics/1196/edit" class="fancybox" rel="nofollow">编辑</a>
          <a href="/topics/1196/destroy_edit" class="fancybox" rel="nofollow">删除</a>
      </div>
      管理
    </span>
  </div>
    <span class="return_time">回复次数：9</span>
</div>

      </td>
  </tr>
</table>

  <table border="0" cellspacing="0" cellpadding="0" id="post-493842" class="post  " data-post-id="493842" data-is-topic-locked="false">
  <colgroup><col width="180" /><col /></colgroup>
  <tr>
      <td rowspan="2" valign="top" class="wirter">
                <dl class="user_info ">
          <dt class="user_head" data-username="littletao">
            <a href="http://my.csdn.net/littletao" target="_blank"><img alt="littletao" class="avatar" src="http://avatar.profile.csdn.net/0/7/C/1_littletao.jpg" /></a>
          </dt>
          <dd class="username">
            <a href="http://my.csdn.net/littletao" target="_blank">littletao</a>
            
          </dd>
          <dd class="nickname">
            <span class="name2nick">littletao</span>
          </dd>
          <dd title="总技术分：1669；总技术排名：17148">等级：<img alt="Blank" class="grade user3" src="/assets/blank.gif" /></dd>
          <dd class="close_rate" title="用户结帖率：100%
总发帖：9
正常结帖：9
未结帖：0">结帖率：100%</dd>
          
        </dl>

      </td>
      <td valign="top" class="post_info " data-username="littletao" data-floor="1">
                <div class="data">
            <span class="fr">
              <a href="#post-493842">#1</a>
              得分：0
            </span>
          <span class="time">
              回复于：
            2000-02-01 12:11:00
          </span>
        </div>
        <div class="post_body">
            读取2进制文件后放在字节数组里不就可以了？<br />

        </div>

      </td>
    </tr>
    <tr>
      <td valign="bottom">
          <div class="control">
    <div id='post-forum-bulletin-1'  class='fl'>
    </div>
  <div class="fr">
    <a href="/posts/493842/digg?topic_id=1196" class="red digg" data-method="put" data-remote="true" rel="nofollow">对我有用[0]</a>
    <a href="/posts/493842/bury?topic_id=1196" class="bury" data-method="put" data-remote="true" rel="nofollow">丢个板砖[0]</a>
    <a href="#quote" class="quote">引用</a> |
    <a href="/posts/493842/report?topic_id=1196" class="fancybox red" rel="nofollow">举报 </a> |
    <span class="manage-toggle">
      <div class="manage" style="display: none;">
          <a href="/posts/493842/edit" class="fancybox" rel="nofollow">编辑</a>
          <a href="/posts/493842/destroy_edit" class="fancybox" rel="nofollow">删除</a>
      </div>
      管理
    </span>
  </div>
</div>

      </td>
  </tr>
</table>
<table border="0" cellspacing="0" cellpadding="0" id="post-493877" class="post  " data-post-id="493877" data-is-topic-locked="false">
  <colgroup><col width="180" /><col /></colgroup>
  <tr>
      <td rowspan="2" valign="top" class="wirter">
                <dl class="user_info ">
          <dt class="user_head" data-username="zm">
            <a href="http://my.csdn.net/zm" target="_blank"><img alt="zm" class="avatar" src="http://avatar.profile.csdn.net/D/9/C/1_zm.jpg" /></a>
          </dt>
          <dd class="username">
            <a href="http://my.csdn.net/zm" target="_blank">zm</a>
            
          </dd>
          <dd class="nickname">
            <span class="name2nick">zm</span>
          </dd>
          <dd title="总技术分：354；总技术排名：57067">等级：<img alt="Blank" class="grade user2" src="/assets/blank.gif" /></dd>
          <dd class="close_rate" title="用户结帖率：100%
总发帖：1
正常结帖：1
未结帖：0">结帖率：100%</dd>
          
        </dl>

      </td>
      <td valign="top" class="post_info " data-username="zm" data-floor="2">
                <div class="data">
            <span class="fr">
              <a href="#post-493877">#2</a>
              得分：0
            </span>
          <span class="time">
              回复于：
            2000-02-01 15:09:00
          </span>
        </div>
        <div class="post_body">
            我当时也遇到过这种问题，我就是用了lilltetao的方法，将文件先以二进制方式打开，然后Read到一个数组，再用senddata发送，getdata接收后再write到一个二进制文件中，但是用此方法传送一个位图文件后不成功，文件头有错误（好象与空格有关系）。我觉的此种方法在理论上是可行的，多调试几次应该能成功
        </div>

      </td>
    </tr>
    <tr>
      <td valign="bottom">
          <div class="control">
    <div id='post-forum-bulletin-2'  class='fl'>
    </div>
  <div class="fr">
    <a href="/posts/493877/digg?topic_id=1196" class="red digg" data-method="put" data-remote="true" rel="nofollow">对我有用[0]</a>
    <a href="/posts/493877/bury?topic_id=1196" class="bury" data-method="put" data-remote="true" rel="nofollow">丢个板砖[0]</a>
    <a href="#quote" class="quote">引用</a> |
    <a href="/posts/493877/report?topic_id=1196" class="fancybox red" rel="nofollow">举报 </a> |
    <span class="manage-toggle">
      <div class="manage" style="display: none;">
          <a href="/posts/493877/edit" class="fancybox" rel="nofollow">编辑</a>
          <a href="/posts/493877/destroy_edit" class="fancybox" rel="nofollow">删除</a>
      </div>
      管理
    </span>
  </div>
</div>

      </td>
  </tr>
</table>
<table border="0" cellspacing="0" cellpadding="0" id="post-494135" class="post  " data-post-id="494135" data-is-topic-locked="false">
  <colgroup><col width="180" /><col /></colgroup>
  <tr>
      <td rowspan="2" valign="top" class="wirter">
                <dl class="user_info ">
          <dt class="user_head" data-username="starmoon">
            <a href="http://my.csdn.net/starmoon" target="_blank"><img alt="starmoon" class="avatar" src="http://avatar.profile.csdn.net/1/E/8/1_starmoon.jpg" /></a>
          </dt>
          <dd class="username">
            <a href="http://my.csdn.net/starmoon" target="_blank">starmoon</a>
            
          </dd>
          <dd class="nickname">
            <span class="name2nick">starmoon</span>
          </dd>
          <dd title="总技术分：409；总技术排名：51565">等级：<img alt="Blank" class="grade user1" src="/assets/blank.gif" /></dd>
          <dd class="close_rate" title="用户结帖率：100%
总发帖：22
正常结帖：22
未结帖：0">结帖率：100%</dd>
          
        </dl>

      </td>
      <td valign="top" class="post_info " data-username="starmoon" data-floor="3">
                <div class="data">
            <span class="fr">
              <a href="#post-494135">#3</a>
              得分：0
            </span>
          <span class="time">
              回复于：
            2000-02-03 09:10:00
          </span>
        </div>
        <div class="post_body">
            littletao&nbsp;is&nbsp;right,
        </div>

      </td>
    </tr>
    <tr>
      <td valign="bottom">
          <div class="control">
    <div id='post-forum-bulletin-3'  class='fl'>
    </div>
  <div class="fr">
    <a href="/posts/494135/digg?topic_id=1196" class="red digg" data-method="put" data-remote="true" rel="nofollow">对我有用[0]</a>
    <a href="/posts/494135/bury?topic_id=1196" class="bury" data-method="put" data-remote="true" rel="nofollow">丢个板砖[0]</a>
    <a href="#quote" class="quote">引用</a> |
    <a href="/posts/494135/report?topic_id=1196" class="fancybox red" rel="nofollow">举报 </a> |
    <span class="manage-toggle">
      <div class="manage" style="display: none;">
          <a href="/posts/494135/edit" class="fancybox" rel="nofollow">编辑</a>
          <a href="/posts/494135/destroy_edit" class="fancybox" rel="nofollow">删除</a>
      </div>
      管理
    <
2000
/span>
  </div>
</div>

      </td>
  </tr>
</table>
<table border="0" cellspacing="0" cellpadding="0" id="post-494234" class="post  " data-post-id="494234" data-is-topic-locked="false">
  <colgroup><col width="180" /><col /></colgroup>
  <tr>
      <td rowspan="2" valign="top" class="wirter">
                <dl class="user_info ">
          <dt class="user_head" data-username="crystal">
            <a href="http://my.csdn.net/crystal" target="_blank"><img alt="crystal" class="avatar" src="http://avatar.profile.csdn.net/C/C/9/1_crystal.jpg" /></a>
          </dt>
          <dd class="username">
            <a href="http://my.csdn.net/crystal" target="_blank">crystal</a>
            
          </dd>
          <dd class="nickname">
            <span class="name2nick">crystal</span>
          </dd>
          <dd title="总技术分：0；总技术排名：1876184">等级：<img alt="Blank" class="grade user1" src="/assets/blank.gif" /></dd>
          <dd class="close_rate" title="用户结帖率：100%
总发帖：8
正常结帖：8
未结帖：0">结帖率：100%</dd>
          
        </dl>

      </td>
      <td valign="top" class="post_info " data-username="crystal" data-floor="4">
                <div class="data">
            <span class="fr">
              <a href="#post-494234">#4</a>
              得分：0
            </span>
          <span class="time">
              回复于：
            2000-02-04 00:52:00
          </span>
        </div>
        <div class="post_body">
            也许你应该先定义要发送字符数组的大小：首先用filelen函数确定要发送文件大小，<br />
然后用redim重新定义字符数组的大小，ok。
        </div>

      </td>
    </tr>
    <tr>
      <td valign="bottom">
          <div class="control">
    <div id='post-forum-bulletin-4'  class='fl'>
    </div>
  <div class="fr">
    <a href="/posts/494234/digg?topic_id=1196" class="red digg" data-method="put" data-remote="true" rel="nofollow">对我有用[0]</a>
    <a href="/posts/494234/bury?topic_id=1196" class="bury" data-method="put" data-remote="true" rel="nofollow">丢个板砖[0]</a>
    <a href="#quote" class="quote">引用</a> |
    <a href="/posts/494234/report?topic_id=1196" class="fancybox red" rel="nofollow">举报 </a> |
    <span class="manage-toggle">
      <div class="manage" style="display: none;">
          <a href="/posts/494234/edit" class="fancybox" rel="nofollow">编辑</a>
          <a href="/posts/494234/destroy_edit" class="fancybox" rel="nofollow">删除</a>
      </div>
      管理
    </span>
  </div>
</div>

      </td>
  </tr>
</table>
<table border="0" cellspacing="0" cellpadding="0" id="post-494255" class="post  " data-post-id="494255" data-is-topic-locked="false">
  <colgroup><col width="180" /><col /></colgroup>
  <tr>
      <td rowspan="2" valign="top" class="wirter">
                <dl class="user_info ">
          <dt class="user_head" data-username="Firing_Sky">
            <a href="http://my.csdn.net/Firing_Sky" target="_blank"><img alt="Firing_Sky" class="avatar" src="http://avatar.profile.csdn.net/2/3/A/1_firing_sky.jpg" /></a>
          </dt>
          <dd class="username">
            <a href="http://my.csdn.net/Firing_Sky" target="_blank">Firing_Sky</a>
            
          </dd>
          <dd class="nickname">
            <span class="name2nick">Firing_Sky</span>
          </dd>
          <dd title="总技术分：7199；总技术排名：4058">等级：<img alt="Blank" class="grade user4" src="/assets/blank.gif" /></dd>
          <dd class="close_rate" title="用户结帖率：98.82%
总发帖：85
正常结帖：84
未结帖：1">结帖率：98.82%</dd>
          <div class="medal_silver " title="2000年2月 总版技术专家分月排行榜第二"></div><div class="medal_yellow " title="2000年2月 VB大版内专家分月排行榜第二"></div><div class="medal_blue " title="2000年2月 Delphi大版内专家分月排行榜第三"></div>
        </dl>

      </td>
      <td valign="top" class="post_info " data-username="Firing_Sky" data-floor="5">
                <div class="data">
            <span class="fr">
              <a href="#post-494255">#5</a>
              得分：0
            </span>
          <span class="time">
              回复于：
            2000-02-04 13:15:00
          </span>
        </div>
        <div class="post_body">
            只要允许字节数组，还有什么不能干的？
        </div>

      </td>
    </tr>
    <tr>
      <td valign="bottom">
          <div class="control">
    <div id='post-forum-bulletin-5'  class='fl'>
    </div>
  <div class="fr">
    <a href="/posts/494255/digg?topic_id=1196" class="red digg" data-method="put" data-remote="true" rel="nofollow">对我有用[0]</a>
    <a href="/posts/494255/bury?topic_id=1196" class="bury" data-method="put" data-remote="true" rel="nofollow">丢个板砖[0]</a>
    <a href="#quote" class="quote">引用</a> |
    <a href="/posts/494255/report?topic_id=1196" class="fancybox red" rel="nofollow">举报 </a> |
    <span class="manage-toggle">
      <div class="manage" style="display: none;">
          <a href="/posts/494255/edit" class="fancybox" rel="nofollow">编辑</a>
          <a href="/posts/494255/destroy_edit" class="fancybox" rel="nofollow">删除</a>
      </div>
      管理
    </span>
  </div>
</div>

      </td>
  </tr>
</table>
<table border="0" cellspacing="0" cellpadding="0" id="post-494289" class="post  " data-post-id="494289" data-is-topic-locked="false">
  <colgroup><col width="180" /><col /></colgroup>
  <tr>
      <td rowspan="2" valign="top" class="wirter">
                <dl class="user_info ">
          <dt class="user_head" data-username="insect">
            <a href="http://my.csdn.net/insect" target="_blank"><img alt="insect" class="avatar" src="http://avatar.profile.csdn.net/D/C/E/1_insect.jpg" /></a>
          </dt>
          <dd class="username">
            <a href="http://my.csdn.net/insect" target="_blank">insect</a>
            
          </dd>
          <dd class="nickname">
            <span class="name2nick">insect</span>
          </dd>
          <dd title="总技术分：148；总技术排名：99795">等级：<img alt="Blank" class="grade user1" src="/assets/blank.gif" /></dd>
          <dd class="close_rate" title="用户结帖率：95.83%
总发帖：48
正常结帖：46
未结帖：2">结帖率：95.83%</dd>
          
        </dl>

      </td>
      <td valign="top" class="post_info " data-username="insect" data-floor="6">
                <div class="data">
            <span class="fr">
              <a href="#post-494289">#6</a>
              得分：0
            </span>
          <span class="time">
              回复于：
            2000-02-05 10:58:00
          </span>
        </div>
        <div class="post_body">
            1月31日《计算机世界报》上有一篇文章，是delphi的，但可参考。
        </div>

      </td>
    </tr>
    <tr>
      <td valign="bottom">
          <div class="control">
    <div id='post-forum-bulletin-6'  class='fl'>
    </div>
  <div class="fr">
    <a href="/posts/494289/digg?topic_id=1196" class="red digg" data-method="put" data-remote="true" rel="nofollow">对我有用[0]</a>
    <a href="/posts/494289/bury?topic_id=1196" class="bury" data-method="put" data-remote="true" rel="nofollow">丢个板砖[0]</a>
    <a href="#quote" class="quote">引用</a> |
    <a href="/posts/494289/report?topic_id=1196" class="fancybox red" rel="nofollow">举报 </a> |
    <span class="manage-toggle">
      <div class="manage" style="display: none;">
          <a href="/posts/494289/edit" class="fancybox" rel="nofollow">编辑</a>
          <a href="/posts/494289/destroy_edit" class="fancybox" rel="nofollow">删除</a>
      </div>
      管理
    </span>
  </div>
</div>

      </td>
  </tr>
</table>
<table border="0" cellspacing="0" cellpadding="0" id="post-506421" class="post  " data-post-id="506421" data-is-topic-locked="false">
  <colgroup><col width="180" /><col /></colgroup>
  <tr>
      <td rowspan="2" valign="top" class="wirter">
                <dl class="user_info ">
        
2000
  <dt class="user_head" data-username="zhangdr">
            <a href="http://my.csdn.net/zhangdr" target="_blank"><img alt="zhangdr" class="avatar" src="http://avatar.profile.csdn.net/4/7/D/1_zhangdr.jpg" /></a>
          </dt>
          <dd class="username">
            <a href="http://my.csdn.net/zhangdr" target="_blank">zhangdr</a>
            
          </dd>
          <dd class="nickname">
            <span class="name2nick">zhangdr</span>
          </dd>
          <dd title="总技术分：109；总技术排名：119314">等级：<img alt="Blank" class="grade user2" src="/assets/blank.gif" /></dd>
          <dd class="close_rate" title="用户结帖率：100%
总发帖：4
正常结帖：4
未结帖：0">结帖率：100%</dd>
          
        </dl>

      </td>
      <td valign="top" class="post_info " data-username="zhangdr" data-floor="7">
                <div class="data">
            <span class="fr">
              <a href="#post-506421">#7</a>
              得分：0
            </span>
          <span class="time">
              回复于：
            2000-03-17 13:23:00
          </span>
        </div>
        <div class="post_body">
            PutFile&nbsp;用来传送文件，数据流的格式是：第一个字节代表传送的是文件（因为在我的程序中我还要传送确认，用这个字节以示区分）；第二个字节代表文件名长度，以后是文件名、数据块长度、数据块。<br />
Dim&nbsp;bRecieved&nbsp;As&nbsp;Boolean<br />
Private&nbsp;Sub&nbsp;tcpServer_DataArrival(Index&nbsp;As&nbsp;Integer,&nbsp;ByVal&nbsp;bytesTotal&nbsp;As&nbsp;Long)<br />
&nbsp;&nbsp;&nbsp;&nbsp;Dim&nbsp;byteData()&nbsp;As&nbsp;Byte,&nbsp;rsResult&nbsp;As&nbsp;ADODB.Recordset<br />
&nbsp;&nbsp;&nbsp;&nbsp;<br />
&nbsp;&nbsp;&nbsp;&nbsp;If&nbsp;bytesTotal&nbsp;&gt;&nbsp;0&nbsp;Then<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ReDim&nbsp;byteData(bytesTotal&nbsp;-&nbsp;1)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tcpServer(Index).GetData&nbsp;byteData,&nbsp;vbByte&nbsp;+&nbsp;vbArray<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Select&nbsp;Case&nbsp;byteData(0)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Case&nbsp;0<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bRecieved&nbsp;=&nbsp;True<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Case&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SaveFile&nbsp;byteData<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tcpServer(Index).SendData&nbsp;CByte(0)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;End&nbsp;Select<br />
&nbsp;&nbsp;&nbsp;&nbsp;End&nbsp;If<br />
End&nbsp;Sub<br />
Private&nbsp;Sub&nbsp;PutFile(objSendSock&nbsp;As&nbsp;Winsock,&nbsp;sFileName&nbsp;As&nbsp;String)<br />
&nbsp;&nbsp;&nbsp;&nbsp;Dim&nbsp;iThisFile&nbsp;As&nbsp;Integer,&nbsp;byteData()&nbsp;As&nbsp;Byte<br />
&nbsp;&nbsp;&nbsp;&nbsp;Dim&nbsp;i&nbsp;As&nbsp;Long,&nbsp;j&nbsp;As&nbsp;Long,&nbsp;byteBuffer()&nbsp;As&nbsp;Byte<br />
&nbsp;&nbsp;&nbsp;&nbsp;Dim&nbsp;iBlockCount&nbsp;As&nbsp;Integer,&nbsp;lDivValue&nbsp;As&nbsp;Long<br />
&nbsp;&nbsp;&nbsp;&nbsp;<br />
'&nbsp;&nbsp;&nbsp;&nbsp;On&nbsp;Error&nbsp;GoTo&nbsp;errPutFile<br />
&nbsp;&nbsp;&nbsp;&nbsp;iThisFile&nbsp;=&nbsp;FreeFile<br />
&nbsp;&nbsp;&nbsp;&nbsp;Open&nbsp;sFileName&nbsp;For&nbsp;Binary&nbsp;As&nbsp;#iThisFile<br />
&nbsp;&nbsp;&nbsp;&nbsp;ReDim&nbsp;byteData(Len(sFileName)&nbsp;+&nbsp;3)<br />
&nbsp;&nbsp;&nbsp;&nbsp;byteData(0)&nbsp;=&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;byteData(1)&nbsp;=&nbsp;CByte(Len(sFileName))<br />
&nbsp;&nbsp;&nbsp;&nbsp;For&nbsp;j&nbsp;=&nbsp;1&nbsp;To&nbsp;Len(sFileName)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;byteData(j&nbsp;+&nbsp;1)&nbsp;=&nbsp;CByte(Asc(Mid(sFileName,&nbsp;j,&nbsp;1)))<br />
&nbsp;&nbsp;&nbsp;&nbsp;Next<br />
&nbsp;&nbsp;&nbsp;&nbsp;iBlockCount&nbsp;=&nbsp;LOF(iThisFile)&nbsp;\&nbsp;BufferSize<br />
&nbsp;&nbsp;&nbsp;&nbsp;For&nbsp;i&nbsp;=&nbsp;0&nbsp;To&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;byteData(i&nbsp;+&nbsp;2&nbsp;+&nbsp;Len(sFileName))&nbsp;=&nbsp;CByte((iBlockCount&nbsp;\&nbsp;2&nbsp;^&nbsp;(i&nbsp;*&nbsp;8))&nbsp;And&nbsp;&amp;HFF)<br />
&nbsp;&nbsp;&nbsp;&nbsp;Next<br />
&nbsp;&nbsp;&nbsp;&nbsp;For&nbsp;i&nbsp;=&nbsp;1&nbsp;To&nbsp;iBlockCount<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ReDim&nbsp;Preserve&nbsp;byteData(BufferSize&nbsp;+&nbsp;10&nbsp;+&nbsp;Len(sFileName))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;For&nbsp;j&nbsp;=&nbsp;0&nbsp;To&nbsp;1&nbsp;'计算当前帧号<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;byteData(j&nbsp;+&nbsp;4&nbsp;+&nbsp;Len(sFileName))&nbsp;=&nbsp;CByte((i&nbsp;\&nbsp;2&nbsp;^&nbsp;(j&nbsp;*&nbsp;8))&nbsp;And&nbsp;&amp;HFF)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Next<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;For&nbsp;j&nbsp;=&nbsp;0&nbsp;To&nbsp;3&nbsp;'计算数据块长度<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;byteData(j&nbsp;+&nbsp;6&nbsp;+&nbsp;Len(sFileName))&nbsp;=&nbsp;CByte((BufferSize&nbsp;\&nbsp;2&nbsp;^&nbsp;(j&nbsp;*&nbsp;8))&nbsp;And&nbsp;&amp;HFF)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Next<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ReDim&nbsp;byteBuffer(BufferSize&nbsp;-&nbsp;1)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Get&nbsp;#iThisFile,&nbsp;,&nbsp;byteBuffer<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;For&nbsp;j&nbsp;=&nbsp;0&nbsp;To&nbsp;BufferSize&nbsp;-&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;byteData(j&nbsp;+&nbsp;10&nbsp;+&nbsp;Len(sFileName))&nbsp;=&nbsp;byteBuffer(j)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Next<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bRecieved&nbsp;=&nbsp;False<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;objSendSock.SendData&nbsp;byteData<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Do&nbsp;While&nbsp;Not&nbsp;bRecieved<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DoEvents<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Loop<br />
&nbsp;&nbsp;&nbsp;&nbsp;Next<br />
&nbsp;&nbsp;&nbsp;&nbsp;lDivValue&nbsp;=&nbsp;LOF(iThisFile)&nbsp;Mod&nbsp;BufferSize<br />
&nbsp;&nbsp;&nbsp;&nbsp;If&nbsp;lDivValue&nbsp;&lt;&gt;&nbsp;0&nbsp;Then<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ReDim&nbsp;Preserve&nbsp;byteData(lDivValue&nbsp;+&nbsp;10&nbsp;+&nbsp;Len(sFileName))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;For&nbsp;j&nbsp;=&nbsp;0&nbsp;To&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;byteData(j&nbsp;+&nbsp;4&nbsp;+&nbsp;Len(sFileName))&nbsp;=&nbsp;CByte((i&nbsp;\&nbsp;2&nbsp;^&nbsp;(j&nbsp;*&nbsp;8))&nbsp;And&nbsp;&amp;HFF)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Next<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;For&nbsp;j&nbsp;=&nbsp;0&nbsp;To&nbsp;3<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;byteData(j&nbsp;+&nbsp;6&nbsp;+&nbsp;Len(sFileName))&nbsp;=&nbsp;CByte((lDivValue&nbsp;\&nbsp;2&nbsp;^&nbsp;(j&nbsp;*&nbsp;8))&nbsp;And&nbsp;&amp;HFF)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Next<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ReDim&nbsp;byteBuffer(lDivValue&nbsp;-&nbsp;1)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Get&nbsp;#iThisFile,&nbsp;,&nbsp;byteBuffer<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;For&nbsp;j&nbsp;=&nbsp;0&nbsp;To&nbsp;lDivValue&nbsp;-&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;byteData(j&nbsp;+&nbsp;10&nbsp;+&nbsp;Len(sFileName))&nbsp;=&nbsp;byteBuffer(j)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Next<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bRecieved&nbsp;=&nbsp;False<br />
&nbsp;&nbsp;&nb
1000
sp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;objSendSock.SendData&nbsp;byteData<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Do&nbsp;While&nbsp;Not&nbsp;bRecieved<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DoEvents<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Loop<br />
&nbsp;&nbsp;&nbsp;&nbsp;End&nbsp;If<br />
&nbsp;&nbsp;&nbsp;&nbsp;Close&nbsp;#iThisFile<br />
&nbsp;&nbsp;&nbsp;&nbsp;Exit&nbsp;Sub<br />
errPutFile:<br />
&nbsp;&nbsp;&nbsp;&nbsp;Select&nbsp;Case&nbsp;Err.Number<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Case&nbsp;Else<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MsgBox&nbsp;Err.Number&nbsp;&amp;&nbsp;":"&nbsp;&amp;&nbsp;Err.Description,&nbsp;vbInformation,&nbsp;"PutFile&nbsp;错误提示"<br />
&nbsp;&nbsp;&nbsp;&nbsp;End&nbsp;Select<br />
End&nbsp;Sub<br />
<br />
Private&nbsp;Sub&nbsp;SaveFile(byteData()&nbsp;As&nbsp;Byte)<br />
&nbsp;&nbsp;&nbsp;&nbsp;Dim&nbsp;lSize&nbsp;As&nbsp;Long,&nbsp;i&nbsp;As&nbsp;Integer,&nbsp;strTemp&nbsp;As&nbsp;String<br />
&nbsp;&nbsp;&nbsp;&nbsp;Dim&nbsp;sFileName&nbsp;As&nbsp;String,&nbsp;byteBuffer()&nbsp;As&nbsp;Byte<br />
&nbsp;&nbsp;&nbsp;&nbsp;Dim&nbsp;iThisFile&nbsp;As&nbsp;Integer,&nbsp;lSoFarIn&nbsp;As&nbsp;Long<br />
&nbsp;&nbsp;&nbsp;&nbsp;Dim&nbsp;iDotPos&nbsp;As&nbsp;Integer<br />
&nbsp;&nbsp;&nbsp;&nbsp;Dim&nbsp;iBlockIndex&nbsp;As&nbsp;Integer,&nbsp;iBlockCount&nbsp;As&nbsp;Integer<br />
&nbsp;&nbsp;&nbsp;&nbsp;<br />
&nbsp;&nbsp;&nbsp;&nbsp;'On&nbsp;Error&nbsp;GoTo&nbsp;errSaveData<br />
&nbsp;&nbsp;&nbsp;&nbsp;sFileName&nbsp;=&nbsp;""<br />
&nbsp;&nbsp;&nbsp;&nbsp;For&nbsp;i&nbsp;=&nbsp;1&nbsp;To&nbsp;byteData(1)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sFileName&nbsp;=&nbsp;sFileName&nbsp;&amp;&nbsp;Chr(byteData(i&nbsp;+&nbsp;1))<br />
&nbsp;&nbsp;&nbsp;&nbsp;Next<br />
&nbsp;&nbsp;&nbsp;&nbsp;For&nbsp;i&nbsp;=&nbsp;0&nbsp;To&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;iBlockCount&nbsp;=&nbsp;iBlockCount&nbsp;+&nbsp;byteData(i&nbsp;+&nbsp;2&nbsp;+&nbsp;byteData(1))&nbsp;*&nbsp;2&nbsp;^&nbsp;(i&nbsp;*&nbsp;8)<br />
&nbsp;&nbsp;&nbsp;&nbsp;Next<br />
&nbsp;&nbsp;&nbsp;&nbsp;For&nbsp;i&nbsp;=&nbsp;0&nbsp;To&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;iBlockIndex&nbsp;=&nbsp;iBlockIndex&nbsp;+&nbsp;byteData(i&nbsp;+&nbsp;4&nbsp;+&nbsp;byteData(1))&nbsp;*&nbsp;2&nbsp;^&nbsp;(i&nbsp;*&nbsp;8)<br />
&nbsp;&nbsp;&nbsp;&nbsp;Next<br />
&nbsp;&nbsp;&nbsp;&nbsp;If&nbsp;iBlockIndex&nbsp;=&nbsp;1&nbsp;Then&nbsp;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;=&nbsp;0<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;strTemp&nbsp;=&nbsp;sFileName<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Do&nbsp;While&nbsp;Dir(strTemp)&nbsp;&lt;&gt;&nbsp;""<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;=&nbsp;i&nbsp;+&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;strTemp&nbsp;=&nbsp;sFileName<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;iDotPos&nbsp;=&nbsp;InStr(strTemp,&nbsp;".")<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;strTemp&nbsp;=&nbsp;Left(strTemp,&nbsp;iDotPos&nbsp;-&nbsp;1)&nbsp;&amp;&nbsp;"_"&nbsp;&amp;&nbsp;i&nbsp;&amp;&nbsp;Right(strTemp,&nbsp;Len(strTemp)&nbsp;-&nbsp;iDotPos&nbsp;+&nbsp;1)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Loop<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;If&nbsp;Dir(sFileName)&nbsp;&lt;&gt;&nbsp;""&nbsp;Then<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FileCopy&nbsp;sFileName,&nbsp;strTemp<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Kill&nbsp;sFileName<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;End&nbsp;If<br />
&nbsp;&nbsp;&nbsp;&nbsp;End&nbsp;If<br />
&nbsp;&nbsp;&nbsp;&nbsp;For&nbsp;i&nbsp;=&nbsp;0&nbsp;To&nbsp;3<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lSize&nbsp;=&nbsp;lSize&nbsp;+&nbsp;byteData(i&nbsp;+&nbsp;byteData(1)&nbsp;+
2000
&nbsp;6)&nbsp;*&nbsp;2&nbsp;^&nbsp;(i&nbsp;*&nbsp;8)<br />
&nbsp;&nbsp;&nbsp;&nbsp;Next<br />
&nbsp;&nbsp;&nbsp;&nbsp;ReDim&nbsp;byteBuffer(lSize&nbsp;-&nbsp;1)<br />
&nbsp;&nbsp;&nbsp;&nbsp;For&nbsp;i&nbsp;=&nbsp;0&nbsp;To&nbsp;lSize&nbsp;-&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;byteBuffer(i)&nbsp;=&nbsp;byteData(i&nbsp;+&nbsp;byteData(1)&nbsp;+&nbsp;10)<br />
&nbsp;&nbsp;&nbsp;&nbsp;Next<br />
&nbsp;&nbsp;&nbsp;&nbsp;iThisFile&nbsp;=&nbsp;FreeFile<br />
&nbsp;&nbsp;&nbsp;&nbsp;Open&nbsp;sFileName&nbsp;For&nbsp;Binary&nbsp;As&nbsp;iThisFile<br />
&nbsp;&nbsp;&nbsp;&nbsp;lSoFarIn&nbsp;=&nbsp;LOF(iThisFile)&nbsp;+&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;Put&nbsp;#iThisFile,&nbsp;lSoFarIn,&nbsp;byteBuffer<br />
&nbsp;&nbsp;&nbsp;&nbsp;Close&nbsp;#iThisFile<br />
&nbsp;&nbsp;&nbsp;&nbsp;Exit&nbsp;Sub<br />
errSaveData:<br />
&nbsp;&nbsp;&nbsp;&nbsp;Select&nbsp;Case&nbsp;Err.Number<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Case&nbsp;Else<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MsgBox&nbsp;Err.Number&nbsp;&amp;&nbsp;":"&nbsp;&amp;&nbsp;Err.Description,&nbsp;,&nbsp;"SaveFile&nbsp;错误提示"<br />
&nbsp;&nbsp;&nbsp;&nbsp;End&nbsp;Select<br />
End&nbsp;Sub
        </div>

      </td>
    </tr>
    <tr>
      <td valign="bottom">
          <div class="control">
    <div id='post-forum-bulletin-7'  class='fl'>
    </div>
  <div class="fr">
    <a href="/posts/506421/digg?topic_id=1196" class="red digg" data-method="put" data-remote="true" rel="nofollow">对我有用[0]</a>
    <a href="/posts/506421/bury?topic_id=1196" class="bury" data-method="put" data-remote="true" rel="nofollow">丢个板砖[0]</a>
    <a href="#quote" class="quote">引用</a> |
    <a href="/posts/506421/report?topic_id=1196" class="fancybox red" rel="nofollow">举报 </a> |
    <span class="manage-toggle">
      <div class="manage" style="display: none;">
          <a href="/posts/506421/edit" class="fancybox" rel="nofollow">编辑</a>
          <a href="/posts/506421/destroy_edit" class="fancybox" rel="nofollow">删除</a>
      </div>
      管理
    </span>
  </div>
</div>

      </td>
  </tr>
</table>
<table border="0" cellspacing="0" cellpadding="0" id="post-506422" class="post  " data-post-id="506422" data-is-topic-locked="false">
  <colgroup><col width="180" /><col /></colgroup>
  <tr>
      <td rowspan="2" valign="top" class="wirter">
                <dl class="user_info ">
          <dt class="user_head" data-username="zhangdr">
            <a href="http://my.csdn.net/zhangdr" target="_blank"><img alt="zhangdr" class="avatar" src="http://avatar.profile.csdn.net/4/7/D/1_zhangdr.jpg" /></a>
          </dt>
          <dd class="username">
            <a href="http://my.csdn.net/zhangdr" target="_blank">zhangdr</a>
            
          </dd>
          <dd class="nickname">
            <span class="name2nick">zhangdr</span>
          </dd>
          <dd title="总技术分：109；总技术排名：119314">等级：<img alt="Blank" class="grade user2" src="/assets/blank.gif" /></dd>
          <dd class="close_rate" title="用户结帖率：100%
总发帖：4
正常结帖：4
未结帖：0">结帖率：100%</dd>
          
        </dl>

      </td>
      <td valign="top" class="post_info " data-username="zhangdr" data-floor="8">
                <div class="data">
            <span class="fr">
              <a href="#post-506422">#8</a>
              得分：0
            </span>
          <span class="time">
              回复于：
            2000-03-17 13:27:00
          </span>
        </div>
        <div class="post_body">
            对不起，我忘了定义BufferSize了,BufferSize不能太大<br />
Const&nbsp;BufferSize&nbsp;=&nbsp;2&nbsp;*&nbsp;1024
        </div>

      </td>
    </tr>
    <tr>
      <td valign="bottom">
          <div class="control">
    <div id='post-forum-bulletin-8'  class='fl'>
    </div>
  <div class="fr">
    <a href="/posts/506422/digg?topic_id=1196" class="red digg" data-method="put" data-remote="true" rel="nofollow">对我有用[0]</a>
    <a href="/posts/506422/bury?topic_id=1196" class="bury" data-method="put" data-remote="true" rel="nofollow">丢个板砖[0]</a>
    <a href="#quote" class="quote">引用</a> |
    <a href="/posts/506422/report?topic_id=1196" class="fancybox red" rel="nofollow">举报 </a> |
    <span class="manage-toggle">
      <div class="manage" style="display: none;">
          <a href="/posts/506422/edit" class="fancybox" rel="nofollow">编辑</a>
          <a href="/posts/506422/destroy_edit" class="fancybox" rel="nofollow">删除</a>
      </div>
      管理
    </span>
  </div>
</div>

      </td>
  </tr>
</table>
<table border="0" cellspacing="0" cellpadding="0" id="post-507141" class="post  " data-post-id="507141" data-is-topic-locked="false">
  <colgroup><col width="180" /><col /></colgroup>
  <tr>
      <td rowspan="2" valign="top" class="wirter">
                <dl class="user_info ">
          <dt class="user_head" data-username="apollo">
            <a href="http://my.csdn.net/apollo" target="_blank"><img alt="apollo" class="avatar" src="http://avatar.profile.csdn.net/3/1/F/1_apollo.jpg" /></a>
          </dt>
          <dd class="username">
            <a href="http://my.csdn.net/apollo" target="_blank">apollo</a>
            
          </dd>
          <dd class="nickname">
            <span class="name2nick">apollo</span>
          </dd>
          <dd title="总技术分：748；总技术排名：33264">等级：<img alt="Blank" class="grade user3" src="/assets/blank.gif" /></dd>
          <dd class="close_rate" title="用户结帖率：100%
总发帖：18
正常结帖：18
未结帖：0">结帖率：100%</dd>
          
        </dl>

      </td>
      <td valign="top" class="post_info " data-username="apollo" data-floor="9">
                <div class="data">
            <span class="fr">
              <a href="#post-507141">#9</a>
              得分：0
            </span>
          <span class="time">
              回复于：
            2000-03-19 16:36:00
          </span>
        </div>
        <div class="post_body">
            关注..
        </div>

      </td>
    </tr>
    <tr>
      <td valign="bottom">
          <div class="control">
    <div id='post-forum-bulletin-9'  class='fl'>
    </div>
  <div class="fr">
    <a href="/posts/507141/digg?topic_id=1196" class="red digg" data-method="put" data-remote="true" rel="nofollow">对我有用[0]</a>
    <a href="/posts/507141/bury?topic_id=1196" class="bury" data-method="put" data-remote="true" rel="nofollow">丢个板砖[0]</a>
    <a href="#quote" class="quote">引用</a> |
    <a href="/posts/507141/report?topic_id=1196" class="fancybox red" rel="nofollow">举报 </a> |
    <span class="manage-toggle">
      <div class="manage" style="display: none;">
          <a href="/posts/507141/edit" class="fancybox" rel="nofollow">编辑</a>
          <a href="/posts/507141/destroy_edit" class="fancybox" rel="nofollow">删除</a>
      </div>
      管理
    </span>
  </div>
</div>

      </td>
  </tr>
</table>

</div>
<div class="control_area">
  <form name="form" id="form">
    
    <div class="control">
      <ul>
        <li class="drop_menu_wrap drop_menu_up"><a href="#" class="drop_toggle drop_toggle_up btn_1"><span><img src="/assets/ico_set.gif" alt="" />管理菜单<img src="/assets/arrow_down.gif" alt="" /></span></a>
        <ul class="drop_menu" style="display: none; bottom:26px;">
            <li><a href="/topics/1196/top" class="fancybox" rel="nofollow">置顶</a></li>

  <li><a href="/topics/1196/recommend" data-confirm="确定要将该帖推荐(加精)吗？被推荐的帖子将给帖主奖励可用分88分!" data-method="put" rel="nofollow">推荐</a></li>

  <li><a href="/topics/1196/lock" class="fancybox" rel="nofollow">锁定</a></li>

<li><a href="/topics/1196/move" class="fancybox" rel="nofollow">移动</a></li>
<li><a href="/topics/1196/edit" class="fancybox" rel="nofollow">编辑</a></li>
<li><a href="/topics/1196/destroy_edit" class="fancybox" rel="nofollow">删除</a></li>
<li><a href="/topics/1196/add_point" class="fancybox" rel="no
1000
follow">帖子加分</a></li>
  <li><a href="/topics/1196/highlight" class="fancybox" rel="nofollow">帖子高亮</a></li>

        </ul>
        </li>
        <li><a href="/topics/1196/close" class="btn_1"><span><img src="/assets/ico_over.gif" alt="" />结帖</span></a></li>
        <li><a href="/topics/new?forum_id=VB_Controls" class="btn_1"><span><img src="/assets/ico_publish.gif" alt="" />发帖</span></a></li>
        <li><a href="#new_post" class="btn_1"><span><img src="/assets/ico_return.gif" alt="" />回复</span></a></li>
      </ul>
    </div>
  </form>
</div>

<div class="comt">
  <div class="ad_l">
    <!-- 回复框文字 (D6) -->
    <ul><li><a href="http://g.csdn.net/5243760" target="_blank">【招】应届生,入职年薪5-10万</a></li><li><a href="http://g.csdn.net/5246043" target="_blank">市面上最出色的刀片式服务器</a></li><li><a href="http://g.csdn.net/5245460" target="_blank">IBM 以高效设计为灵魂</a></li><li><a href="http://g.csdn.net/5239181" target="_blank">首届携程大赛开始报名啦</a></li></ul>
    <ul>
        <li><a href="http://club.csdn.net/cmdn/bbs/topic/7282" class="title_style_black" target="_blank">台湾程序员游戏开发经历</a></li>
        <li><a href="http://g.csdn.net/5243630" class="title_style_black" target="_blank">陈勇- 敏捷开发现状及发展之路</a></li>
        <li><a href="http://bbs.csdn.net/topics/390399592" class="title_style_black" target="_blank">分享你的发现 赢下载积分</a></li>
    </ul>
    <div class="ad_new" style='padding: 0 0 50px 0'>
      <h4><img alt="" src="http://csdnimg.cn/www/images/csdn_logo_blue.gif"></h4>
      <p class='title'>
      <a href="http://bbs.csdn.net/topics/390397080" target="_blank">微软MVP申请</a>
      </p>
      <p class='con'>
      <a href="http://bbs.csdn.net/topics/390397080" target="_blank">CSDN与微软合作，长期为用户提供申请“微软最有价值专家”的平台，希望大家积极参与。</a>
      </p>
    </div>
  </div>
  <div class="reply">
      <h3>本帖子已过去太久远了，不再提供回复功能。</h3>
  </div>
</div>



<!-- 对联广告 -->
<div id="ad_left" style="position:absolute;width:120px;top:184px;left:10px;display:none">
  <a style="float:right;" href="#" onclick="javascript:this.parentNode.style.display='none';return false;">[关闭]</a>
  <iframe src="/sda/TopicDaLeft.htm?v201203051313" frameborder="0" height="600" width="120" scrolling="no"></iframe>
</div>
<div id="ad_right" style="position:absolute;width:120px;top:184px;right:10px;display:none">
  <a style="float:left;" href="#" onclick="javascript:this.parentNode.style.display='none';return false;">[关闭]</a>
  <iframe src="/sda/TopicDaRight.htm?v201203051313" frameborder="0" height="600" width="120" scrolling="no"></iframe>
</div>



      <script type="text/javascript" src="http://csdnimg.cn/pubfooter/js/publib_footer.js"></script>
<script type="text/javascript" src="http://www.csdn.net/ui/scripts/Csdn/counter.js"></script>
<script type="text/javascript" src="http://csdnimg.cn/pig/pubjs/cnick.js"></script>

      <img alt="Top_arrow" class="top_arrow" id="top_arrow" src="http://news.csdn.net//images/top_arrow.png" />
    </div>
    <script type="text/javascript" language="javascript" charset="utf-8">
//<![CDATA[
$(function(){
  topics_page_js.show_page();
    var bulletin_link = '<a href="http://blog.csdn.net/csdn_ask/article/details/8751993" class="title_style_blue title_style_bold" target="_blank">CSDN问答频道3月声望排行榜出炉</a>'
    $('#post-forum-bulletin-1').html(bulletin_link);
    var bulletin_link = '<a href="http://e.weibo.com/csdnsupport" class="title_style_red title_style_bold" target="_blank">欢迎关注CSDN产品客服微博</a>'
    $('#post-forum-bulletin-2').html(bulletin_link);
    var bulletin_link = '<a href="http://blog.csdn.net/blogdevteam/article/details/8770910" class="title_style_red title_style_bold" target="_blank">Java应用级产品开发平台APDPlat作者杨尚川专访</a>'
    $('#post-forum-bulletin-3').html(bulletin_link);

7b
});
//]]>
</script>
<script type="text/javascript" src="http://ad.csdn.net/scripts/ad-bbs.js"></script>

  </body>
</html>

0


url:bbs.csdn.net/topics/1197
HTTP/1.1 200 OK
Content-Type: text/html; charset=utf-8
Transfer-Encoding: chunked
Connection: close
Vary: Accept-Encoding
Status: 200
X-Powered-By: Phusion Passenger (mod_rails/mod_rack)
ETag: "cd7c4954a00188af11264eb0148fd26b"
Cache-Control: max-age=0, private, must-revalidate
Set-Cookie: _csdn_newbbs_session=BAh7B0kiD3Nlc3Npb25faWQGOgZFRkkiJTk3MWRhM2Y4MzJjMGY0NDU0OTIxNDhlYzNhMDdiOTY4BjsAVEkiEF9jc3JmX3Rva2VuBjsARkkiMW9ZZkpJV1hqUVBEcllIazhLUEtDRXB0T3c3VVlHZEI3eTRUaFNQUElxc2s9BjsARg%3D%3D--05e6bc4f144e000b566ab6c99cf6406e5e3ac2e8; path=/; HttpOnly
Server: nginx/1.2.4 + Phusion Passenger (mod_rails/mod_rack)
X-UA-Compatible: IE=Edge,chrome=1

1e11
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>文件操作的高手文件!请关注:文件的转换创建问题 - CSDN论坛 - CSDN.NET</title>
    <link href="/assets/main-c65d6b72001ff03e3698df226a4e4ffe.css" media="screen" rel="stylesheet" type="text/css" />
    <script src="/assets/application-e72cd54f9ebb368ac82561934f7b9c72.js" type="text/javascript"></script>
    <meta content="authenticity_token" name="csrf-param" />
<meta content="oYfJIWXjQPDrYHk8KPKCEptOw7UYGdB7y4ThSPPIqsk=" name="csrf-token" />
    <link href="http://csdnimg.cn/www/images/favicon.ico" rel="SHORTCUT ICON">

      <link href="/assets/sh-2bfcf65754f6d04d58df6ed87a3b6faf.css" media="all" rel="stylesheet" type="text/css" />
  <script src="/assets/sh-d778121d099d6e5ed8bb7ce42824a371.js" type="text/javascript"></script>
  <script src="http://passport.csdn.net/content/loginbox/login.js" type="text/javascript"></script>

  </head>
  <body>
    <div class="wraper">
      <script type="text/javascript" src="http://csdnimg.cn/pubnav/js/pub_topnav_2011.js"></script>

        <!-- 页顶通栏 -->
  <iframe id="Topic_Top" marginwidth="0" marginheight="0" frameborder="0" scrolling="no" width="100%" src="/sda/TopicPageTop.htm"></iframe>

      <div id="nav">
        <a href="/" class="logo" target="_top"></a>
        <div class="nav_list">
          <a href="/home" title="CSDN论坛首页" class="home">首页</a><a href="/help" class=""><span>论坛帮助</span></a><a href="/rank" class=""><span>论坛牛人</span></a><a href="/map" class=""><span>论坛地图</span></a>
        </div>

        <div class="nav_sear">
          <form action="http://so.csdn.net/search" target="_blank">
            <input name="t" type="hidden" value="thread" />
            <input name="q" type="text" />
          </form>
        </div>
      </div>
      <!--[if IE]>
<style type="text/css" media="screen">
.control_area .control .drop_menu{border:3px solid #ccc \9; _*border:3px solid #ccc;}
</style>
<![endif]-->

  <!-- 页顶Button (D3) -->
  <iframe id="frm_tt1" marginwidth="0" marginheight="0" frameborder="0" scrolling="no" width="100%" src="/sda/TopicBodyTop.htm?v=1"></iframe>
  <script type="text/javascript">
    setTimeout(function () { document.getElementById("frm_tt1").src = "/sda/TopicBodyTop.htm?v="+new Date().getTime(); }, 5000);
  </script>

<div class="bread_nav">
  <a href="http://www.csdn.net" target="_blank">CSDN</a> <em>&gt;</em>
  <a href="/" target="_blank">CSDN论坛</a> <em>&gt;</em>
    <a href="/forums/VB" target="_blank">VB</a> <em>&gt;</em>
  <a href="/forums/VB_Basic" target="_blank">基础类</a>
</div>

<div class="flash_messages">
</div>


<div class="control_area">
  <form name="form" id="form">
    
    <div class="control">
      <ul>
        <li class="drop_menu_wrap drop_menu_down"><a href="#" class="drop_toggle btn_1"><span><img src="/assets/ico_set.gif" alt="" />管理菜单<img src="/assets/arrow_down.gif" alt="" /></span></a>
        <ul class="drop_menu" style="display: none; top:26px;">
            <li><a href="/topics/1197/top" class="fancybox" rel="nofollow">置顶</a></li>

  <li><a href="/topics/1197/recommend" data-confirm="确定要将该帖推荐(加精)吗？被推荐的帖子将给帖主奖励可用分88分!" data-method="put" rel="nofollow">推荐</a></li>

  <li><a href="/topics/1197/lock" class="fancybox" rel="nofollow">锁定</a></li>

<li><a href="/topics/1197/move" class="fancybox" rel="nofollow">移动</a></li>
<li><a href="/topics/1197/edit" class="fancybox" rel="nofollow">编辑</a></li>
<li><a href="/topics/1197/destroy_edit" class="fancybox" rel="nofollow">删除</a></li>
<li><a href="/topics/1197/add_point" class="fancybox" rel="nofollow">帖子加分</a></li>
  <li><a href="/topics/1197/highlight" class="fancybox" rel="nofollow">帖子高亮</a></li>

        </ul>
        </li>
        <li><a href="/topics/1197/close" class="btn_1" rel='nofollow'><span><img src="/assets/ico_over.gif" alt="" />结帖</span></a></li>
        <li><a href="/topics/new?forum_id=VB_Basic" class="btn_1"><span><img src="/assets/ico_publish.gif" alt="" />发帖</span></a></li>
        <li><a href="#new_post" class="btn_1"><span><img src="/assets/ico_return.gif" alt="" />回复</span></a></li>
      </ul>
    </div>
  </form>
</div>
<div class="detail_title">
  <h1>
      文件操作的高手文件!请关注:文件的转换创建问题
    <span>
      [问题点数：50分，结帖人shlp]
    </span>
  </h1>
  <div class="fr">
    <select name="filter_posts">
      <option value="default">不显示删除回复</option>
      <option value="all">显示所有回复</option>
      <option value="star">显示星级回复</option>
      <option value="pointed">显示得分回复</option>
      <option value="lz">只显示楼主</option>
    </select>
    <a href="http://my.csdn.net/my/favorite/miniadd?u=http://bbs.csdn.net/topics/1197&amp;t=%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C%E7%9A%84%E9%AB%98%E6%89%8B%E6%96%87%E4%BB%B6!%E8%AF%B7%E5%85%B3%E6%B3%A8:%E6%96%87%E4%BB%B6%E7%9A%84%E8%BD%AC%E6%8D%A2%E5%88%9B%E5%BB%BA%E9%97%AE%E9%A2%98" id="fav" class="fav" rel='nofollow'><img src="/assets/nolines_plus.gif" alt="" />收藏</a>
  </div>
</div>
<div class="detailed">
    <table border="0" cellspacing="0" cellpadding="0" id="post-1197" class="post topic " data-post-id="1197" data-is-topic-locked="false">
  <colgroup><col width="180" /><col /></colgroup>
  <tr>
      <td rowspan="2" valign="top" class="wirter">
                <dl class="user_info ">
          <dt class="user_head" data-username="shlp">
            <a href="http://my.csdn.net/shlp" target="_blank"><img alt="shlp" class="avatar" src="http://avatar.profile.csdn.net/1/3/3/1_shlp.jpg" /></a>
          </dt>
          <dd class="username">
            <a href="http://my.csdn.net/shlp" target="_blank">shlp</a>
            
          </dd>
          <dd class="nickname">
            <span class="name2nick">shlp</span>
          </dd>
          <dd title="总技术分：0；总技术排名：525272">等级：<img alt="Blank" class="grade user1" src="/assets/blank.gif" /></dd>
          <dd class="close_rate" title="用户结帖率：100%
总发帖：8
正常结帖：8
未结帖：0">结帖率：100%</dd>
          
        </dl>

      </td>
      <td valign="top" class="post_info topic pointed" data-username="shlp" data-floor="">
                <div class="data">
            <strong class="fr">
              楼主
            </strong>
          <span class="time">
              发表于：
            2000-02-01 12:03:00
          </span>
        </div>
        <div class="post_body">
            能否将磁盘上的某个文件转换存储到"字节数组"类型变量中,<br />
再通过"字节数组"类型变量写到新创建的一个文件中.(要详细)<br />
<br />
<br />
50分呢!希望具体说明!&nbsp;&nbsp;&nbsp;		<br />
<br />
文件操作的高手文件!请关注:文件的转换创建问题
              <div class="tag ">
              </div>
        </div>
          <!-- 主帖下Banner (D4) -->
          <!-- 主帖下文字 (D5) -->
          <iframe id="tad2" marginwidth="0" marginheight="0" frameborder="0" scrolling="no" width="100%" src="/sda/TopicBodyBottom.htm"></iframe>

      </td>
    </tr>
    <tr>
      <td valign="bottom">
          <div class="control">
  <div class="fr">
    <a href="/posts/1197/digg?topic_id=1197" class="red digg" data-method="put" data-remote="true" rel="nofollow">对我有用[0]</a>
    <a href="/po
2000
sts/1197/bury?topic_id=1197" class="bury" data-method="put" data-remote="true" rel="nofollow">丢个板砖[0]</a>
    <a href="#quote" class="quote">引用</a> |
    <a href="/posts/1197/report?topic_id=1197" class="fancybox red" rel="nofollow">举报 </a> |
    <span class="manage-toggle">
      <div class="manage" style="display: none;">
          <a href="/topics/1197/edit" class="fancybox" rel="nofollow">编辑</a>
          <a href="/topics/1197/destroy_edit" class="fancybox" rel="nofollow">删除</a>
      </div>
      管理
    </span>
  </div>
    <span class="return_time">回复次数：2</span>
</div>

      </td>
  </tr>
</table>

  <table border="0" cellspacing="0" cellpadding="0" id="post-493865" class="post  " data-post-id="493865" data-is-topic-locked="false">
  <colgroup><col width="180" /><col /></colgroup>
  <tr>
      <td rowspan="2" valign="top" class="wirter">
                <dl class="user_info ">
          <dt class="user_head" data-username="929">
            <a href="http://my.csdn.net/929" target="_blank"><img alt="929" class="avatar" src="http://avatar.profile.csdn.net/0/D/0/1_929.jpg" /></a>
          </dt>
          <dd class="username">
            <a href="http://my.csdn.net/929" target="_blank">929</a>
            
          </dd>
          <dd class="nickname">
            <span class="name2nick">929</span>
          </dd>
          <dd title="总技术分：7526；总技术排名：3858">等级：<img alt="Blank" class="grade user3" src="/assets/blank.gif" /></dd>
          <dd class="close_rate" title="用户结帖率：100%
总发帖：2
正常结帖：2
未结帖：0">结帖率：100%</dd>
          <div class="medal_jinshi " title="2000年 总版技术专家分年内排行榜第七"></div><div class="medal_gold " title="2000年3月 总版技术专家分月排行榜第一"></div><div class="medal_copper " title="2000年4月 总版技术专家分月排行榜第三"></div><a href="/users/929/medals" class="more_medals" target="_blank">更多勋章</a>
        </dl>

      </td>
      <td valign="top" class="post_info pointed" data-username="929" data-floor="1">
                <div class="data">
            <span class="fr">
              <a href="#post-493865">#1</a>
              得分：10
            </span>
          <span class="time">
              回复于：
            2000-02-01 14:19:00
          </span>
        </div>
        <div class="post_body">
            我觉得你所提的问题很象WIN32平台上文件映射对象所能实现的功能。用文件映射对象可以将磁盘上的文件映射成一个视图，进程访问这个视图时，可以把它当做一段连续的内存区域，也就是说是一个字节数组。对这个数组可以用很多方法进行操作，比如说反转，改变某字节等。当然，也能很容易的把这个视图的内容写入另一文件中。<br />
与文件映射对象有关的函数有：<br />
CreateFileMapping<br />
FlushViewOfFile<br />
MapViewOfFile<br />
MapViewOfFileEx<br />
OpenFileMapping<br />
UnmapViewOfFile&nbsp;&nbsp;<br />
可以在WIN32的API帮助中找到。在VB中通过API&nbsp;VIEWER把相应API粘入，然后用它进行操作。
        </div>

      </td>
    </tr>
    <tr>
      <td valign="bottom">
          <div class="control">
    <div id='post-forum-bulletin-1'  class='fl'>
    </div>
  <div class="fr">
    <a href="/posts/493865/digg?topic_id=1197" class="red digg" data-method="put" data-remote="true" rel="nofollow">对我有用[0]</a>
    <a href="/posts/493865/bury?topic_id=1197" class="bury" data-method="put" data-remote="true" rel="nofollow">丢个板砖[0]</a>
    <a href="#quote" class="quote">引用</a> |
    <a href="/posts/493865/report?topic_id=1197" class="fancybox red" rel="nofollow">举报 </a> |
    <span class="manage-toggle">
      <div class="manage" style="display: none;">
          <a href="/posts/493865/edit" class="fancybox" rel="nofollow">编辑</a>
          <a href="/posts/493865/destroy_edit" class="fancybox" rel="nofollow">删除</a>
      </div>
      管理
    </span>
  </div>
</div>

      </td>
  </tr>
</table>
<table border="0" cellspacing="0" cellpadding="0" id="post-493952" class="post  " data-post-id="493952" data-is-topic-locked="false">
  <colgroup><col width="180" /><col /></colgroup>
  <tr>
      <td rowspan="2" valign="top" class="wirter">
                <dl class="user_info ">
          <dt class="user_head" data-username="freeboy">
            <a href="http://my.csdn.net/freeboy" target="_blank"><img alt="freeboy" class="avatar" src="http://avatar.profile.csdn.net/5/B/5/1_freeboy.jpg" /></a>
          </dt>
          <dd class="username">
            <a href="http://my.csdn.net/freeboy" target="_blank">freeboy</a>
            
          </dd>
          <dd class="nickname">
            <span class="name2nick">freeboy</span>
          </dd>
          <dd title="总技术分：1535；总技术排名：18496">等级：<img alt="Blank" class="grade user3" src="/assets/blank.gif" /></dd>
          <dd class="close_rate" title="用户结帖率：100%
总发帖：143
正常结帖：143
未结帖：0">结帖率：100%</dd>
          
        </dl>

      </td>
      <td valign="top" class="post_info pointed" data-username="freeboy" data-floor="2">
                <div class="data">
            <span class="fr">
              <a href="#post-493952">#2</a>
              得分：40
            </span>
          <span class="time">
              回复于：
            2000-02-01 22:49:00
          </span>
        </div>
        <div class="post_body">
            &nbsp;&nbsp;&nbsp;&nbsp;Dim&nbsp;DATA_SRC()&nbsp;As&nbsp;Byte<br />
&nbsp;&nbsp;&nbsp;&nbsp;Dim&nbsp;SourceFile,&nbsp;OutFile&nbsp;&nbsp;As&nbsp;String<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;SourceFile&nbsp;=&nbsp;&nbsp;&nbsp;'欲读入的文件名<br />
&nbsp;&nbsp;&nbsp;&nbsp;OutFile&nbsp;=&nbsp;&nbsp;&nbsp;'欲输出的文件名<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;ReDim&nbsp;DATA_SRC(FileLen(SourceFile)&nbsp;-&nbsp;1)<br />
&nbsp;&nbsp;&nbsp;&nbsp;Open&nbsp;SourceFile&nbsp;For&nbsp;Binary&nbsp;As&nbsp;#1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Get&nbsp;#1,&nbsp;1,&nbsp;DATA_SRC()<br />
&nbsp;&nbsp;&nbsp;&nbsp;Close&nbsp;#1<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;Open&nbsp;OutFile&nbsp;For&nbsp;Binary&nbsp;As&nbsp;#1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Put&nbsp;#1,&nbsp;1,&nbsp;DATA_SRC()<br />
&nbsp;&nbsp;&nbsp;&nbsp;Close&nbsp;#1
        </div>

      </td>
    </tr>
    <tr>
      <td valign="bottom">
          <div class="control">
    <div id='post-forum-bulletin-2'  class='fl'>
    </div>
  <div class="fr">
    <a href="/posts/493952/digg?topic_id=1197" class="red digg" data-method="put" data-remote="true" rel="nofollow">对我有用[0]</a>
    <a href="/posts/493952/bury?topic_id=1197" class="bury" data-method="put" data-remote="true" rel="nofollow">丢个板砖[0]</a>
    <a href="#quote" class="quote">引用</a> |
    <a href="/posts/493952/report?topic_id=1197" class="fancybox red" rel="nofollow">举报 </a> |
    <span class="manage-toggle">
      <div class="manage" style="display: none;">
          <a href="/posts/493952/edit" class="fancybox" rel="nofollow">编辑</a>
          <a href="/posts/493952/destroy_edit" class="fancybox" rel="nofollow">删除</a>
      </div>
      管理
    </span>
  </div>
</div>

      </td>
  </tr>
</table>

</div>
<div class="control_area">
  <form name="form" id="form">
    
    <div class="control">
      <ul>
        <li class="drop_menu_wrap drop_menu_up"><a href="#" class="drop_toggle drop_toggle_up btn_1"><span><img src="/assets/ico_set.gif" alt="" />管理菜单<img src="/assets/arrow_down.gif" alt="" /></span></a>
        <ul class="drop_menu" style="display: none; bottom:26px;">
            <li><a href="/topics/1197/top" class="fancybox" rel="nofollow">置顶</a></li>

  <li><a href="/topics/1197/recommend" data-confirm="确定要将该帖推荐(加精)吗？被推荐的帖子将给帖主奖励可用分88分!" data-method="put" rel="nofollow">推荐</a></li>

  <li><a href="/topics/1197/lock" class="fancybox" rel="nofollow">锁
1000
定</a></li>

<li><a href="/topics/1197/move" class="fancybox" rel="nofollow">移动</a></li>
<li><a href="/topics/1197/edit" class="fancybox" rel="nofollow">编辑</a></li>
<li><a href="/topics/1197/destroy_edit" class="fancybox" rel="nofollow">删除</a></li>
<li><a href="/topics/1197/add_point" class="fancybox" rel="nofollow">帖子加分</a></li>
  <li><a href="/topics/1197/highlight" class="fancybox" rel="nofollow">帖子高亮</a></li>

        </ul>
        </li>
        <li><a href="/topics/1197/close" class="btn_1"><span><img src="/assets/ico_over.gif" alt="" />结帖</span></a></li>
        <li><a href="/topics/new?forum_id=VB_Basic" class="btn_1"><span><img src="/assets/ico_publish.gif" alt="" />发帖</span></a></li>
        <li><a href="#new_post" class="btn_1"><span><img src="/assets/ico_return.gif" alt="" />回复</span></a></li>
      </ul>
    </div>
  </form>
</div>

<div class="comt">
  <div class="ad_l">
    <!-- 回复框文字 (D6) -->
    <ul><li><a href="http://g.csdn.net/5243760" target="_blank">【招】应届生,入职年薪5-10万</a></li><li><a href="http://g.csdn.net/5246043" target="_blank">市面上最出色的刀片式服务器</a></li><li><a href="http://g.csdn.net/5245460" target="_blank">IBM 以高效设计为灵魂</a></li><li><a href="http://g.csdn.net/5239181" target="_blank">首届携程大赛开始报名啦</a></li></ul>
    <ul>
        <li><a href="http://club.csdn.net/cmdn/bbs/topic/7282" class="title_style_black" target="_blank">台湾程序员游戏开发经历</a></li>
        <li><a href="http://g.csdn.net/5243630" class="title_style_black" target="_blank">陈勇- 敏捷开发现状及发展之路</a></li>
        <li><a href="http://bbs.csdn.net/topics/390399592" class="title_style_black" target="_blank">分享你的发现 赢下载积分</a></li>
    </ul>
    <div class="ad_new" style='padding: 0 0 50px 0'>
      <h4><img alt="" src="http://csdnimg.cn/www/images/csdn_logo_blue.gif"></h4>
      <p class='title'>
      <a href="http://bbs.csdn.net/topics/390397080" target="_blank">微软MVP申请</a>
      </p>
      <p class='con'>
      <a href="http://bbs.csdn.net/topics/390397080" target="_blank">CSDN与微软合作，长期为用户提供申请“微软最有价值专家”的平台，希望大家积极参与。</a>
      </p>
    </div>
  </div>
  <div class="reply">
      <h3>本帖子已过去太久远了，不再提供回复功能。</h3>
  </div>
</div>



<!-- 对联广告 -->
<div id="ad_left" style="position:absolute;width:120px;top:184px;left:10px;display:none">
  <a style="float:right;" href="#" onclick="javascript:this.parentNode.style.display='none';return false;">[关闭]</a>
  <iframe src="/sda/TopicDaLeft.htm?v201203051313" frameborder="0" height="600" width="120" scrolling="no"></iframe>
</div>
<div id="ad_right" style="position:absolute;width:120px;top:184px;right:10px;display:none">
  <a style="float:left;" href="#" onclick="javascript:this.parentNode.style.display='none';return false;">[关闭]</a>
  <iframe src="/sda/TopicDaRight.htm?v201203051313" frameborder="0" height="600" width="120" scrolling="no"></iframe>
</div>



      <script type="text/javascript" src="http://csdnimg.cn/pubfooter/js/publib_footer.js"></script>
<script type="text/javascript" src="http://www.csdn.net/ui/scripts/Csdn/counter.js"></script>
<script type="text/javascript" src="http://csdnimg.cn/pig/pubjs/cnick.js"></script>

      <img alt="Top_arrow" class="top_arrow" id="top_arrow" src="http://news.csdn.net//images/top_arrow.png" />
    </div>
    <script type="text/javascript" language="javascript" charset="utf-8">
//<![CDATA[
$(function(){
  topics_page_js.show_page();
    var bulletin_link = '<a href="http://bbs.csdn.net/topics/390417639" class="title_style_blue title_style_bold" target="_blank">【限时优惠】第五届云计算大会社区门票抢购</a>'
    $('#post-forum-bulletin-1').html(bulletin_link);
    var bulletin_link = '<a href="http://blog.csdn.net/csdn_ask/article/details/8751993" class="title_style_blue title_style_bold" target="_blank">CSDN问答频
1dc
3月声望排行榜出炉</a>'
    $('#post-forum-bulletin-2').html(bulletin_link);
    var bulletin_link = '<a href="http://blog.csdn.net/blogdevteam/article/details/8770910" class="title_style_red title_style_bold" target="_blank">Java应用级产品开发平台APDPlat作者杨尚川专访</a>'
    $('#post-forum-bulletin-3').html(bulletin_link);
});
//]]>
</script>
<script type="text/javascript" src="http://ad.csdn.net/scripts/ad-bbs.js"></script>

  </body>
</html>

0


url:bbs.csdn.net/topics/1198
HTTP/1.1 200 OK
Content-Type: text/html; charset=utf-8
Transfer-Encoding: chunked
Connection: close
Vary: Accept-Encoding
Status: 200
X-Powered-By: Phusion Passenger (mod_rails/mod_rack)
ETag: "78c6d8cc4e91ef0c1b9a7ed030bb4888"
Cache-Control: max-age=0, private, must-revalidate
Set-Cookie: _csdn_newbbs_session=BAh7B0kiD3Nlc3Npb25faWQGOgZFRkkiJTU0MjkxMzhmNjdlNDMwMWM0OGI3ZTc0YTNjYmZkMDVjBjsAVEkiEF9jc3JmX3Rva2VuBjsARkkiMVYzcEFkeDd4WE93MzdyTy94bXhUTXFydllXMWdyQU8wLyt5YjN2em1TTmc9BjsARg%3D%3D--5308dd0a6009917be5a1dd297db24755ce953dd5; path=/; HttpOnly
Server: nginx/1.2.4 + Phusion Passenger (mod_rails/mod_rack)
X-UA-Compatible: IE=Edge,chrome=1

1e11
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>请问：有没有BCB的COM口通讯的例程？ - CSDN论坛 - CSDN.NET</title>
    <link href="/assets/main-c65d6b72001ff03e3698df226a4e4ffe.css" media="screen" rel="stylesheet" type="text/css" />
    <script src="/assets/application-e72cd54f9ebb368ac82561934f7b9c72.js" type="text/javascript"></script>
    <meta content="authenticity_token" name="csrf-param" />
<meta content="V3pAdx7xXOw37rO/xmxTMqrvYW1grAO0/+yb3vzmSNg=" name="csrf-token" />
    <link href="http://csdnimg.cn/www/images/favicon.ico" rel="SHORTCUT ICON">

      <link href="/assets/sh-2bfcf65754f6d04d58df6ed87a3b6faf.css" media="all" rel="stylesheet" type="text/css" />
  <script src="/assets/sh-d778121d099d6e5ed8bb7ce42824a371.js" type="text/javascript"></script>
  <script src="http://passport.csdn.net/content/loginbox/login.js" type="text/javascript"></script>

  </head>
  <body>
    <div class="wraper">
      <script type="text/javascript" src="http://csdnimg.cn/pubnav/js/pub_topnav_2011.js"></script>

        <!-- 页顶通栏 -->
  <iframe id="Topic_Top" marginwidth="0" marginheight="0" frameborder="0" scrolling="no" width="100%" src="/sda/TopicPageTop.htm"></iframe>

      <div id="nav">
        <a href="/" class="logo" target="_top"></a>
        <div class="nav_list">
          <a href="/home" title="CSDN论坛首页" class="home">首页</a><a href="/help" class=""><span>论坛帮助</span></a><a href="/rank" class=""><span>论坛牛人</span></a><a href="/map" class=""><span>论坛地图</span></a>
        </div>

        <div class="nav_sear">
          <form action="http://so.csdn.net/search" target="_blank">
            <input name="t" type="hidden" value="thread" />
            <input name="q" type="text" />
          </form>
        </div>
      </div>
      <!--[if IE]>
<style type="text/css" media="screen">
.control_area .control .drop_menu{border:3px solid #ccc \9; _*border:3px solid #ccc;}
</style>
<![endif]-->

  <!-- 页顶Button (D3) -->
  <iframe id="frm_tt1" marginwidth="0" marginheight="0" frameborder="0" scrolling="no" width="100%" src="/sda/TopicBodyTop.htm?v=1"></iframe>
  <script type="text/javascript">
    setTimeout(function () { document.getElementById("frm_tt1").src = "/sda/TopicBodyTop.htm?v="+new Date().getTime(); }, 5000);
  </script>

<div class="bread_nav">
  <a href="http://www.csdn.net" target="_blank">CSDN</a> <em>&gt;</em>
  <a href="/" target="_blank">CSDN论坛</a> <em>&gt;</em>
    <a href="/forums/BCB" target="_blank">C++ Builder</a> <em>&gt;</em>
  <a href="/forums/BCBBase" target="_blank">基础类</a>
</div>

<div class="flash_messages">
</div>


<div class="control_area">
  <form name="form" id="form">
    
    <div class="control">
      <ul>
        <li class="drop_menu_wrap drop_menu_down"><a href="#" class="drop_toggle btn_1"><span><img src="/assets/ico_set.gif" alt="" />管理菜单<img src="/assets/arrow_down.gif" alt="" /></span></a>
        <ul class="drop_menu" style="display: none; top:26px;">
            <li><a href="/topics/1198/top" class="fancybox" rel="nofollow">置顶</a></li>

  <li><a href="/topics/1198/recommend" data-confirm="确定要将该帖推荐(加精)吗？被推荐的帖子将给帖主奖励可用分88分!" data-method="put" rel="nofollow">推荐</a></li>

  <li><a href="/topics/1198/lock" class="fancybox" rel="nofollow">锁定</a></li>

<li><a href="/topics/1198/move" class="fancybox" rel="nofollow">移动</a></li>
<li><a href="/topics/1198/edit" class="fancybox" rel="nofollow">编辑</a></li>
<li><a href="/topics/1198/destroy_edit" class="fancybox" rel="nofollow">删除</a></li>
<li><a href="/topics/1198/add_point" class="fancybox" rel="nofollow">帖子加分</a></li>
  <li><a href="/topics/1198/highlight" class="fancybox" rel="nofollow">帖子高亮</a></li>

        </ul>
        </li>
        <li><a href="/topics/1198/close" class="btn_1" rel='nofollow'><span><img src="/assets/ico_over.gif" alt="" />结帖</span></a></li>
        <li><a href="/topics/new?forum_id=BCBBase" class="btn_1"><span><img src="/assets/ico_publish.gif" alt="" />发帖</span></a></li>
        <li><a href="#new_post" class="btn_1"><span><img src="/assets/ico_return.gif" alt="" />回复</span></a></li>
      </ul>
    </div>
  </form>
</div>
<div class="detail_title">
  <h1>
      请问：有没有BCB的COM口通讯的例程？
    <span>
      [问题点数：100分，结帖人fido]
    </span>
  </h1>
  <div class="fr">
    <select name="filter_posts">
      <option value="default">不显示删除回复</option>
      <option value="all">显示所有回复</option>
      <option value="star">显示星级回复</option>
      <option value="pointed">显示得分回复</option>
      <option value="lz">只显示楼主</option>
    </select>
    <a href="http://my.csdn.net/my/favorite/miniadd?u=http://bbs.csdn.net/topics/1198&amp;t=%E8%AF%B7%E9%97%AE%EF%BC%9A%E6%9C%89%E6%B2%A1%E6%9C%89BCB%E7%9A%84COM%E5%8F%A3%E9%80%9A%E8%AE%AF%E7%9A%84%E4%BE%8B%E7%A8%8B%EF%BC%9F" id="fav" class="fav" rel='nofollow'><img src="/assets/nolines_plus.gif" alt="" />收藏</a>
  </div>
</div>
<div class="detailed">
    <table border="0" cellspacing="0" cellpadding="0" id="post-1198" class="post topic " data-post-id="1198" data-is-topic-locked="false">
  <colgroup><col width="180" /><col /></colgroup>
  <tr>
      <td rowspan="2" valign="top" class="wirter">
                <dl class="user_info ">
          <dt class="user_head" data-username="fido">
            <a href="http://my.csdn.net/fido" target="_blank"><img alt="fido" class="avatar" src="http://avatar.profile.csdn.net/5/E/1/1_fido.jpg" /></a>
          </dt>
          <dd class="username">
            <a href="http://my.csdn.net/fido" target="_blank">fido</a>
            
          </dd>
          <dd class="nickname">
            <span class="name2nick">fido</span>
          </dd>
          <dd title="总技术分：0；总技术排名：4451840">等级：<img alt="Blank" class="grade user1" src="/assets/blank.gif" /></dd>
          <dd class="close_rate" title="用户结帖率：100%
总发帖：2
正常结帖：2
未结帖：0">结帖率：100%</dd>
          
        </dl>

      </td>
      <td valign="top" class="post_info topic pointed" data-username="fido" data-floor="">
                <div class="data">
            <strong class="fr">
              楼主
            </strong>
          <span class="time">
              发表于：
            2000-02-01 12:40:00
          </span>
        </div>
        <div class="post_body">
            请给出一个详细的例子，谢谢。
              <div class="tag ">
              </div>
        </div>
          <!-- 主帖下Banner (D4) -->
          <!-- 主帖下文字 (D5) -->
          <iframe id="tad2" marginwidth="0" marginheight="0" frameborder="0" scrolling="no" width="100%" src="/sda/TopicBodyBottom.htm"></iframe>

      </td>
    </tr>
    <tr>
      <td valign="bottom">
          <div class="control">
  <div class="fr">
    <a href="/posts/1198/digg?topic_id=1198" class="red digg" data-method="put" data-remote="true" rel="nofollow">对我有用[0]</a>
    <a href="/posts/1198/bury?topic_id=1198" class="bury" data-method="put" data-remote="true" rel="nofollow">丢个板砖[0]</a>
    <a href="#quote" class="quote">引用</a> |
    <a href="/posts/1198/report?topic_id=1198" class="fancybox red" rel="nofollow">举报 </a> |
    <span class="manage-toggle">
      <div class="manage" style="display: none;">
          <a
2000
 href="/topics/1198/edit" class="fancybox" rel="nofollow">编辑</a>
          <a href="/topics/1198/destroy_edit" class="fancybox" rel="nofollow">删除</a>
      </div>
      管理
    </span>
  </div>
    <span class="return_time">回复次数：7</span>
</div>

      </td>
  </tr>
</table>

  <table border="0" cellspacing="0" cellpadding="0" id="post-493854" class="post  " data-post-id="493854" data-is-topic-locked="false">
  <colgroup><col width="180" /><col /></colgroup>
  <tr>
      <td rowspan="2" valign="top" class="wirter">
                <dl class="user_info ">
          <dt class="user_head" data-username="radish">
            <a href="http://my.csdn.net/radish" target="_blank"><img alt="radish" class="avatar" src="http://avatar.profile.csdn.net/E/1/3/1_radish.jpg" /></a>
          </dt>
          <dd class="username">
            <a href="http://my.csdn.net/radish" target="_blank">radish</a>
            
          </dd>
          <dd class="nickname">
            <span class="name2nick">radish</span>
          </dd>
          <dd title="总技术分：209；总技术排名：80775">等级：<img alt="Blank" class="grade user1" src="/assets/blank.gif" /></dd>
          <dd class="close_rate" title="用户结帖率：100%
总发帖：68
正常结帖：68
未结帖：0">结帖率：100%</dd>
          
        </dl>

      </td>
      <td valign="top" class="post_info pointed" data-username="radish" data-floor="1">
                <div class="data">
            <span class="fr">
              <a href="#post-493854">#1</a>
              得分：10
            </span>
          <span class="time">
              回复于：
            2000-02-01 13:10:00
          </span>
        </div>
        <div class="post_body">
            在我的网页上有一个DELPHI的，不知道你要不要（radsworld.myrice.com)
        </div>

      </td>
    </tr>
    <tr>
      <td valign="bottom">
          <div class="control">
    <div id='post-forum-bulletin-1'  class='fl'>
    </div>
  <div class="fr">
    <a href="/posts/493854/digg?topic_id=1198" class="red digg" data-method="put" data-remote="true" rel="nofollow">对我有用[0]</a>
    <a href="/posts/493854/bury?topic_id=1198" class="bury" data-method="put" data-remote="true" rel="nofollow">丢个板砖[0]</a>
    <a href="#quote" class="quote">引用</a> |
    <a href="/posts/493854/report?topic_id=1198" class="fancybox red" rel="nofollow">举报 </a> |
    <span class="manage-toggle">
      <div class="manage" style="display: none;">
          <a href="/posts/493854/edit" class="fancybox" rel="nofollow">编辑</a>
          <a href="/posts/493854/destroy_edit" class="fancybox" rel="nofollow">删除</a>
      </div>
      管理
    </span>
  </div>
</div>

      </td>
  </tr>
</table>
<table border="0" cellspacing="0" cellpadding="0" id="post-494221" class="post  " data-post-id="494221" data-is-topic-locked="false">
  <colgroup><col width="180" /><col /></colgroup>
  <tr>
      <td rowspan="2" valign="top" class="wirter">
                <dl class="user_info ">
          <dt class="user_head" data-username="AutoAsm">
            <a href="http://my.csdn.net/AutoAsm" target="_blank"><img alt="AutoAsm" class="avatar" src="http://avatar.profile.csdn.net/1/1/B/1_autoasm.jpg" /></a>
          </dt>
          <dd class="username">
            <a href="http://my.csdn.net/AutoAsm" target="_blank">AutoAsm</a>
            
          </dd>
          <dd class="nickname">
            <span class="name2nick">AutoAsm</span>
          </dd>
          <dd title="总技术分：2850；总技术排名：10280">等级：<img alt="Blank" class="grade user2" src="/assets/blank.gif" /></dd>
          <dd class="close_rate" title="用户结帖率：98.45%
总发帖：258
正常结帖：254
未结帖：4">结帖率：98.45%</dd>
          
        </dl>

      </td>
      <td valign="top" class="post_info " data-username="AutoAsm" data-floor="2">
                <div class="data">
            <span class="fr">
              <a href="#post-494221">#2</a>
              得分：0
            </span>
          <span class="time">
              回复于：
            2000-02-03 22:56:00
          </span>
        </div>
        <div class="post_body">
            &nbsp;&nbsp;例程没有，不过COM&nbsp;通讯&nbsp;RING&nbsp;3&nbsp;就够了，不是太难。
        </div>

      </td>
    </tr>
    <tr>
      <td valign="bottom">
          <div class="control">
    <div id='post-forum-bulletin-2'  class='fl'>
    </div>
  <div class="fr">
    <a href="/posts/494221/digg?topic_id=1198" class="red digg" data-method="put" data-remote="true" rel="nofollow">对我有用[0]</a>
    <a href="/posts/494221/bury?topic_id=1198" class="bury" data-method="put" data-remote="true" rel="nofollow">丢个板砖[0]</a>
    <a href="#quote" class="quote">引用</a> |
    <a href="/posts/494221/report?topic_id=1198" class="fancybox red" rel="nofollow">举报 </a> |
    <span class="manage-toggle">
      <div class="manage" style="display: none;">
          <a href="/posts/494221/edit" class="fancybox" rel="nofollow">编辑</a>
          <a href="/posts/494221/destroy_edit" class="fancybox" rel="nofollow">删除</a>
      </div>
      管理
    </span>
  </div>
</div>

      </td>
  </tr>
</table>
<table border="0" cellspacing="0" cellpadding="0" id="post-494230" class="post  " data-post-id="494230" data-is-topic-locked="false">
  <colgroup><col width="180" /><col /></colgroup>
  <tr>
      <td rowspan="2" valign="top" class="wirter">
                <dl class="user_info ">
          <dt class="user_head" data-username="bunny">
            <a href="http://my.csdn.net/bunny" target="_blank"><img alt="bunny" class="avatar" src="http://avatar.profile.csdn.net/2/0/E/1_bunny.jpg" /></a>
          </dt>
          <dd class="username">
            <a href="http://my.csdn.net/bunny" target="_blank">bunny</a>
            
          </dd>
          <dd class="nickname">
            <span class="name2nick">bunny</span>
          </dd>
          <dd title="总技术分：145；总技术排名：100770">等级：<img alt="Blank" class="grade user1" src="/assets/blank.gif" /></dd>
          <dd class="close_rate" title="用户结帖率：100%
总发帖：3
正常结帖：3
未结帖：0">结帖率：100%</dd>
          
        </dl>

      </td>
      <td valign="top" class="post_info " data-username="bunny" data-floor="3">
                <div class="data">
            <span class="fr">
              <a href="#post-494230">#3</a>
              得分：0
            </span>
          <span class="time">
              回复于：
            2000-02-04 00:29:00
          </span>
        </div>
        <div class="post_body">
            我记得在程序员大本营里有的说！
        </div>

      </td>
    </tr>
    <tr>
      <td valign="bottom">
          <div class="control">
    <div id='post-forum-bulletin-3'  class='fl'>
    </div>
  <div class="fr">
    <a href="/posts/494230/digg?topic_id=1198" class="red digg" data-method="put" data-remote="true" rel="nofollow">对我有用[0]</a>
    <a href="/posts/494230/bury?topic_id=1198" class="bury" data-method="put" data-remote="true" rel="nofollow">丢个板砖[0]</a>
    <a href="#quote" class="quote">引用</a> |
    <a href="/posts/494230/report?topic_id=1198" class="fancybox red" rel="nofollow">举报 </a> |
    <span class="manage-toggle">
      <div class="manage" style="display: none;">
          <a href="/posts/494230/edit" class="fancybox" rel="nofollow">编辑</a>
          <a href="/posts/494230/destroy_edit" class="fancybox" rel="nofollow">删除</a>
      </div>
      管理
    </span>
  </div>
</div>

      </td>
  </tr>
</table>
<table border="0" cellspacing="0" cellpadding="0" id="post-494285" class="post  " data-post-id="494285" data-is-topic-locked="false">
  <colgroup><col width="180" /><col /></colgroup>
  <tr>
      <td rowspan="2" valign="top" class="wirter">
                <dl class="user_info ">
          <dt class="user_head" data-username="ysh">
            <a href="http://my.csdn.net/ysh" target="_blank"><img alt="ysh" class="avatar" src="http:/
2000
/avatar.profile.csdn.net/A/C/5/1_ysh.jpg" /></a>
          </dt>
          <dd class="username">
            <a href="http://my.csdn.net/ysh" target="_blank">ysh</a>
            
          </dd>
          <dd class="nickname">
            <span class="name2nick">ysh</span>
          </dd>
          <dd title="总技术分：569；总技术排名：40837">等级：<img alt="Blank" class="grade user2" src="/assets/blank.gif" /></dd>
          <dd class="close_rate" title="用户结帖率：100%
总发帖：29
正常结帖：29
未结帖：0">结帖率：100%</dd>
          
        </dl>

      </td>
      <td valign="top" class="post_info pointed" data-username="ysh" data-floor="4">
                <div class="data">
            <span class="fr">
              <a href="#post-494285">#4</a>
              得分：15
            </span>
          <span class="time">
              回复于：
            2000-02-05 01:48:00
          </span>
        </div>
        <div class="post_body">
            我正在用BCB串口通信程序，已做出现成的程序，但不知是否符合你的要求。查询请E到yangsh_sky@371.net
        </div>

      </td>
    </tr>
    <tr>
      <td valign="bottom">
          <div class="control">
    <div id='post-forum-bulletin-4'  class='fl'>
    </div>
  <div class="fr">
    <a href="/posts/494285/digg?topic_id=1198" class="red digg" data-method="put" data-remote="true" rel="nofollow">对我有用[0]</a>
    <a href="/posts/494285/bury?topic_id=1198" class="bury" data-method="put" data-remote="true" rel="nofollow">丢个板砖[0]</a>
    <a href="#quote" class="quote">引用</a> |
    <a href="/posts/494285/report?topic_id=1198" class="fancybox red" rel="nofollow">举报 </a> |
    <span class="manage-toggle">
      <div class="manage" style="display: none;">
          <a href="/posts/494285/edit" class="fancybox" rel="nofollow">编辑</a>
          <a href="/posts/494285/destroy_edit" class="fancybox" rel="nofollow">删除</a>
      </div>
      管理
    </span>
  </div>
</div>

      </td>
  </tr>
</table>
<table border="0" cellspacing="0" cellpadding="0" id="post-495035" class="post  " data-post-id="495035" data-is-topic-locked="false">
  <colgroup><col width="180" /><col /></colgroup>
  <tr>
      <td rowspan="2" valign="top" class="wirter">
                <dl class="user_info ">
          <dt class="user_head" data-username="nil">
            <a href="http://my.csdn.net/nil" target="_blank"><img alt="nil" class="avatar" src="http://avatar.profile.csdn.net/8/5/2/1_nil.jpg" /></a>
          </dt>
          <dd class="username">
            <a href="http://my.csdn.net/nil" target="_blank">nil</a>
            
          </dd>
          <dd class="nickname">
            <span class="name2nick">nil</span>
          </dd>
          <dd title="总技术分：10；总技术排名：343158">等级：<img alt="Blank" class="grade user1" src="/assets/blank.gif" /></dd>
          <dd class="close_rate" title="用户结帖率：100%
总发帖：10
正常结帖：10
未结帖：0">结帖率：100%</dd>
          
        </dl>

      </td>
      <td valign="top" class="post_info pointed" data-username="nil" data-floor="5">
                <div class="data">
            <span class="fr">
              <a href="#post-495035">#5</a>
              得分：5
            </span>
          <span class="time">
              回复于：
            2000-02-13 17:45:00
          </span>
        </div>
        <div class="post_body">
            我有，请与我联系：bcb4zp@21cn.com
        </div>

      </td>
    </tr>
    <tr>
      <td valign="bottom">
          <div class="control">
    <div id='post-forum-bulletin-5'  class='fl'>
    </div>
  <div class="fr">
    <a href="/posts/495035/digg?topic_id=1198" class="red digg" data-method="put" data-remote="true" rel="nofollow">对我有用[0]</a>
    <a href="/posts/495035/bury?topic_id=1198" class="bury" data-method="put" data-remote="true" rel="nofollow">丢个板砖[0]</a>
    <a href="#quote" class="quote">引用</a> |
    <a href="/posts/495035/report?topic_id=1198" class="fancybox red" rel="nofollow">举报 </a> |
    <span class="manage-toggle">
      <div class="manage" style="display: none;">
          <a href="/posts/495035/edit" class="fancybox" rel="nofollow">编辑</a>
          <a href="/posts/495035/destroy_edit" class="fancybox" rel="nofollow">删除</a>
      </div>
      管理
    </span>
  </div>
</div>

      </td>
  </tr>
</table>
<table border="0" cellspacing="0" cellpadding="0" id="post-495036" class="post  " data-post-id="495036" data-is-topic-locked="false">
  <colgroup><col width="180" /><col /></colgroup>
  <tr>
      <td rowspan="2" valign="top" class="wirter">
                <dl class="user_info ">
          <dt class="user_head" data-username="Firing_Sky">
            <a href="http://my.csdn.net/Firing_Sky" target="_blank"><img alt="Firing_Sky" class="avatar" src="http://avatar.profile.csdn.net/2/3/A/1_firing_sky.jpg" /></a>
          </dt>
          <dd class="username">
            <a href="http://my.csdn.net/Firing_Sky" target="_blank">Firing_Sky</a>
            
          </dd>
          <dd class="nickname">
            <span class="name2nick">Firing_Sky</span>
          </dd>
          <dd title="总技术分：7199；总技术排名：4063">等级：<img alt="Blank" class="grade user3" src="/assets/blank.gif" /></dd>
          <dd class="close_rate" title="用户结帖率：98.82%
总发帖：85
正常结帖：84
未结帖：1">结帖率：98.82%</dd>
          <div class="medal_silver " title="2000年2月 总版技术专家分月排行榜第二"></div><div class="medal_yellow " title="2000年2月 VB大版内专家分月排行榜第二"></div><div class="medal_blue " title="2000年2月 Delphi大版内专家分月排行榜第三"></div>
        </dl>

      </td>
      <td valign="top" class="post_info pointed" data-username="Firing_Sky" data-floor="6">
                <div class="data">
            <span class="fr">
              <a href="#post-495036">#6</a>
              得分：20
            </span>
          <span class="time">
              回复于：
            2000-02-13 17:51:00
          </span>
        </div>
        <div class="post_body">
            #include&nbsp;&lt;windows.h&gt;<br />
#pragma&nbsp;hdrstop<br />
#include&nbsp;"ICCDevice.h"<br />
static&nbsp;HANDLE&nbsp;ComHandle;<br />
//static&nbsp;HANDLE&nbsp;hCom[4];<br />
static&nbsp;COMMTIMEOUTS&nbsp;MyCommTimeouts;<br />
DCB&nbsp;dcb;<br />
HINSTANCE&nbsp;hInstance;<br />
//---------------------------------------------------<br />
#pragma&nbsp;argsused<br />
int&nbsp;WINAPI&nbsp;DllEntryPoint(HINSTANCE&nbsp;hinst,&nbsp;unsigned&nbsp;long&nbsp;reason,&nbsp;void*)<br />
{<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hInstance=hinst;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;1;<br />
}<br />
//------------------------------------------------------------------------<br />
HINSTANCE&nbsp;__declspec(dllexport)&nbsp;__stdcall&nbsp;GetDLLInstance()<br />
{<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return(hInstance);<br />
}<br />
//------------------------------------------------------------------------------<br />
<br />
bool&nbsp;ReceiveByteFromComDev(double&nbsp;TimeReceiveDelay,&nbsp;unsigned&nbsp;char*&nbsp;ByteBuf,&nbsp;HANDLE&nbsp;hCom)<br />
{<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unsigned&nbsp;long&nbsp;dwNumRead&nbsp;;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unsigned&nbsp;long&nbsp;dwNumtoRead&nbsp;;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unsigned&nbsp;char&nbsp;TempCommRead[3];<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GetCommTimeouts(hCom,&amp;MyCommTimeouts);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MyCommTimeouts.ReadIntervalTimeout&nbsp;=&nbsp;TimeReceiveDelay;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MyCommTimeouts.ReadTotalTimeoutMultiplier&nbsp;=&nbsp;1;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MyCommTimeouts.ReadTotalTimeoutConstant&nbsp;=&nbsp;TimeReceiveDelay;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SetCommTimeouts(hCom&nbsp;,&amp;MyCommTimeouts&nbsp;);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dwNumtoRead&nbsp;=&nbsp;1&nbsp;;<br 
2000
/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BOOL&nbsp;Fcom=ReadFile(hCom,&amp;TempCommRead,dwNumtoRead&nbsp;,&amp;dwNumRead,NULL);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(Fcom&nbsp;&amp;&amp;&nbsp;&nbsp;dwNumRead!=&nbsp;0)&nbsp;{*ByteBuf&nbsp;=&nbsp;TempCommRead[0]&nbsp;;return&nbsp;true;}<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;return&nbsp;false;<br />
}<br />
//-------------------------------------------------<br />
bool&nbsp;SendByteToComm(unsigned&nbsp;char&nbsp;ByteToSend,&nbsp;HANDLE&nbsp;hCom)<br />
{<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;TimeSendDelay=1;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unsigned&nbsp;long&nbsp;dwNumWrite&nbsp;;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unsigned&nbsp;long&nbsp;dwNumtoWrite&nbsp;;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unsigned&nbsp;char&nbsp;TempCommWrite[3];<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GetCommTimeouts(hCom,&amp;MyCommTimeouts);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MyCommTimeouts.WriteTotalTimeoutMultiplier&nbsp;=&nbsp;TimeSendDelay;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MyCommTimeouts.WriteTotalTimeoutConstant&nbsp;=&nbsp;1;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SetCommTimeouts(hCom,&amp;MyCommTimeouts);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dwNumtoWrite&nbsp;=&nbsp;1&nbsp;;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TempCommWrite[0]&nbsp;=&nbsp;ByteToSend&nbsp;;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(WriteFile(hCom,&nbsp;&amp;TempCommWrite&nbsp;,&nbsp;dwNumtoWrite,&amp;dwNumWrite,NULL))&nbsp;return&nbsp;true;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;return&nbsp;false;<br />
}<br />
<br />
int&nbsp;__declspec(dllexport)&nbsp;__stdcall&nbsp;CloseComm(HANDLE&nbsp;hCom)<br />
{<br />
if(CloseHandle(&nbsp;hCom&nbsp;))&nbsp;return&nbsp;1;<br />
else&nbsp;return&nbsp;0;<br />
}<br />
//-------------------------------------------------------------------------------<br />
int&nbsp;__declspec(dllexport)&nbsp;__stdcall&nbsp;SetComm(int&nbsp;CommID,HANDLE&nbsp;*sendhcom)<br />
{<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(CommID&lt;1&nbsp;and&nbsp;&nbsp;and&nbsp;CommID&gt;4)return&nbsp;0;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;char&nbsp;ComName[]="COM1";<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;switch(CommID)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;1:{ComName[3]='1';break;}<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;2:{ComName[3]='2';break;}<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;3:{ComName[3]='3';break;}<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;4:{ComName[3]='4';break;}<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;default:&nbsp;return&nbsp;0;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ComHandle&nbsp;=&nbsp;CreateFile(ComName,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GENERIC_READ&nbsp;&nbsp;and&nbsp;&nbsp;GENERIC_WRITE,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NULL,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OPEN_EXISTING,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FILE_ATTRIBUTE_NORMAL,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NULL<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!SetupComm(&nbsp;ComHandle&nbsp;,1024,1024)){&nbsp;CloseHandle(ComHandle);return&nbsp;0;}<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GetCommState(ComHandle,&nbsp;&amp;dcb);//Read&nbsp;com'&nbsp;dcb&nbsp;setting<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dcb.BaudRate&nbsp;=&nbsp;CBR_19200;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dcb.ByteSize&nbsp;=&nbsp;8;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;number&nbsp;of&nbsp;bits/byte,&nbsp;4-8<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dcb.Parity&nbsp;=&nbsp;EVENPARITY;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;0-4=no,odd,even,mark,space<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dcb.StopBits&nbsp;=&nbsp;ONESTOPBIT;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dcb.fDtrControl&nbsp;=&nbsp;DTR_CONTROL_DISABLE;//make&nbsp;DTR&nbsp;disable<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dcb.XonChar&nbsp;=&nbsp;0x17;&nbsp;//&nbsp;XON&nbsp;ASCII&nbsp;char<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dcb.XoffChar&nbsp;=&nbsp;0x19;&nbsp;//&nbsp;XOFF&nbsp;ASCII&nbsp;char<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dcb.XonLim&nbsp;=&nbsp;256&nbsp;;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dcb.XoffLim&nbsp;=&nbsp;1;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SetCommMask(ComHandle&nbsp;,&nbsp;EV_TXEMPTY&nbsp;&nbsp;and&nbsp;&nbsp;EV_RXCHAR&nbsp;&nbsp;and&nbsp;&nbsp;EV_ERR&nbsp;);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PurgeComm(ComHandle&nbsp;,&nbsp;PURGE_TXCLEAR);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PurgeComm(ComHandle&nbsp;,&nbsp;PURGE_RXCLEAR);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!SetCommState(ComHandle,&nbsp;&amp;dcb))return&nbsp;0;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*sendhcom&nbsp;=&nbsp;ComHandle;<br />
//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hCom[CommID-1]=ComHandle;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;1;<br />
}<br />
//------------------------------------------------------------------------------<br />
int&nbsp;__declspec(dllexport)&nbsp;__stdcall&nbsp;Reset(HANDLE&nbsp;hCom)<br />
{<br />
GetCommState(hCom,&nbsp;&amp;dcb);<br />
dcb.fDtrControl&nbsp;=&nbsp;DTR_CONTROL_ENABLE;<br />
if&nbsp;(!SetCommState(hCom,&nbsp;&amp;dcb))return&nbsp;0;<br />
GetCommState(hCom,&nbsp;&amp;dcb);<br />
dcb.fDtrControl&nbsp;=&nbsp;DTR_CONTROL_DISABLE;<br />
if&nbsp;(!SetCommState(hCom,&nbsp;&amp;dcb))return&nbsp;0;<br />
else&nbsp;return&nbsp;1;<br />
}<br />
<br />
int&nbsp;__declspec(dllexport)&nbsp;__stdcall&nbsp;ShutDown(HANDLE&nbsp;hCom)<br />
{<br />
unsigned&nbsp;char&nbsp;p1=0x00,p2=0x00;<br />
if(!SendByteToComm(0xfa,&nbsp;hCom))return&nbsp;0;<br />
if(!SendByteToComm(0x46,&nbsp;hCom))return&nbsp;0;<br />
if(!ReceiveByteFromComDev(2000,&amp;p1,&nbsp;hCom));<br />
if(!ReceiveByteFromComDev(500,&amp;p2,&nbsp;hCom));<br />
if(!ReceiveByteFromComDev(500,&amp;p2,&nbsp;hCom));<br />
if(!ReceiveByteFromComDev(500,&amp;p2,&nbsp;hCom));<br />
if(!ReceiveByteFromComDev(500,&amp;p2,&nbsp;hCom));<br />
PurgeComm(hCom,&nbsp;PURGE_TXCLEAR);<br />
PurgeComm(hCom,&nbsp;PURGE_RXCLEAR);<br />
return&nbsp;1;<br />
}<br />

        </div>

      </td>
    </tr>
    <tr>
      <td valign="bottom">
          <div class="control">
    <div id='post-forum-bulletin-6'  class='fl'>
    </div>
  <div class="fr">
    <a href="/posts/495036/digg?topic_id=1198" class="red digg" data-method="put" data-remote="true" rel="nofollow">对我有用[0]</a>
    <a href="/posts/495036/bury?topic_id=1198" class="bury" data-method="put" data-remote="true" rel="nofollow">丢个板砖[0]</a>
    <a href="#quote" class="quote">引用</a> |
    <a href="/posts/495036/report?topic_id=1198" class="fancybox red" rel="nofollow">举报 </a> |
    <span class="manage-toggle">
      <div class="manage" style="display: none;">
          <a href="/posts/495036/edit" class="fancybox" rel="nofollow">编辑</a>
          <a href="/posts/495036/destroy_edit" class="fancybox" rel="nofollow">删除</a>
      </div>
      管理
    </span>
  </div>
</div>

      </td>
  </tr>
</table>
<table border="0" cellspacing="0" cellpadding="0" id="post-495070" class="post  " data-post-id="495070" data-is-topic-locked="false">
  <colgroup><col width="180" /><col /></colgroup>
  <tr>
      <td rowspan="2" valign="top" class="wirter">
                <dl class="user_info ">
          <dt class="user_head" data-username="ybchen">
            <a href="http://my.csdn.net/ybchen" target="_blank"><img alt="ybchen" class="avatar" src="http://avatar.profile.csdn.net/9/1/6/1_ybchen.jpg" /></a>
          </dt>
          <dd class="username">
            <a href="http://my.csdn.net/ybchen" target="_blank">ybchen</a>
            
          </dd>
          <dd class="nickname">
            <span class="name2nick">ybchen</span>
          </dd>
          <dd title="总技术分：6314；总技术排名：4762">
1000
级：<img alt="Blank" class="grade user5" src="/assets/blank.gif" /></dd>
          <dd class="close_rate" title="用户结帖率：100%
总发帖：55
正常结帖：55
未结帖：0">结帖率：100%</dd>
          
        </dl>

      </td>
      <td valign="top" class="post_info pointed" data-username="ybchen" data-floor="7">
                <div class="data">
            <span class="fr">
              <a href="#post-495070">#7</a>
              得分：50
            </span>
          <span class="time">
              回复于：
            2000-02-13 21:28:00
          </span>
        </div>
        <div class="post_body">
            我用的是&nbsp;C++&nbsp;Builder&nbsp;的哥哥&nbsp;Borland&nbsp;C++&nbsp;5&nbsp;编的串口类，<br />
使用非常简单，稍加改动就可以在&nbsp;C++&nbsp;Builder&nbsp;里面运行，<br />
因为&nbsp;C++&nbsp;Builder&nbsp;仍然用的是&nbsp;Borland&nbsp;C++&nbsp;5.x&nbsp;的编译器，<br />
这里有完整的代码，如果发现有bug请告诉我，同样我也会<br />
感谢你的，因为这段代码正在使用中。<br />
<br />
串口通讯用的是32位API函数，(16位的Win3.x&nbsp;API函数早已<br />
不复存在):&nbsp;CreateFile、ReadFile、WriteFile、<br />
CloseHandle等。<br />
<br />
因为这些函数如果用查询方法，他们的超时工作(用<br />
SetCommTimeouts&nbsp;设置)会引起系统访问消息的延时，十分<br />
影响程序运行的效率，因此采用了重叠操作，在另一个线程<br />
里面监视串口通讯情况，如果有数据收到或发送缓存空就向<br />
主线程发一个串口通讯消息，并暂停监视，主线程相应完<br />
消息(读/写)后监视线程继续工作。<br />
<br />
这个类使用非常简单，先介绍一下使用：<br />
比如要打开两个串口同时通讯，可以如下定义：<br />
<br />
TComm32&nbsp;*CommA,&nbsp;*CommB;<br />
<br />
初始化：<br />
<br />
CommA&nbsp;=&nbsp;new&nbsp;TComm32(this);&nbsp;//必须指明在哪个窗口消息里处<br />
CommB&nbsp;=&nbsp;new&nbsp;TComm32(this);&nbsp;//理串口数据，这里用的是this<br />
<br />
CommA&nbsp;-&gt;&nbsp;SetPort(1);&nbsp;//用COM1，在使用中可以随时更改<br />
CommB&nbsp;-&gt;&nbsp;SetPort(2);&nbsp;//用COM2，在使用中可以随时更改<br />
<br />
CommA&nbsp;-&gt;&nbsp;SetParams(CBR_4800,&nbsp;NOPARITY,&nbsp;8,&nbsp;ONESTOPBIT);<br />
CommB&nbsp;-&gt;&nbsp;SetParams(CBR_9600,&nbsp;NOPARITY,&nbsp;8,&nbsp;ONESTOPBIT);<br />
<br />
打开串口：<br />
<br />
if((Error&nbsp;=&nbsp;CommA&nbsp;-&gt;&nbsp;Open())&nbsp;!=&nbsp;0)<br />
{<br />
//错误处理<br />
}<br />
<br />
if((Error&nbsp;=&nbsp;CommB&nbsp;-&gt;&nbsp;Open())&nbsp;!=&nbsp;0)<br />
{<br />
//错误处理<br />
}<br />
<br />
响应串口消息：<br />
可以在此处读串口，也可以在定时器或其他任何函数里面<br />
本消息的参数&nbsp;wParam&nbsp;表示串口进行了读还是写操作<br />
本消息的参数&nbsp;lParam&nbsp;是响应操作的串口对象的地址<br />
<br />
DEFINE_RESPONSE_TABLE1(TMyWindow,&nbsp;TParentWindow)<br />
EV_MESSAGE(WM_COMMNOTIFY,&nbsp;EvCommNotify),<br />
...&nbsp;//其他消息<br />
END_RESPONSE_TABLE;<br />
<br />
LRESULT&nbsp;TMyWindow::EvCommNotify(WPARAM&nbsp;wParam,&nbsp;LPARAM&nbsp;lParam)<br />
{<br />
((TComm32&nbsp;*)lParam)-&gt;CommNotify(wParam);&nbsp;//必须调用这个函数<br />
<br />
//可以在此处读串口，也可以在定时器或其他函数里面<br />
//如果在此处读串口数据，可以按如下方法：<br />
while((BytesRead&nbsp;=&nbsp;CommA-&gt;Read(Buffer,&nbsp;BufferSize))&nbsp;!=&nbsp;0)<br />
{<br />
//处理从CommA里面读出的数据<br />
}<br />
<br />
while((BytesRead&nbsp;=&nbsp;CommB-&gt;Read(Buffer,&nbsp;BufferSize))&nbsp;!=&nbsp;0)<br />
{<br />
//处理从CommB里面读出的数据<br />
}<br />
<br />
return&nbsp;true;&nbsp;//必须返回非零值<br />
}<br />
<br />
写串口：可以在任何位置调用：<br />
BytesWrite&nbsp;=&nbsp;CommA-&gt;Write(Buffer,&nbsp;BufferSize);<br />
BytesW
2000
rite&nbsp;=&nbsp;CommB-&gt;Write(Buffer,&nbsp;BufferSize);<br />
<br />
关闭串口：<br />
CommA-&gt;Close();<br />
CommB-&gt;Close();<br />
<br />
在程序结束前需要删除CommA、CommB对象，但关闭串口不是必须的，<br />
因为在他们的析构函数里面已经关闭了串口<br />
delete&nbsp;CommA;<br />
delete&nbsp;CommB;<br />
<br />
//======================================================================<br />
//我不多说了，看看&nbsp;TComm32&nbsp;类的实现就明白了,&nbsp;TCommQueue&nbsp;是保存数据的队列<br />
//TComm32&nbsp;&amp;&nbsp;TCommQueue,&nbsp;Copyright&nbsp;(C)&nbsp;ybchen,&nbsp;EMail:&nbsp;ybchen@email.com.cn<br />
//======================================================================<br />
<br />
class&nbsp;TCommQueue<br />
&nbsp;{<br />
&nbsp;&nbsp;&nbsp;public:<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TCommQueue(long&nbsp;BufSize=8192);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;virtual&nbsp;~TCommQueue();<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;long&nbsp;In(char&nbsp;far&nbsp;*s,&nbsp;long&nbsp;n=1);&nbsp;//RetVal:&nbsp;num&nbsp;of&nbsp;chars&nbsp;pushed&nbsp;in<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;long&nbsp;Out(char&nbsp;far&nbsp;*s,&nbsp;long&nbsp;n=1);&nbsp;//RetVal:&nbsp;num&nbsp;of&nbsp;chars&nbsp;poped&nbsp;out<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;long&nbsp;Read(char&nbsp;far&nbsp;*s,&nbsp;long&nbsp;n=1,&nbsp;long&nbsp;Offs=0);&nbsp;//RetVal:&nbsp;num&nbsp;of&nbsp;chars&nbsp;read<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;void&nbsp;Clear(void)&nbsp;{&nbsp;_First&nbsp;=&nbsp;_Count&nbsp;=&nbsp;0;&nbsp;}<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;long&nbsp;Count(void)&nbsp;{&nbsp;return&nbsp;_Count;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;long&nbsp;QSize(void)&nbsp;{&nbsp;return&nbsp;_BufSize;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bool&nbsp;Valid(void)&nbsp;{&nbsp;return&nbsp;_Buffer&nbsp;!=&nbsp;0;&nbsp;}<br />
<br />
&nbsp;&nbsp;&nbsp;protected:<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;long&nbsp;_BufSize,&nbsp;_First,&nbsp;_Count;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;char&nbsp;far&nbsp;*_Buffer;<br />
&nbsp;};<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//-----------------------------------------------------------------//<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;To&nbsp;use&nbsp;TComm32,&nbsp;The&nbsp;message&nbsp;WM_COMMNOTIFY&nbsp;must&nbsp;be&nbsp;processed&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;in&nbsp;the&nbsp;user's&nbsp;window&nbsp;as&nbsp;following:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//-----------------------------------------------------------------//<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;EV_MESSAGE(WM_COMMNOTIFY,&nbsp;EvCommNotify),&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;LRESULT&nbsp;TUserWindow::EvCommNotify(WPARAM&nbsp;wParam,&nbsp;LPARAM&nbsp;lParam)&nbsp;//<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;&nbsp;&nbsp;&nbsp;((TComm32&nbsp;*)lParam)-&gt;CommNotify(wParam);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;&nbsp;&nbsp;&nbsp;...&nbsp;...&nbsp;//&nbsp;add&nbsp;your&nbsp;code&nbsp;here&nbsp;(bytes&nbsp;received&nbsp;or&nbsp;transed)&nbsp;&nbsp;&nbsp;&nbsp;//<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;true;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//-----------------------------------------------------------------//<br />
<br />
class&nbsp;TComm32<br />
&nbsp;{<br />
&nbsp;&nbsp;&nbsp;public:<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TComm32(TWindow&nbsp;*Win);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;virtual&nbsp;~TComm32();<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;virtual&nbsp;int&nbsp;SetPort(int&nbsp;COMn);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;virtual&nbsp;int&nbsp;SetParams(DWORD&nbsp;Baud,&nbsp;BYTE&nbsp;Parity,&nbsp;BYTE&nbsp;ByteSize,&nbsp;BYTE&nbsp;StopBits);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;virtual&nbsp;int&nbsp;SetBufSize(long&nbsp;InBufSize,&nbsp;long&nbsp;OutBufSize,&nbsp;long&nbsp;HwInSize,&nbsp;long&nbsp;HwOutSize);<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;virtual&nbsp;int&nbsp;Open(void);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;virtual&nbsp;int&nbsp;Close(void);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;virtual&nbsp;int&nbsp;Opened(void)&nbsp;{&nbsp;return&nbsp;Handle!=INVALID_HANDLE_VALUE;&nbsp;}<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;virtual&nbsp;long&nbsp;Read(char&nbsp;far&nbsp;*s,&nbsp;long&nbsp;n=1);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;virtual&nbsp;long&nbsp;Write(char&nbsp;far&nbsp;*s,&nbsp;long&nbsp;n=1);<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;virtual&nbsp;void&nbsp;CommNotify(int&nbsp;NotifyType);&nbsp;//EV_RXCHAR&nbsp;or&nbsp;EV_TXEMPTY<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TCommQueue&nbsp;*InBuf;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TCommQueue&nbsp;*OutBuf;<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TWindow&nbsp;*ComWin;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HANDLE&nbsp;Handle;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//INVALID_HANDLE_VALUE<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HANDLE&nbsp;hRecvEvent;&nbsp;//NULL<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HANDLE&nbsp;hSendEvent;&nbsp;//NULL<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OVERLAPPED&nbsp;read_os;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OVERLAPPED&nbsp;write_os;<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;volatile&nbsp;long&nbsp;CommThreadId;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//-1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;volatile&nbsp;bool&nbsp;RunComThread;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;0<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;volatile&nbsp;bool&nbsp;CommThreadRunning;&nbsp;//&nbsp;0<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;&nbsp;&nbsp;_PortNo;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;long&nbsp;&nbsp;_InBufSize,&nbsp;_OutBufSize,&nbsp;_HwInSize,&nbsp;_HwOutSize;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DWORD&nbsp;_Baud;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BYTE&nbsp;&nbsp;_Parity,&nbsp;_ByteSize,&nbsp;_StopBits;<br />
&nbsp;};<br />
<br />
//============================================================================//<br />
//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TCommQueue&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//<br />
//============================================================================//<br />
TCommQueue::TCommQueue(long&nbsp;BufSize)<br />
&nbsp;{<br />
&nbsp;&nbsp
2000
;&nbsp;_BufSize&nbsp;=&nbsp;BufSize;<br />
&nbsp;&nbsp;&nbsp;_First&nbsp;&nbsp;&nbsp;=&nbsp;0;<br />
&nbsp;&nbsp;&nbsp;_Count&nbsp;&nbsp;&nbsp;=&nbsp;0;<br />
&nbsp;&nbsp;&nbsp;_Buffer&nbsp;&nbsp;=&nbsp;(char&nbsp;far&nbsp;*)malloc(_BufSize);<br />
&nbsp;}<br />
<br />
TCommQueue::~TCommQueue()<br />
&nbsp;{<br />
&nbsp;&nbsp;&nbsp;if(_Buffer)<br />
&nbsp;&nbsp;&nbsp;&nbsp;{<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;free(_Buffer);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_Buffer=0;<br />
&nbsp;&nbsp;&nbsp;&nbsp;}<br />
&nbsp;}<br />
<br />
long&nbsp;TCommQueue::In(char&nbsp;far&nbsp;*c,&nbsp;long&nbsp;n)<br />
&nbsp;{<br />
&nbsp;&nbsp;&nbsp;if(_Buffer)<br />
&nbsp;&nbsp;&nbsp;&nbsp;{<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;long&nbsp;i,&nbsp;k,&nbsp;i0;<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i0=(_First+_Count)%_BufSize;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if((i=_BufSize-_Count)&gt;n)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i=n;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if((k=i0+i-_BufSize)&lt;0)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;k=0;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i-=k;<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(c)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;memcpy(_Buffer+i0,&nbsp;c,&nbsp;i);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;memcpy(_Buffer,&nbsp;&nbsp;c+i,&nbsp;k);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_Count+=i+k;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;i+k;<br />
&nbsp;&nbsp;&nbsp;&nbsp;}<br />
<br />
&nbsp;&nbsp;&nbsp;return&nbsp;0;<br />
&nbsp;}<br />
<br />
long&nbsp;TCommQueue::Out(char&nbsp;far&nbsp;*c,&nbsp;long&nbsp;n)<br />
&nbsp;{<br />
&nbsp;&nbsp;&nbsp;if(_Buffer)<br />
&nbsp;&nbsp;&nbsp;&nbsp;{<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;long&nbsp;i,&nbsp;k;<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if((i=_Count)&gt;n)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i=n;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if((k=_First+i-_BufSize)&lt;0)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;k=0;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i-=k;<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(c)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;memcpy(c&nbsp;&nbsp;,&nbsp;_Buffer+_First,&nbsp;i);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;memcpy(c+i,&nbsp;_Buffer&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;,&nbsp;k);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_Count-=i+k;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_First+=i+k;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_First%=_BufSize;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;i+k;<br />
&nbsp;&nbsp;&nbsp;&nbsp;}<br />
<br />
&nbsp;&nbsp;&nbsp;return&nbsp;0;<br />
&nbsp;}<br />
<br />
long&nbsp;TCommQueue::Read(char&nbsp;far&nbsp;*c,&nbsp;long&nbsp;n,&nbsp;long&nbsp;Offs)<br />
&nbsp;{<br />
&nbsp;&nbsp;&nbsp;if(_Buffer)<br />
&nbsp;&nbsp;&nbsp;&nbsp;{<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if((Offs&gt;=_Count)&nbsp;and&nbsp;&nbsp;and&nbsp;(Offs&lt;0))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;0;<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;long&nbsp;i,&nbsp;k,&nbsp;i0;<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i0=(_First+Offs)%_BufSize;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if((i=_Count-Offs)&gt;n)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i=n;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if((k=i0+i-_BufSize)&lt;0)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;k=0;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i-=k;<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(c)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;memcpy(c&nbsp;&nbsp;,&nbsp;_Buffer+i0,&nbsp;i);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;memcpy(c+i,&nbsp;_Buffer&nbsp;&nbsp;&nbsp;,&nbsp;k);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;i+k;<br />
&nbsp;&nbsp;&nbsp;&nbsp;}<br />
<br />
&nbsp;&nbsp;&nbsp;return&nbsp;0;<br />
&nbsp;}<br />
<br />
//============================================================================//<br />
//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TComm32&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//<br />
//============================================================================//<br />
void&nbsp;_Comm32_CommWatchThread(void&nbsp;*Param)<br />
&nbsp;{<br />
&nbsp;&nbsp;&nbsp;OVERLAPPED&nbsp;os;<br />
&nbsp;&nbsp;&nbsp;DWORD&nbsp;dwTransfer,&nbsp;dwEvtMask;<br />
&nbsp;&nbsp;&nbsp;TComm32&nbsp;*Comm&nbsp;=&nbsp;(TComm32&nbsp;*)&nbsp;Param;<br />
&nbsp;&nbsp;&nbsp;Comm-&gt;CommThreadRunning&nbsp;=&nbsp;1;<br />
<br />
&nbsp;&nbsp;&nbsp;os.hEvent&nbsp;=&nbsp;CreateEvent(NULL,&nbsp;true,&nbsp;false,&nbsp;NULL);<br />
&nbsp;&nbsp;&nbsp;if(os.hEvent)<br />
&nbsp;&nbsp;&nbsp;&nbsp;{<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(SetCommMask(Comm-&gt;Handle,&nbsp;EV_RXCHAR&nbsp;and&nbsp;EV_TXEMPTY))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while(Comm-&gt;RunComThread)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dwEvtMask&nbsp;=&nbsp;0;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!WaitCommEvent(Comm-&gt;Handle,&nbsp;&amp;dwEvtMask,&nbsp;&amp;os))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(GetLastError()&nbsp;==&nbsp;ERROR_IO_PENDING)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GetOverlappedResult(Comm-&gt;Handle,&nbsp;&amp;os,&nbsp;&amp;dwTransfer,&nbsp;true);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(dwEvtMask&nbsp;&amp;&nbsp;EV_RXCHAR)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WaitForSingleObject(Comm-&gt;hRecvEvent,&nbsp;0xffffffff);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ResetEvent(Comm-&gt;hRecvEvent);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Comm-&gt;ComWin-&gt;PostMessage(WM_COMMNOTIFY,&nbsp;EV_RXCHAR,&nbsp;(LPARAM)Param);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(dwEvtMask&nbsp;&amp;&nbsp;EV_TXEMPTY)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WaitForSingleObject(Comm-&gt;hSendEvent,&nbsp;0xffffffff);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ResetEvent(Comm-&gt;hSendEvent);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Comm-&gt;ComWin-&gt;PostMessage(WM_COMMNOTIFY,&nbsp;EV_TXEMPTY,&nbsp;(LPARAM)Param);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nb
2000
sp;}<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CloseHandle(os.hEvent);<br />
&nbsp;&nbsp;&nbsp;&nbsp;}<br />
<br />
&nbsp;&nbsp;&nbsp;Comm-&gt;CommThreadRunning&nbsp;=&nbsp;0;<br />
&nbsp;&nbsp;&nbsp;_endthread();<br />
&nbsp;}<br />
<br />
TComm32::TComm32(TWindow&nbsp;*Win)<br />
&nbsp;{<br />
&nbsp;&nbsp;&nbsp;InBuf&nbsp;&nbsp;=&nbsp;NULL;<br />
&nbsp;&nbsp;&nbsp;OutBuf&nbsp;=&nbsp;NULL;<br />
<br />
&nbsp;&nbsp;&nbsp;ComWin&nbsp;&nbsp;=&nbsp;Win;<br />
&nbsp;&nbsp;&nbsp;Handle&nbsp;&nbsp;=&nbsp;INVALID_HANDLE_VALUE;<br />
<br />
&nbsp;&nbsp;&nbsp;hRecvEvent&nbsp;=&nbsp;NULL;<br />
&nbsp;&nbsp;&nbsp;hSendEvent&nbsp;=&nbsp;NULL;<br />
<br />
&nbsp;&nbsp;&nbsp;memset(&amp;read_os,&nbsp;0,&nbsp;sizeof(OVERLAPPED));<br />
&nbsp;&nbsp;&nbsp;memset(&amp;write_os,&nbsp;0,&nbsp;sizeof(OVERLAPPED));<br />
<br />
&nbsp;&nbsp;&nbsp;CommThreadId&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;-1;<br />
&nbsp;&nbsp;&nbsp;RunComThread&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;0;<br />
&nbsp;&nbsp;&nbsp;CommThreadRunning&nbsp;=&nbsp;&nbsp;0;<br />
<br />
&nbsp;&nbsp;&nbsp;_PortNo&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;2;&nbsp;&nbsp;&nbsp;&nbsp;//"COM2"<br />
<br />
&nbsp;&nbsp;&nbsp;_InBufSize&nbsp;&nbsp;=&nbsp;8192;<br />
&nbsp;&nbsp;&nbsp;_OutBufSize&nbsp;=&nbsp;8192;<br />
&nbsp;&nbsp;&nbsp;_HwInSize&nbsp;&nbsp;&nbsp;=&nbsp;1200;<br />
&nbsp;&nbsp;&nbsp;_HwOutSize&nbsp;&nbsp;=&nbsp;1200;<br />
<br />
&nbsp;&nbsp;&nbsp;_Baud&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;CBR_9600;<br />
&nbsp;&nbsp;&nbsp;_Parity&nbsp;&nbsp;&nbsp;=&nbsp;NOPARITY;<br />
&nbsp;&nbsp;&nbsp;_ByteSize&nbsp;=&nbsp;8;<br />
&nbsp;&nbsp;&nbsp;_StopBits&nbsp;=&nbsp;ONESTOPBIT;<br />
&nbsp;}<br />
<br />
TComm32::~TComm32()<br />
&nbsp;{<br />
&nbsp;&nbsp;&nbsp;Close();<br />
&nbsp;}<br />
<br />
int&nbsp;TComm32::SetPort(int&nbsp;COMn)<br />
&nbsp;{<br />
&nbsp;&nbsp;&nbsp;bool&nbsp;NeedReopen&nbsp;=&nbsp;Opened();<br />
&nbsp;&nbsp;&nbsp;int&nbsp;&nbsp;Err&nbsp;=&nbsp;0;<br />
<br />
&nbsp;&nbsp;&nbsp;if(NeedReopen)<br />
&nbsp;&nbsp;&nbsp;&nbsp;if((Err=Close())!=0)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;-Err;<br />
<br />
&nbsp;&nbsp;&nbsp;_PortNo&nbsp;=&nbsp;COMn;<br />
<br />
&nbsp;&nbsp;&nbsp;if(NeedReopen)<br />
&nbsp;&nbsp;&nbsp;&nbsp;if((Err=Open())!=0)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Err;<br />
<br />
&nbsp;&nbsp;&nbsp;return&nbsp;Err;<br />
&nbsp;}<br />
<br />
int&nbsp;TComm32::SetParams(DWORD&nbsp;Baud,&nbsp;BYTE&nbsp;Parity,&nbsp;BYTE&nbsp;ByteSize,&nbsp;BYTE&nbsp;StopBits)<br />
&nbsp;{<br />
&nbsp;&nbsp;&nbsp;bool&nbsp;NeedReopen&nbsp;=&nbsp;Opened();<br />
&nbsp;&nbsp;&nbsp;int&nbsp;&nbsp;Err&nbsp;=&nbsp;0;<br />
<br />
&nbsp;&nbsp;&nbsp;if(NeedReopen)<br />
&nbsp;&nbsp;&nbsp;&nbsp;if((Err=Close())!=0)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;-Err;<br />
<br />
&nbsp;&nbsp;&nbsp;_Baud&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;Baud&nbsp;&nbsp;&nbsp;&nbsp;;<br />
&nbsp;&nbsp;&nbsp;_Parity&nbsp;&nbsp;&nbsp;=&nbsp;Parity&nbsp;&nbsp;;<br />
&nbsp;&nbsp;&nbsp;_ByteSize&nbsp;=&nbsp;ByteSize;<br />
&nbsp;&nbsp;&nbsp;_StopBits&nbsp;=&nbsp;StopBits;<br />
<br />
&nbsp;&nbsp;&nbsp;if(NeedReopen)<br />
&nbsp;&nbsp;&nbsp;&nbsp;if((Err=Open())!=0)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Err;<br />
<br />
&nbsp;&nbsp;&nbsp;return&nbsp;Err;<br />
&nbsp;}<br />
<br />
int&nbsp;TComm32::SetBufSize(long&nbsp;InBufSize,&nbsp;long&nbsp;OutBufSize,&nbsp;long&nbsp;HwInSize,&nbsp;long&nbsp;HwOutSize)<br />
&nbsp;{<br />
&nbsp;&nbsp;&nbsp;bool&nbsp;NeedReopen&nbsp;=&nbsp;Opened();<br />
&nbsp;&nbsp;&nbsp;int&nbsp;&nbsp;Err&nbsp;=&nbsp;0;<br />
<br />
&nbsp;&nbsp;&nbsp;if(NeedReopen)<br />
&nbsp;&nbsp;&nbsp;&nbsp;if((Err=Close())!=0)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;-Err;<br />
<br />
&nbsp;&nbsp;&nbsp;_InBufSize&nbsp;&nbsp;=&nbsp;InBufSize&nbsp;;<br />
&nbsp;&nbsp;&nbsp;_OutBufSize&nbsp;=&nbsp;OutBufSize;<br />
&nbsp;&nbsp;&nbsp;_HwInSize&nbsp;&nbsp;&nbsp;=&nbsp;HwInSize&nbsp;&nbsp;;<br />
&nbsp;&nbsp;&nbsp;_HwOutSize&nbsp;&nbsp;=&nbsp;HwOutSize&nbsp;;<br />
<br />
&nbsp;&nbsp;&nbsp;if(NeedReopen)<br />
&nbsp;&nbsp;&nbsp;&nbsp;if((Err=Open())!=0)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;Err;<br />
<br />
&nbsp;&nbsp;&nbsp;return&nbsp;Err;<br />
&nbsp;}<br />
<br />
int&nbsp;TComm32::Open(void)<br />
&nbsp;{<br />
&nbsp;&nbsp;&nbsp;int&nbsp;Err&nbsp;=&nbsp;0;<br />
<br />
&nbsp;&nbsp;&nbsp;if(!Opened())<br />
&nbsp;&nbsp;&nbsp;&nbsp;{<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DCB&nbsp;&nbsp;dcb;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;char&nbsp;Fmt_COMn[]&nbsp;=&nbsp;"COM%d";<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;char&nbsp;Str[64];<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!Err)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;InBuf&nbsp;=&nbsp;new&nbsp;TCommQueue(_InBufSize);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!InBuf-&gt;Valid())<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Err=-1;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!Err)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OutBuf&nbsp;=&nbsp;new&nbsp;TCommQueue(_OutBufSize);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!OutBuf-&gt;Valid())<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Err=-2;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!Err)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sprintf(Str,&nbsp;Fmt_COMn,&nbsp;_PortNo);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Handle=CreateFile(Str,&nbsp;GENERIC_READ&nbsp;and&nbsp;GENERIC_WRITE,&nbsp;0,&nbsp;NULL,&nbsp;OPEN_EXISTING,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FILE_ATTRIBUTE_NORMAL&nbsp;and&nbsp;FILE_FLAG_OVERLAPPED,&nbsp;NULL);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(Handle==INVALID_HANDLE_VALUE)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Err=-3;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!Err)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!SetCommMask(Handle,&nbsp;EV_RXFLAG))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Err=-4;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!Err)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!SetupComm(Handle,&nbsp;_HwInSize,&nbsp;_HwOutSize))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Err=-5;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!Err)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(GetCommState(Handle,&nbsp;&amp;dcb))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dcb.BaudRate&nbsp;=&nbsp;_Baud;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dcb.ByteSize&nbsp;=&nbsp;_ByteSize;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dcb.Parity&nbsp;&nbsp;&nbsp;=&nbsp;_Parity;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dcb.StopBits&nbsp;=&nbsp;_StopBits;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!SetCommState(Handle,&nbsp;&amp;dcb))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Err&nbsp;=&nbsp;-7;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else<br />
&nbsp;&nbsp
2000
;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Err&nbsp;=&nbsp;-6;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!Err)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;memset(&amp;read_os,&nbsp;0,&nbsp;sizeof(OVERLAPPED));<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hRecvEvent=CreateEvent(NULL,true,true,NULL);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;read_os.hEvent=CreateEvent(NULL,true,false,NULL);<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if((!hRecvEvent)&nbsp;&nbsp;and&nbsp;&nbsp;and&nbsp;&nbsp;(!read_os.hEvent))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Err=-8;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!Err)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;memset(&amp;write_os,&nbsp;0,&nbsp;sizeof(OVERLAPPED));<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hSendEvent=CreateEvent(NULL,true,true,NULL);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;write_os.hEvent=CreateEvent(NULL,true,false,NULL);<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if((!hSendEvent)&nbsp;&nbsp;and&nbsp;&nbsp;and&nbsp;&nbsp;(!write_os.hEvent))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Err=-9;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!Err)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RunComThread&nbsp;=&nbsp;1;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CommThreadId&nbsp;=&nbsp;_beginthread(_Comm32_CommWatchThread,&nbsp;4096,&nbsp;this);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(CommThreadId&nbsp;==&nbsp;-1)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RunComThread&nbsp;=&nbsp;0;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Err&nbsp;=&nbsp;-10;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(Err)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Close();<br />
&nbsp;&nbsp;&nbsp;&nbsp;}<br />
<br />
&nbsp;&nbsp;&nbsp;return&nbsp;Err;<br />
&nbsp;}<br />
<br />
int&nbsp;TComm32::Close(void)<br />
&nbsp;{<br />
&nbsp;&nbsp;&nbsp;int&nbsp;i,&nbsp;Err&nbsp;=&nbsp;0;<br />
<br />
&nbsp;&nbsp;&nbsp;if(Opened())<br />
&nbsp;&nbsp;&nbsp;&nbsp;for(i=0;&nbsp;(CommThreadRunning)&nbsp;&amp;&amp;&nbsp;(i&lt;100);&nbsp;i++)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RunComThread&nbsp;=&nbsp;0;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SetCommMask(Handle,&nbsp;EV_RXFLAG);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Sleep(10);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />
&nbsp;&nbsp;&nbsp;if(CommThreadRunning)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Err=-1;<br />
&nbsp;&nbsp;&nbsp;else<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CommThreadId=-1;<br />
<br />
&nbsp;&nbsp;&nbsp;if(hRecvEvent)<br />
&nbsp;&nbsp;&nbsp;&nbsp;{<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CloseHandle(hRecvEvent);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hRecvEvent&nbsp;=&nbsp;NULL;<br />
&nbsp;&nbsp;&nbsp;&nbsp;}<br />
<br />
&nbsp;&nbsp;&nbsp;if(read_os.hEvent)<br />
&nbsp;&nbsp;&nbsp;&nbsp;{<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CloseHandle(read_os.hEvent);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;memset(&amp;read_os,&nbsp;0,&nbsp;sizeof(OVERLAPPED));<br />
&nbsp;&nbsp;&nbsp;&nbsp;}<br />
<br />
&nbsp;&nbsp;&nbsp;if(hSendEvent)<br />
&nbsp;&nbsp;&nbsp;&nbsp;{<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CloseHandle(hSendEvent);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hSendEvent&nbsp;=&nbsp;NULL;<br />
&nbsp;&nbsp;&nbsp;&nbsp;}<br />
<br />
&nbsp;&nbsp;&nbsp;if(write_os.hEvent)<br />
&nbsp;&nbsp;&nbsp;&nbsp;{<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CloseHandle(write_os.hEvent);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;memset(&amp;write_os,&nbsp;0,&nbsp;sizeof(OVERLAPPED));<br />
&nbsp;&nbsp;&nbsp;&nbsp;}<br />
<br />
&nbsp;&nbsp;&nbsp;if(Handle!=INVALID_HANDLE_VALUE)<br />
&nbsp;&nbsp;&nbsp;&nbsp;{<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CloseHandle(Handle);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Handle=INVALID_HANDLE_VALUE;<br />
&nbsp;&nbsp;&nbsp;&nbsp;}<br />
<br />
&nbsp;&nbsp;&nbsp;if(OutBuf)<br />
&nbsp;&nbsp;&nbsp;&nbsp;{<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;delete&nbsp;OutBuf;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OutBuf&nbsp;=&nbsp;NULL;<br />
&nbsp;&nbsp;&nbsp;&nbsp;}<br />
<br />
&nbsp;&nbsp;&nbsp;if(InBuf)<br />
&nbsp;&nbsp;&nbsp;&nbsp;{<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;delete&nbsp;InBuf;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;InBuf&nbsp;=&nbsp;NULL;<br />
&nbsp;&nbsp;&nbsp;&nbsp;}<br />
<br />
&nbsp;&nbsp;&nbsp;return&nbsp;Err;<br />
&nbsp;}<br />
<br />
long&nbsp;TComm32::Read(char&nbsp;far&nbsp;*s,&nbsp;long&nbsp;n)<br />
&nbsp;{<br />
&nbsp;&nbsp;&nbsp;return&nbsp;InBuf-&gt;Out(s,n);<br />
&nbsp;}<br />
<br />
long&nbsp;TComm32::Write(char&nbsp;far&nbsp;*s,&nbsp;long&nbsp;n)<br />
&nbsp;{<br />
&nbsp;&nbsp;&nbsp;long&nbsp;Retv&nbsp;=&nbsp;OutBuf-&gt;In(s,n);<br />
&nbsp;&nbsp;&nbsp;ComWin-&gt;PostMessage(WM_COMMNOTIFY,&nbsp;EV_TXEMPTY,&nbsp;(LPARAM)this);<br />
&nbsp;&nbsp;&nbsp;return&nbsp;Retv;<br />
&nbsp;}<br />
<br />
void&nbsp;TComm32::CommNotify(int&nbsp;NotifyType)<br />
&nbsp;{<br />
&nbsp;&nbsp;&nbsp;if(NotifyType&nbsp;&amp;&nbsp;EV_RXCHAR)<br />
&nbsp;&nbsp;&nbsp;&nbsp;{<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DWORD&nbsp;&nbsp;&nbsp;dwErrorFlag,&nbsp;dwLen,&nbsp;dwBytesRd;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;COMSTAT&nbsp;ComStat;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;char&nbsp;RecvBuf[4096];<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ClearCommError(Handle,&nbsp;&amp;dwErrorFlag,&nbsp;&amp;ComStat);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dwLen=ComStat.cbInQue;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(dwLen&gt;0)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(!ReadFile(Handle,&nbsp;RecvBuf,&nbsp;dwLen,&nbsp;&amp;dwBytesRd,&nbsp;&amp;read_os))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(GetLastError()==ERROR_IO_PENDING)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(WaitForSingleObject(read_os.hEvent,&nbsp;1000))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;if(dwBytesRd&gt;0)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;InBuf-&gt;In(RecvBuf,&nbsp;dwBytesRd);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SetEvent(hRecvEvent);<br />
&nbsp;&nbsp;&nbsp;&nbsp;}<br />
<br />
&nbsp;&nbsp;&nbsp;if(NotifyType&nbsp;&amp;&nbsp;EV_TXEMPTY)<br />
&nbsp;&nbsp;&nbsp;&nbsp;{<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DWORD&nbsp;&nbsp;&nbsp;dwErrorFlag,&nbsp;dwLen,&nbsp;dwBytesWr;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;COMSTAT&nbsp;ComStat;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;char&nbsp;SendBuf[4096];<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ClearCommError(Handle,&nbsp;&amp;dwErrorFlag,&nbsp;&amp;ComStat);<br />
&nbsp;&nbsp;
1000
&nbsp;&nbsp;&nbsp;&nbsp;dwLen=ComStat.cbOutQue;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(dwLen==0)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(OutBuf-&gt;Count())<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dwLen=OutBuf-&gt;Out(SendBuf,&nbsp;4096);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WriteFile(Handle,&nbsp;SendBuf,&nbsp;dwLen,&nbsp;&amp;dwBytesWr,&nbsp;&amp;write_os);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SetEvent(hSendEvent);<br />
&nbsp;&nbsp;&nbsp;&nbsp;}<br />
&nbsp;}<br />
<br />

        </div>

      </td>
    </tr>
    <tr>
      <td valign="bottom">
          <div class="control">
    <div id='post-forum-bulletin-7'  class='fl'>
    </div>
  <div class="fr">
    <a href="/posts/495070/digg?topic_id=1198" class="red digg" data-method="put" data-remote="true" rel="nofollow">对我有用[0]</a>
    <a href="/posts/495070/bury?topic_id=1198" class="bury" data-method="put" data-remote="true" rel="nofollow">丢个板砖[0]</a>
    <a href="#quote" class="quote">引用</a> |
    <a href="/posts/495070/report?topic_id=1198" class="fancybox red" rel="nofollow">举报 </a> |
    <span class="manage-toggle">
      <div class="manage" style="display: none;">
          <a href="/posts/495070/edit" class="fancybox" rel="nofollow">编辑</a>
          <a href="/posts/495070/destroy_edit" class="fancybox" rel="nofollow">删除</a>
      </div>
      管理
    </span>
  </div>
</div>

      </td>
  </tr>
</table>

</div>
<div class="control_area">
  <form name="form" id="form">
    
    <div class="control">
      <ul>
        <li class="drop_menu_wrap drop_menu_up"><a href="#" class="drop_toggle drop_toggle_up btn_1"><span><img src="/assets/ico_set.gif" alt="" />管理菜单<img src="/assets/arrow_down.gif" alt="" /></span></a>
        <ul class="drop_menu" style="display: none; bottom:26px;">
            <li><a href="/topics/1198/top" class="fancybox" rel="nofollow">置顶</a></li>

  <li><a href="/topics/1198/recommend" data-confirm="确定要将该帖推荐(加精)吗？被推荐的帖子将给帖主奖励可用分88分!" data-method="put" rel="nofollow">推荐</a></li>

  <li><a href="/topics/1198/lock" class="fancybox" rel="nofollow">锁定</a></li>

<li><a href="/topics/1198/move" class="fancybox" rel="nofollow">移动</a></li>
<li><a href="/topics/1198/edit" class="fancybox" rel="nofollow">编辑</a></li>
<li><a href="/topics/1198/destroy_edit" class="fancybox" rel="nofollow">删除</a></li>
<li><a href="/topics/1198/add_point" class="fancybox" rel="nofollow">帖子加分</a></li>
  <li><a href="/topics/1198/highlight" class="fancybox" rel="nofollow">帖子高亮</a></li>

        </ul>
        </li>
        <li><a href="/topics/1198/close" class="btn_1"><span><img src="/assets/ico_over.gif" alt="" />结帖</span></a></li>
        <li><a href="/topics/new?forum_id=BCBBase" class="btn_1"><span><img src="/assets/ico_publish.gif" alt="" />发帖</span></a></li>
        <li><a href="#new_post" class="btn_1"><span><img src="/assets/ico_return.gif" alt="" />回复</span></a></li>
      </ul>
    </div>
  </form>
</div>

<div class="comt">
  <div class="ad_l">
    <!-- 回复框文字 (D6) -->
    <ul><li><a href="http://g.csdn.net/5243760" target="_blank">【招】应届生,入职年薪5-10万</a></li><li><a href="http://g.csdn.net/5246043" target="_blank">市面上最出色的刀片式服务器</a></li><li><a href="http://g.csdn.net/5245460" target="_blank">IBM 以高效设计为灵魂</a></li><li><a href="http://g.csdn.net/5239181" target="_blank">首届携程大赛开始报名啦</a></li></ul>
    <ul>
        <li><a href="http://club.csdn.net/cmdn/bbs/topic/7282" class="title_style_black" target="_blank">台湾程序员游戏开发经历</a></li>
        <li><a href="http://g.csdn.n
b7c
et/5243630" class="title_style_black" target="_blank">陈勇- 敏捷开发现状及发展之路</a></li>
        <li><a href="http://bbs.csdn.net/topics/390399592" class="title_style_black" target="_blank">分享你的发现 赢下载积分</a></li>
    </ul>
    <div class="ad_new" style='padding: 0 0 50px 0'>
      <h4><img alt="" src="http://csdnimg.cn/www/images/csdn_logo_blue.gif"></h4>
      <p class='title'>
      <a href="http://bbs.csdn.net/topics/390397080" target="_blank">微软MVP申请</a>
      </p>
      <p class='con'>
      <a href="http://bbs.csdn.net/topics/390397080" target="_blank">CSDN与微软合作，长期为用户提供申请“微软最有价值专家”的平台，希望大家积极参与。</a>
      </p>
    </div>
  </div>
  <div class="reply">
      <h3>本帖子已过去太久远了，不再提供回复功能。</h3>
  </div>
</div>



<!-- 对联广告 -->
<div id="ad_left" style="position:absolute;width:120px;top:184px;left:10px;display:none">
  <a style="float:right;" href="#" onclick="javascript:this.parentNode.style.display='none';return false;">[关闭]</a>
  <iframe src="/sda/TopicDaLeft.htm?v201203051313" frameborder="0" height="600" width="120" scrolling="no"></iframe>
</div>
<div id="ad_right" style="position:absolute;width:120px;top:184px;right:10px;display:none">
  <a style="float:left;" href="#" onclick="javascript:this.parentNode.style.display='none';return false;">[关闭]</a>
  <iframe src="/sda/TopicDaRight.htm?v201203051313" frameborder="0" height="600" width="120" scrolling="no"></iframe>
</div>



      <script type="text/javascript" src="http://csdnimg.cn/pubfooter/js/publib_footer.js"></script>
<script type="text/javascript" src="http://www.csdn.net/ui/scripts/Csdn/counter.js"></script>
<script type="text/javascript" src="http://csdnimg.cn/pig/pubjs/cnick.js"></script>

      <img alt="Top_arrow" class="top_arrow" id="top_arrow" src="http://news.csdn.net//images/top_arrow.png" />
    </div>
    <script type="text/javascript" language="javascript" charset="utf-8">
//<![CDATA[
$(function(){
  topics_page_js.show_page();
    var bulletin_link = '<a href="http://blog.csdn.net/csdn_ask/article/details/8751993" class="title_style_blue title_style_bold" target="_blank">CSDN问答频道3月声望排行榜出炉</a>'
    $('#post-forum-bulletin-1').html(bulletin_link);
    var bulletin_link = '<a href="http://e.weibo.com/csdnsupport" class="title_style_red title_style_bold" target="_blank">欢迎关注CSDN产品客服微博</a>'
    $('#post-forum-bulletin-2').html(bulletin_link);
    var bulletin_link = '<a href="http://download.csdn.net/detail/aa10531239/5231705" class="title_style_red title_style_bold" target="_blank">【免费】全新海外营销策论分享 </a>'
    $('#post-forum-bulletin-3').html(bulletin_link);
});
//]]>
</script>
<script type="text/javascript" src="http://ad.csdn.net/scripts/ad-bbs.js"></script>

  </body>
</html>

0


url:bbs.csdn.net/topics/1199
HTTP/1.1 200 OK
Content-Type: text/html; charset=utf-8
Transfer-Encoding: chunked
Connection: close
Vary: Accept-Encoding
Status: 200
X-Powered-By: Phusion Passenger (mod_rails/mod_rack)
ETag: "bd42f54aaffbea5a5e9ad64a5a4560c7"
Cache-Control: max-age=0, private, must-revalidate
Set-Cookie: _csdn_newbbs_session=BAh7B0kiD3Nlc3Npb25faWQGOgZFRkkiJTM4YzJhZjk4Yjc3MTcyMmY4MDM0ZmEwYzE1ZmI2ZWNjBjsAVEkiEF9jc3JmX3Rva2VuBjsARkkiMXhQZmNPVEtIVnA5MllFQU1BYWoySXJnSURxcG4rRXJxVUVHb0hKeVRhMmM9BjsARg%3D%3D--562bea302588a4f6ccb88964e9203c91604c5764; path=/; HttpOnly
Server: nginx/1.2.4 + Phusion Passenger (mod_rails/mod_rack)
X-UA-Compatible: IE=Edge,chrome=1

1e11
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>如何将 C 语言声明转换为 PB 声明 - CSDN论坛 - CSDN.NET</title>
    <link href="/assets/main-c65d6b72001ff03e3698df226a4e4ffe.css" media="screen" rel="stylesheet" type="text/css" />
    <script src="/assets/application-e72cd54f9ebb368ac82561934f7b9c72.js" type="text/javascript"></script>
    <meta content="authenticity_token" name="csrf-param" />
<meta content="xPfcOTKHVp92YEAMAaj2IrgIDqpn+ErqUEGoHJyTa2c=" name="csrf-token" />
    <link href="http://csdnimg.cn/www/images/favicon.ico" rel="SHORTCUT ICON">

      <link href="/assets/sh-2bfcf65754f6d04d58df6ed87a3b6faf.css" media="all" rel="stylesheet" type="text/css" />
  <script src="/assets/sh-d778121d099d6e5ed8bb7ce42824a371.js" type="text/javascript"></script>
  <script src="http://passport.csdn.net/content/loginbox/login.js" type="text/javascript"></script>

  </head>
  <body>
    <div class="wraper">
      <script type="text/javascript" src="http://csdnimg.cn/pubnav/js/pub_topnav_2011.js"></script>

        <!-- 页顶通栏 -->
  <iframe id="Topic_Top" marginwidth="0" marginheight="0" frameborder="0" scrolling="no" width="100%" src="/sda/TopicPageTop.htm"></iframe>

      <div id="nav">
        <a href="/" class="logo" target="_top"></a>
        <div class="nav_list">
          <a href="/home" title="CSDN论坛首页" class="home">首页</a><a href="/help" class=""><span>论坛帮助</span></a><a href="/rank" class=""><span>论坛牛人</span></a><a href="/map" class=""><span>论坛地图</span></a>
        </div>

        <div class="nav_sear">
          <form action="http://so.csdn.net/search" target="_blank">
            <input name="t" type="hidden" value="thread" />
            <input name="q" type="text" />
          </form>
        </div>
      </div>
      <!--[if IE]>
<style type="text/css" media="screen">
.control_area .control .drop_menu{border:3px solid #ccc \9; _*border:3px solid #ccc;}
</style>
<![endif]-->

  <!-- 页顶Button (D3) -->
  <iframe id="frm_tt1" marginwidth="0" marginheight="0" frameborder="0" scrolling="no" width="100%" src="/sda/TopicBodyTop.htm?v=1"></iframe>
  <script type="text/javascript">
    setTimeout(function () { document.getElementById("frm_tt1").src = "/sda/TopicBodyTop.htm?v="+new Date().getTime(); }, 5000);
  </script>

<div class="bread_nav">
  <a href="http://www.csdn.net" target="_blank">CSDN</a> <em>&gt;</em>
  <a href="/" target="_blank">CSDN论坛</a> <em>&gt;</em>
    <a href="/forums/PowerBuilder" target="_blank">PowerBuilder</a> <em>&gt;</em>
  <a href="/forums/PB_Basic" target="_blank">基础类</a>
</div>

<div class="flash_messages">
</div>


<div class="control_area">
  <form name="form" id="form">
    
    <div class="control">
      <ul>
        <li class="drop_menu_wrap drop_menu_down"><a href="#" class="drop_toggle btn_1"><span><img src="/assets/ico_set.gif" alt="" />管理菜单<img src="/assets/arrow_down.gif" alt="" /></span></a>
        <ul class="drop_menu" style="display: none; top:26px;">
            <li><a href="/topics/1199/top" class="fancybox" rel="nofollow">置顶</a></li>

  <li><a href="/topics/1199/recommend" data-confirm="确定要将该帖推荐(加精)吗？被推荐的帖子将给帖主奖励可用分88分!" data-method="put" rel="nofollow">推荐</a></li>

  <li><a href="/topics/1199/lock" class="fancybox" rel="nofollow">锁定</a></li>

<li><a href="/topics/1199/move" class="fancybox" rel="nofollow">移动</a></li>
<li><a href="/topics/1199/edit" class="fancybox" rel="nofollow">编辑</a></li>
<li><a href="/topics/1199/destroy_edit" class="fancybox" rel="nofollow">删除</a></li>
<li><a href="/topics/1199/add_point" class="fancybox" rel="nofollow">帖子加分</a></li>
  <li><a href="/topics/1199/highlight" class="fancybox" rel="nofollow">帖子高亮</a></li>

        </ul>
        </li>
        <li><a href="/topics/1199/close" class="btn_1" rel='nofollow'><span><img src="/assets/ico_over.gif" alt="" />结帖</span></a></li>
        <li><a href="/topics/new?forum_id=PB_Basic" class="btn_1"><span><img src="/assets/ico_publish.gif" alt="" />发帖</span></a></li>
        <li><a href="#new_post" class="btn_1"><span><img src="/assets/ico_return.gif" alt="" />回复</span></a></li>
      </ul>
    </div>
  </form>
</div>
<div class="detail_title">
  <h1>
      如何将 C 语言声明转换为 PB 声明
    <span>
      [问题点数：50分，结帖人hbd]
    </span>
  </h1>
  <div class="fr">
    <select name="filter_posts">
      <option value="default">不显示删除回复</option>
      <option value="all">显示所有回复</option>
      <option value="star">显示星级回复</option>
      <option value="pointed">显示得分回复</option>
      <option value="lz">只显示楼主</option>
    </select>
    <a href="http://my.csdn.net/my/favorite/miniadd?u=http://bbs.csdn.net/topics/1199&amp;t=%E5%A6%82%E4%BD%95%E5%B0%86%20C%20%E8%AF%AD%E8%A8%80%E5%A3%B0%E6%98%8E%E8%BD%AC%E6%8D%A2%E4%B8%BA%20PB%20%E5%A3%B0%E6%98%8E" id="fav" class="fav" rel='nofollow'><img src="/assets/nolines_plus.gif" alt="" />收藏</a>
  </div>
</div>
<div class="detailed">
    <table border="0" cellspacing="0" cellpadding="0" id="post-1199" class="post topic " data-post-id="1199" data-is-topic-locked="false">
  <colgroup><col width="180" /><col /></colgroup>
  <tr>
      <td rowspan="2" valign="top" class="wirter">
                <dl class="user_info ">
          <dt class="user_head" data-username="hbd">
            <a href="http://my.csdn.net/hbd" target="_blank"><img alt="hbd" class="avatar" src="http://avatar.profile.csdn.net/3/6/0/1_hbd.jpg" /></a>
          </dt>
          <dd class="username">
            <a href="http://my.csdn.net/hbd" target="_blank">hbd</a>
            
          </dd>
          <dd class="nickname">
            <span class="name2nick">hbd</span>
          </dd>
          <dd title="总技术分：100；总技术排名：128172">等级：<img alt="Blank" class="grade user1" src="/assets/blank.gif" /></dd>
          <dd class="close_rate" title="用户结帖率：100%
总发帖：25
正常结帖：25
未结帖：0">结帖率：100%</dd>
          
        </dl>

      </td>
      <td valign="top" class="post_info topic pointed" data-username="hbd" data-floor="">
                <div class="data">
            <strong class="fr">
              楼主
            </strong>
          <span class="time">
              发表于：
            2000-02-01 12:46:00
          </span>
        </div>
        <div class="post_body">
            要求：<br />
<br />
&nbsp;&nbsp;在PB中传一个文件名到DLL中<br />
<br />
dll&nbsp;中的函数声明<br />
int&nbsp;&nbsp;test(&nbsp;char&nbsp;*filename&nbsp;&nbsp;){<br />
	/*&nbsp;&nbsp;*/<br />
	return&nbsp;1;<br />
}<br />
<br />
pb中的函数声明<br />
FUNCTION&nbsp;&nbsp;&nbsp;int&nbsp;&nbsp;test(&nbsp;&nbsp;string&nbsp;s&nbsp;)&nbsp;LIBRARY&nbsp;"MPEG.DLL"<br />
or<br />
FUNCTION&nbsp;&nbsp;&nbsp;long&nbsp;&nbsp;test(&nbsp;&nbsp;string&nbsp;s&nbsp;)&nbsp;LIBRARY&nbsp;"MPEG.DLL"<br />
<br />
调用错误提示:<br />
错误的参数类型
              <div class="tag ">
              </div>
        </div>
          <!-- 主帖下Banner (D4) -->
          <!-- 主帖下文字 (D5) -->
          <iframe id="tad2" marginwidth="0" marginheight="0" frameborder="0" scrolling="no" width="100%" src="/sda/TopicBodyBottom.htm"></iframe>

      </td>
    </tr>
    <tr>
      <td valign="bottom">
          <div class="control">
  <div class="f
2000
r">
    <a href="/posts/1199/digg?topic_id=1199" class="red digg" data-method="put" data-remote="true" rel="nofollow">对我有用[0]</a>
    <a href="/posts/1199/bury?topic_id=1199" class="bury" data-method="put" data-remote="true" rel="nofollow">丢个板砖[0]</a>
    <a href="#quote" class="quote">引用</a> |
    <a href="/posts/1199/report?topic_id=1199" class="fancybox red" rel="nofollow">举报 </a> |
    <span class="manage-toggle">
      <div class="manage" style="display: none;">
          <a href="/topics/1199/edit" class="fancybox" rel="nofollow">编辑</a>
          <a href="/topics/1199/destroy_edit" class="fancybox" rel="nofollow">删除</a>
      </div>
      管理
    </span>
  </div>
    <span class="return_time">回复次数：2</span>
</div>

      </td>
  </tr>
</table>

  <table border="0" cellspacing="0" cellpadding="0" id="post-493859" class="post  " data-post-id="493859" data-is-topic-locked="false">
  <colgroup><col width="180" /><col /></colgroup>
  <tr>
      <td rowspan="2" valign="top" class="wirter">
                <dl class="user_info ">
          <dt class="user_head" data-username="929">
            <a href="http://my.csdn.net/929" target="_blank"><img alt="929" class="avatar" src="http://avatar.profile.csdn.net/0/D/0/1_929.jpg" /></a>
          </dt>
          <dd class="username">
            <a href="http://my.csdn.net/929" target="_blank">929</a>
            
          </dd>
          <dd class="nickname">
            <span class="name2nick">929</span>
          </dd>
          <dd title="总技术分：7526；总技术排名：3858">等级：<img alt="Blank" class="grade user4" src="/assets/blank.gif" /></dd>
          <dd class="close_rate" title="用户结帖率：100%
总发帖：2
正常结帖：2
未结帖：0">结帖率：100%</dd>
          <div class="medal_jinshi " title="2000年 总版技术专家分年内排行榜第七"></div><div class="medal_gold " title="2000年3月 总版技术专家分月排行榜第一"></div><div class="medal_copper " title="2000年4月 总版技术专家分月排行榜第三"></div><a href="/users/929/medals" class="more_medals" target="_blank">更多勋章</a>
        </dl>

      </td>
      <td valign="top" class="post_info pointed" data-username="929" data-floor="1">
                <div class="data">
            <span class="fr">
              <a href="#post-493859">#1</a>
              得分：50
            </span>
          <span class="time">
              回复于：
            2000-02-01 13:53:00
          </span>
        </div>
        <div class="post_body">
            在PB中调用DLL需要验证DLL的所在目录是否可被程序访问到。访问顺序：当前目录，系统目录，路径中指明的目录。另外，在DLL声明中类型有如下转换：<br />
*&nbsp;(any&nbsp;pointer)&nbsp;32-bit&nbsp;pointer&nbsp;转换为&nbsp;Long<br />
char&nbsp;*&nbsp;转换为PB中的Blob类型。<br />
int&nbsp;转换为PB中的INTEGER(16BIT)&nbsp;OR&nbsp;LONG(32BIT)&nbsp;<br />
也就是说，声明应为：FUNCTION&nbsp;LONG（BLOB&nbsp;S）&nbsp;LIBRARAY&nbsp;"MPEG.DLL"(WINDOWS9X,WINDOWS&nbsp;NT)<br />
其它转换可参照PB&nbsp;ONLINE中关于POWERSCRIPT的参考说明。FIND&nbsp;"DLL"即可。<br />
<br />

        </div>

      </td>
    </tr>
    <tr>
      <td valign="bottom">
          <div class="control">
    <div id='post-forum-bulletin-1'  class='fl'>
    </div>
  <div class="fr">
    <a href="/posts/493859/digg?topic_id=1199" class="red digg" data-method="put" data-remote="true" rel="nofollow">对我有用[0]</a>
    <a href="/posts/493859/bury?topic_id=1199" class="bury" data-method="put" data-remote="true" rel="nofollow">丢个板砖[0]</a>
    <a href="#quote" class="quote">引用</a> |
    <a href="/posts/493859/report?topic_id=1199" class="fancybox red" rel="nofollow">举报 </a> |
    <span class="manage-toggle">
      <div class="manage" style="display: none;">
          <a href="/posts/493859/edit" class="fancybox" rel="nofollow">编辑</a>
          <a href="/posts/493859/destroy_edit" class="fancybox" rel="nofollow">删除</a>
      </div>
      管理
    </span>
  </div>
</div>

      </td>
  </tr>
</table>
<table border="0" cellspacing="0" cellpadding="0" id="post-494382" class="post  " data-post-id="494382" data-is-topic-locked="false">
  <colgroup><col width="180" /><col /></colgroup>
  <tr>
      <td rowspan="2" valign="top" class="wirter">
                <dl class="user_info ">
          <dt class="user_head" data-username="zhangjun">
            <a href="http://my.csdn.net/zhangjun" target="_blank"><img alt="zhangjun" class="avatar" src="http://avatar.profile.csdn.net/5/B/8/1_zhangjun.jpg" /></a>
          </dt>
          <dd class="username">
            <a href="http://my.csdn.net/zhangjun" target="_blank">zhangjun</a>
            
          </dd>
          <dd class="nickname">
            <span class="name2nick">zhangjun</span>
          </dd>
          <dd title="总技术分：45；总技术排名：192941">等级：<img alt="Blank" class="grade user1" src="/assets/blank.gif" /></dd>
          <dd class="close_rate" title="用户结帖率：100%
总发帖：9
正常结帖：9
未结帖：0">结帖率：100%</dd>
          
        </dl>

      </td>
      <td valign="top" class="post_info " data-username="zhangjun" data-floor="2">
                <div class="data">
            <span class="fr">
              <a href="#post-494382">#2</a>
              得分：0
            </span>
          <span class="time">
              回复于：
            2000-02-07 10:31:00
          </span>
        </div>
        <div class="post_body">
            可转换为<br />
FUNCTION&nbsp;int&nbsp;test(&nbsp;ref&nbsp;string&nbsp;s&nbsp;)&nbsp;LIBRARY&nbsp;"MPEG.DLL"
        </div>

      </td>
    </tr>
    <tr>
      <td valign="bottom">
          <div class="control">
    <div id='post-forum-bulletin-2'  class='fl'>
    </div>
  <div class="fr">
    <a href="/posts/494382/digg?topic_id=1199" class="red digg" data-method="put" data-remote="true" rel="nofollow">对我有用[0]</a>
    <a href="/posts/494382/bury?topic_id=1199" class="bury" data-method="put" data-remote="true" rel="nofollow">丢个板砖[0]</a>
    <a href="#quote" class="quote">引用</a> |
    <a href="/posts/494382/report?topic_id=1199" class="fancybox red" rel="nofollow">举报 </a> |
    <span class="manage-toggle">
      <div class="manage" style="display: none;">
          <a href="/posts/494382/edit" class="fancybox" rel="nofollow">编辑</a>
          <a href="/posts/494382/destroy_edit" class="fancybox" rel="nofollow">删除</a>
      </div>
      管理
    </span>
  </div>
</div>

      </td>
  </tr>
</table>

</div>
<div class="control_area">
  <form name="form" id="form">
    
    <div class="control">
      <ul>
        <li class="drop_menu_wrap drop_menu_up"><a href="#" class="drop_toggle drop_toggle_up btn_1"><span><img src="/assets/ico_set.gif" alt="" />管理菜单<img src="/assets/arrow_down.gif" alt="" /></span></a>
        <ul class="drop_menu" style="display: none; bottom:26px;">
            <li><a href="/topics/1199/top" class="fancybox" rel="nofollow">置顶</a></li>

  <li><a href="/topics/1199/recommend" data-confirm="确定要将该帖推荐(加精)吗？被推荐的帖子将给帖主奖励可用分88分!" data-method="put" rel="nofollow">推荐</a></li>

  <li><a href="/topics/1199/lock" class="fancybox" rel="nofollow">锁定</a></li>

<li><a href="/topics/1199/move" class="fancybox" rel="nofollow">移动</a></li>
<li><a href="/topics/1199/edit" class="fancybox" rel="nofollow">编辑</a></li>
<li><a href="/topics/1199/destroy_edit" class="fancybox" rel="nofollow">删除</a></li>
<li><a href="/topics/1199/add_point" class="fancybox" rel="nofollow">帖子加分</a></li>
  <li><a href="/topics/1199/highlight" class="fancybox" rel="nofollow">帖子高亮</a></li>

        </ul>
        </li>
        <li><a href="/topics/1199/close" class="btn_1"><span><img src="/assets/ico_over.gif" alt="" />结帖</span></a></li>
        <li><a href="/topics/new?forum_id=PB_Basic" class="btn_1"><span><img src="/assets/ico_publish.gif" alt
f00
="" />发帖</span></a></li>
        <li><a href="#new_post" class="btn_1"><span><img src="/assets/ico_return.gif" alt="" />回复</span></a></li>
      </ul>
    </div>
  </form>
</div>

<div class="comt">
  <div class="ad_l">
    <!-- 回复框文字 (D6) -->
    <ul><li><a href="http://g.csdn.net/5243760" target="_blank">【招】应届生,入职年薪5-10万</a></li><li><a href="http://g.csdn.net/5246043" target="_blank">市面上最出色的刀片式服务器</a></li><li><a href="http://g.csdn.net/5245460" target="_blank">IBM 以高效设计为灵魂</a></li><li><a href="http://g.csdn.net/5239181" target="_blank">首届携程大赛开始报名啦</a></li></ul>
    <ul>
        <li><a href="http://club.csdn.net/cmdn/bbs/topic/7282" class="title_style_black" target="_blank">台湾程序员游戏开发经历</a></li>
        <li><a href="http://g.csdn.net/5243630" class="title_style_black" target="_blank">陈勇- 敏捷开发现状及发展之路</a></li>
        <li><a href="http://bbs.csdn.net/topics/390399592" class="title_style_black" target="_blank">分享你的发现 赢下载积分</a></li>
    </ul>
    <div class="ad_new" style='padding: 0 0 50px 0'>
      <h4><img alt="" src="http://csdnimg.cn/www/images/csdn_logo_blue.gif"></h4>
      <p class='title'>
      <a href="http://bbs.csdn.net/topics/390397080" target="_blank">微软MVP申请</a>
      </p>
      <p class='con'>
      <a href="http://bbs.csdn.net/topics/390397080" target="_blank">CSDN与微软合作，长期为用户提供申请“微软最有价值专家”的平台，希望大家积极参与。</a>
      </p>
    </div>
  </div>
  <div class="reply">
      <h3>本帖子已过去太久远了，不再提供回复功能。</h3>
  </div>
</div>



<!-- 对联广告 -->
<div id="ad_left" style="position:absolute;width:120px;top:184px;left:10px;display:none">
  <a style="float:right;" href="#" onclick="javascript:this.parentNode.style.display='none';return false;">[关闭]</a>
  <iframe src="/sda/TopicDaLeft.htm?v201203051313" frameborder="0" height="600" width="120" scrolling="no"></iframe>
</div>
<div id="ad_right" style="position:absolute;width:120px;top:184px;right:10px;display:none">
  <a style="float:left;" href="#" onclick="javascript:this.parentNode.style.display='none';return false;">[关闭]</a>
  <iframe src="/sda/TopicDaRight.htm?v201203051313" frameborder="0" height="600" width="120" scrolling="no"></iframe>
</div>



      <script type="text/javascript" src="http://csdnimg.cn/pubfooter/js/publib_footer.js"></script>
<script type="text/javascript" src="http://www.csdn.net/ui/scripts/Csdn/counter.js"></script>
<script type="text/javascript" src="http://csdnimg.cn/pig/pubjs/cnick.js"></script>

      <img alt="Top_arrow" class="top_arrow" id="top_arrow" src="http://news.csdn.net//images/top_arrow.png" />
    </div>
    <script type="text/javascript" language="javascript" charset="utf-8">
//<![CDATA[
$(function(){
  topics_page_js.show_page();
    var bulletin_link = '<a href="http://download.csdn.net/detail/aa10531239/5231705" class="title_style_red title_style_bold" target="_blank">【免费】全新海外营销策论分享 </a>'
    $('#post-forum-bulletin-1').html(bulletin_link);
    var bulletin_link = '<a href="http://bbs.csdn.net/topics/390417639" class="title_style_blue title_style_bold" target="_blank">【限时优惠】第五届云计算大会社区门票抢购</a>'
    $('#post-forum-bulletin-2').html(bulletin_link);
    var bulletin_link = '<a href="http://blog.csdn.net/csdn_ask/article/details/8751993" class="title_style_blue title_style_bold" target="_blank">CSDN问答频道3月声望排行榜出炉</a>'
    $('#post-forum-bulletin-3').html(bulletin_link);
});
//]]>
</script>
<script type="text/javascript" src="http://ad.csdn.net/scripts/ad-bbs.js"></script>

  </body>
</html>

0


url:bbs.csdn.net/topics/1200
HTTP/1.1 200 OK
Content-Type: text/html; charset=utf-8
Transfer-Encoding: chunked
Connection: close
Vary: Accept-Encoding
Status: 200
X-Powered-By: Phusion Passenger (mod_rails/mod_rack)
ETag: "d22ea9c1e8960a570dcb5d17c8e4cf95"
Cache-Control: max-age=0, private, must-revalidate
Set-Cookie: _csdn_newbbs_session=BAh7B0kiD3Nlc3Npb25faWQGOgZFRkkiJWZmODgyNzQ3MWM2MzU4ZmNlZjI5OTQ4YmEyNGU2MWU1BjsAVEkiEF9jc3JmX3Rva2VuBjsARkkiMUl0NUMyamg3aVkvbzNPNW1aeWk5TXdXcklLcFJxUWp2bnhqZGxhdm1wejA9BjsARg%3D%3D--98f7001c2862cfb0735c4f17711714c3aae18b48; path=/; HttpOnly
Server: nginx/1.2.4 + Phusion Passenger (mod_rails/mod_rack)
X-UA-Compatible: IE=Edge,chrome=1

1e11
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>谁能给我一个PHP通过IAMP读/写信箱中信件的例子 - CSDN论坛 - CSDN.NET</title>
    <link href="/assets/main-c65d6b72001ff03e3698df226a4e4ffe.css" media="screen" rel="stylesheet" type="text/css" />
    <script src="/assets/application-e72cd54f9ebb368ac82561934f7b9c72.js" type="text/javascript"></script>
    <meta content="authenticity_token" name="csrf-param" />
<meta content="It5C2jh7iY/o3O5mZyi9MwWrIKpRqQjvnxjdlavmpz0=" name="csrf-token" />
    <link href="http://csdnimg.cn/www/images/favicon.ico" rel="SHORTCUT ICON">

      <link href="/assets/sh-2bfcf65754f6d04d58df6ed87a3b6faf.css" media="all" rel="stylesheet" type="text/css" />
  <script src="/assets/sh-d778121d099d6e5ed8bb7ce42824a371.js" type="text/javascript"></script>
  <script src="http://passport.csdn.net/content/loginbox/login.js" type="text/javascript"></script>

  </head>
  <body>
    <div class="wraper">
      <script type="text/javascript" src="http://csdnimg.cn/pubnav/js/pub_topnav_2011.js"></script>

        <!-- 页顶通栏 -->
  <iframe id="Topic_Top" marginwidth="0" marginheight="0" frameborder="0" scrolling="no" width="100%" src="/sda/TopicPageTop.htm"></iframe>

      <div id="nav">
        <a href="/" class="logo" target="_top"></a>
        <div class="nav_list">
          <a href="/home" title="CSDN论坛首页" class="home">首页</a><a href="/help" class=""><span>论坛帮助</span></a><a href="/rank" class=""><span>论坛牛人</span></a><a href="/map" class=""><span>论坛地图</span></a>
        </div>

        <div class="nav_sear">
          <form action="http://so.csdn.net/search" target="_blank">
            <input name="t" type="hidden" value="thread" />
            <input name="q" type="text" />
          </form>
        </div>
      </div>
      <!--[if IE]>
<style type="text/css" media="screen">
.control_area .control .drop_menu{border:3px solid #ccc \9; _*border:3px solid #ccc;}
</style>
<![endif]-->

  <!-- 页顶Button (D3) -->
  <iframe id="frm_tt1" marginwidth="0" marginheight="0" frameborder="0" scrolling="no" width="100%" src="/sda/TopicBodyTop.htm?v=1"></iframe>
  <script type="text/javascript">
    setTimeout(function () { document.getElementById("frm_tt1").src = "/sda/TopicBodyTop.htm?v="+new Date().getTime(); }, 5000);
  </script>

<div class="bread_nav">
  <a href="http://www.csdn.net" target="_blank">CSDN</a> <em>&gt;</em>
  <a href="/" target="_blank">CSDN论坛</a> <em>&gt;</em>
    <a href="/forums/PHP" target="_blank">PHP</a> <em>&gt;</em>
  <a href="/forums/PHPBase" target="_blank">基础编程</a>
</div>

<div class="flash_messages">
</div>


<div class="control_area">
  <form name="form" id="form">
    
    <div class="control">
      <ul>
        <li class="drop_menu_wrap drop_menu_down"><a href="#" class="drop_toggle btn_1"><span><img src="/assets/ico_set.gif" alt="" />管理菜单<img src="/assets/arrow_down.gif" alt="" /></span></a>
        <ul class="drop_menu" style="display: none; top:26px;">
            <li><a href="/topics/1200/top" class="fancybox" rel="nofollow">置顶</a></li>

  <li><a href="/topics/1200/unrecommend" data-confirm="确定要取消该帖推荐(精华)吗?取消该帖推荐，系统将回收奖励给帖主的88分!" data-method="put" rel="nofollow">取消推荐</a></li>

  <li><a href="/topics/1200/lock" class="fancybox" rel="nofollow">锁定</a></li>

<li><a href="/topics/1200/move" class="fancybox" rel="nofollow">移动</a></li>
<li><a href="/topics/1200/edit" class="fancybox" rel="nofollow">编辑</a></li>
<li><a href="/topics/1200/destroy_edit" class="fancybox" rel="nofollow">删除</a></li>
<li><a href="/topics/1200/add_point" class="fancybox" rel="nofollow">帖子加分</a></li>
  <li><a href="/topics/1200/highlight" class="fancybox" rel="nofollow">帖子高亮</a></li>

        </ul>
        </li>
        <li><a href="/topics/1200/close" class="btn_1" rel='nofollow'><span><img src="/assets/ico_over.gif" alt="" />结帖</span></a></li>
        <li><a href="/topics/new?forum_id=PHPBase" class="btn_1"><span><img src="/assets/ico_publish.gif" alt="" />发帖</span></a></li>
        <li><a href="#new_post" class="btn_1"><span><img src="/assets/ico_return.gif" alt="" />回复</span></a></li>
      </ul>
    </div>
  </form>
</div>
<div class="detail_title">
  <h1>
      <span class="red">
        [推荐]
      </span>
      谁能给我一个PHP通过IAMP读/写信箱中信件的例子
    <span>
      [问题点数：100分，结帖人radish]
    </span>
  </h1>
  <div class="fr">
    <select name="filter_posts">
      <option value="default">不显示删除回复</option>
      <option value="all">显示所有回复</option>
      <option value="star">显示星级回复</option>
      <option value="pointed">显示得分回复</option>
      <option value="lz">只显示楼主</option>
    </select>
    <a href="http://my.csdn.net/my/favorite/miniadd?u=http://bbs.csdn.net/topics/1200&amp;t=%E8%B0%81%E8%83%BD%E7%BB%99%E6%88%91%E4%B8%80%E4%B8%AAPHP%E9%80%9A%E8%BF%87IAMP%E8%AF%BB/%E5%86%99%E4%BF%A1%E7%AE%B1%E4%B8%AD%E4%BF%A1%E4%BB%B6%E7%9A%84%E4%BE%8B%E5%AD%90" id="fav" class="fav" rel='nofollow'><img src="/assets/nolines_plus.gif" alt="" />收藏</a>
  </div>
</div>
<div class="detailed">
    <table border="0" cellspacing="0" cellpadding="0" id="post-1200" class="post topic " data-post-id="1200" data-is-topic-locked="false">
  <colgroup><col width="180" /><col /></colgroup>
  <tr>
      <td rowspan="2" valign="top" class="wirter">
                <dl class="user_info ">
          <dt class="user_head" data-username="radish">
            <a href="http://my.csdn.net/radish" target="_blank"><img alt="radish" class="avatar" src="http://avatar.profile.csdn.net/E/1/3/1_radish.jpg" /></a>
          </dt>
          <dd class="username">
            <a href="http://my.csdn.net/radish" target="_blank">radish</a>
            
          </dd>
          <dd class="nickname">
            <span class="name2nick">radish</span>
          </dd>
          <dd title="总技术分：209；总技术排名：80775">等级：<img alt="Blank" class="grade user1" src="/assets/blank.gif" /></dd>
          <dd class="close_rate" title="用户结帖率：100%
总发帖：68
正常结帖：68
未结帖：0">结帖率：100%</dd>
          
        </dl>

      </td>
      <td valign="top" class="post_info topic pointed" data-username="radish" data-floor="">
                <div class="data">
            <strong class="fr">
              楼主
            </strong>
          <span class="time">
              发表于：
            2000-02-01 13:00:00
          </span>
        </div>
        <div class="post_body">
            
              <div class="tag ">
              </div>
        </div>
          <!-- 主帖下Banner (D4) -->
          <!-- 主帖下文字 (D5) -->
          <iframe id="tad2" marginwidth="0" marginheight="0" frameborder="0" scrolling="no" width="100%" src="/sda/TopicBodyBottom.htm"></iframe>

      </td>
    </tr>
    <tr>
      <td valign="bottom">
          <div class="control">
  <div class="fr">
    <a href="/posts/1200/digg?topic_id=1200" class="red digg" data-method="put" data-remote="true" rel="nofollow">对我有用[0]</a>
    <a href="/posts/1200/bury?topic_id=1200" class="bury" data-method="put" data-remote="true" rel="nofollow">丢个板砖[0]</a>
    <a href="#quote" class="quote">引用</a> |
    <a href="/posts/1200/report?topic_id=1200" class="fancybox red" rel="nofoll
2000
ow">举报 </a> |
    <span class="manage-toggle">
      <div class="manage" style="display: none;">
          <a href="/topics/1200/edit" class="fancybox" rel="nofollow">编辑</a>
          <a href="/topics/1200/destroy_edit" class="fancybox" rel="nofollow">删除</a>
      </div>
      管理
    </span>
  </div>
    <span class="return_time">回复次数：3</span>
</div>

      </td>
  </tr>
</table>

  <table border="0" cellspacing="0" cellpadding="0" id="post-494022" class="post  " data-post-id="494022" data-is-topic-locked="false">
  <colgroup><col width="180" /><col /></colgroup>
  <tr>
      <td rowspan="2" valign="top" class="wirter">
                <dl class="user_info ">
          <dt class="user_head" data-username="DOU">
            <a href="http://my.csdn.net/DOU" target="_blank"><img alt="DOU" class="avatar" src="http://avatar.profile.csdn.net/7/D/B/1_dou.jpg" /></a>
          </dt>
          <dd class="username">
            <a href="http://my.csdn.net/DOU" target="_blank">DOU</a>
            
          </dd>
          <dd class="nickname">
            <span class="name2nick">DOU</span>
          </dd>
          <dd title="总技术分：3917；总技术排名：7472">等级：<img alt="Blank" class="grade user1" src="/assets/blank.gif" /></dd>
          <dd class="close_rate" title="用户结帖率：100%
总发帖：2
正常结帖：2
未结帖：0">结帖率：100%</dd>
          <div class="medal_gold " title="2000年2月 总版技术专家分月排行榜第一"></div><div class="medal_red count" title="2000年2月 VC/MFC大版内专家分月排行榜第一
2000年2月 MS-SQL Server大版内专家分月排行榜第一"><div class="medal_count">2</div></div>
        </dl>

      </td>
      <td valign="top" class="post_info " data-username="DOU" data-floor="1">
                <div class="data">
            <span class="fr">
              <a href="#post-494022">#1</a>
              得分：0
            </span>
          <span class="time">
              回复于：
            2000-02-02 11:28:00
          </span>
        </div>
        <div class="post_body">
            转载<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMAP&nbsp;Mail&nbsp;Reading&nbsp;With&nbsp;PHP3<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Mark&nbsp;Musone&nbsp;<br />
<br />
Don't&nbsp;you&nbsp;hate&nbsp;it&nbsp;when&nbsp;you&nbsp;are&nbsp;at&nbsp;a&nbsp;friend's&nbsp;house&nbsp;or&nbsp;visiting&nbsp;relatives&nbsp;and&nbsp;you&nbsp;want&nbsp;to&nbsp;check&nbsp;your&nbsp;email&nbsp;but&nbsp;dont&nbsp;know&nbsp;your&nbsp;POP/IMAP&nbsp;settings.&nbsp;Or&nbsp;even&nbsp;worse,&nbsp;they&nbsp;dont&nbsp;have&nbsp;your&nbsp;POP&nbsp;or&nbsp;IMAP&nbsp;software?&nbsp;<br />
<br />
Web&nbsp;based&nbsp;email&nbsp;seems&nbsp;to&nbsp;be&nbsp;the&nbsp;talk&nbsp;of&nbsp;the&nbsp;Net&nbsp;lately.&nbsp;Heres&nbsp;how&nbsp;to&nbsp;use&nbsp;PHP&nbsp;to&nbsp;make&nbsp;a&nbsp;quick,&nbsp;simple&nbsp;and&nbsp;effective&nbsp;IMAP&nbsp;or&nbsp;POP&nbsp;mail&nbsp;reader.&nbsp;Once&nbsp;this&nbsp;is&nbsp;done,&nbsp;you&nbsp;can&nbsp;now&nbsp;be&nbsp;able&nbsp;to&nbsp;read&nbsp;your&nbsp;email&nbsp;from&nbsp;anywhere&nbsp;in&nbsp;the&nbsp;world&nbsp;with&nbsp;only&nbsp;a&nbsp;web&nbsp;browser.&nbsp;<br />
<br />
The&nbsp;first&nbsp;necessity&nbsp;is&nbsp;to&nbsp;make&nbsp;sure&nbsp;that&nbsp;you&nbsp;have&nbsp;an&nbsp;available&nbsp;IMAP&nbsp;server.&nbsp;you&nbsp;can&nbsp;get&nbsp;the&nbsp;UW&nbsp;imap&nbsp;server&nbsp;and&nbsp;libraries&nbsp;from&nbsp;ftp://ftp.cac.washington.edu/imap/&nbsp;(you&nbsp;will&nbsp;need&nbsp;the&nbsp;libraries&nbsp;to&nbsp;compile&nbsp;into&nbsp;php&nbsp;anyway,&nbsp;so&nbsp;you&nbsp;might&nbsp;as&nbsp;well&nbsp;install&nbsp;the&nbsp;IMAP&nbsp;server&nbsp;that&nbsp;comes&nbsp;with&nbsp;it&nbsp;also)&nbsp;<br />
<br />
Once&nbsp;you&nbsp;have&nbsp;a&nbsp;running&nbsp;IMAP&nbsp;server&nbsp;and&nbsp;PHP&nbsp;compiled&nbsp;with&nbsp;IMAP&nbsp;support&nbsp;(make&nbsp;sure&nbsp;you&nbsp;read&nbsp;the&nbsp;PHP&nbsp;docs&nbsp;on&nbsp;how&nbsp;to&nbsp;compile&nbsp;PHP&nbsp;with&nbsp;imap),&nbsp;the&nbsp;rest&nbsp;is&nbsp;easy!&nbsp;<br />
<br />
We'll&nbsp;make&nbsp;a&nbsp;nice&nbsp;and&nbsp;simple&nbsp;3-script&nbsp;based&nbsp;mail&nbsp;reader.&nbsp;<br />
<br />
The&nbsp;first&nbsp;script&nbsp;will&nbsp;be&nbsp;to&nbsp;read&nbsp;in&nbsp;your&nbsp;IMAP&nbsp;username&nbsp;and&nbsp;password.&nbsp;We&nbsp;will&nbsp;use&nbsp;the&nbsp;standard&nbsp;PHP&nbsp;authentication&nbsp;for&nbsp;that.&nbsp;<br />
<br />
login.php3&nbsp;contains:&nbsp;<br />
<br />
&lt;?php&nbsp;<br />
<br />
if&nbsp;(!$PHP_AUTH_USER)&nbsp;{&nbsp;<br />
&nbsp;&nbsp;&nbsp;&nbsp;Header(&nbsp;"WWW-authenticate:&nbsp;basic&nbsp;realm=\"Mail&nbsp;Chek\"");&nbsp;<br />
&nbsp;&nbsp;&nbsp;&nbsp;Header(&nbsp;"HTTP/1.0&nbsp;401&nbsp;Unauthorized");&nbsp;<br />
}&nbsp;else&nbsp;{&nbsp;<br />
&nbsp;&nbsp;&nbsp;&nbsp;$MYDIR=ereg_replace(&nbsp;"/[^/]+$",&nbsp;"",$PHP_SELF);&nbsp;<br />
&nbsp;&nbsp;&nbsp;&nbsp;Header(&nbsp;"Location:&nbsp;$SERVER_NAME$MYDIR/messages.php3");&nbsp;<br />
}&nbsp;<br />
<br />
?&gt;<br />
<br />
This&nbsp;simply&nbsp;reads&nbsp;in&nbsp;your&nbsp;username&nbsp;and&nbsp;password&nbsp;and&nbsp;redirects&nbsp;you&nbsp;to&nbsp;the&nbsp;read&nbsp;mail&nbsp;reading&nbsp;page.&nbsp;<br />
<br />
messages.php3&nbsp;contains:&nbsp;<br />
<br />
&lt;?php&nbsp;<br />
<br />
$MAILSERVER=&nbsp;"{localhost/imap}";&nbsp;<br />
$link=imap_open($MAILSERVER,$PHP_AUTH_USER,$PHP_AUTH_PW);&nbsp;<br />
$headers=imap_headers($link);&nbsp;<br />
<br />
for($x=1;&nbsp;$x&nbsp;&lt;&nbsp;count($headers);&nbsp;$x++)&nbsp;{&nbsp;<br />
&nbsp;&nbsp;&nbsp;&nbsp;$idx=($x-1);&nbsp;<br />
&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;&nbsp;"&lt;a&nbsp;href=\"view.php3?num=$x\"&gt;$headers[$idx]&lt;/a&gt;&lt;br&gt;";&nbsp;<br />
}&nbsp;<br />
<br />
?&gt;<br />
<br />
It&nbsp;opens&nbsp;up&nbsp;an&nbsp;IMAP&nbsp;connection&nbsp;to&nbsp;the&nbsp;mailserver&nbsp;specified&nbsp;by&nbsp;$MAILSERVER,&nbsp;passing&nbsp;in&nbsp;your&nbsp;username&nbsp;and&nbsp;password.&nbsp;<br />
<br />
It&nbsp;then&nbsp;get&nbsp;a&nbsp;list&nbsp;of&nbsp;all&nbsp;the&nbsp;messgae&nbsp;headers&nbsp;and&nbsp;in&nbsp;a&nbsp;loop,&nbsp;prints&nbsp;them&nbsp;all&nbsp;out.&nbsp;Besides&nbsp;printing&nbsp;them&nbsp;out,&nbsp;it&nbsp;also&nbsp;makes&nbsp;each&nbsp;one&nbsp;a&nbsp;link&nbsp;to&nbsp;view.php3,&nbsp;passing&nbsp;it&nbsp;that&nbsp;message&nbsp;number.&nbsp;<br />
<br />
view.php3&nbsp;contains:&nbsp;<br />
<br />
&lt;?php&nbsp;<br />
<br />
$MAILSERVER=&nbsp;"{localhost/imap}";&nbsp;<br />
$link=imap_open($MAILSERVER,$PHP_AUTH_USER,$PHP_AUTH_PW);&nbsp;<br />
$header=imap_header($link,$num);&nbsp;<br />
<br />
echo&nbsp;&nbsp;"From:&nbsp;$header[fromaddress]&lt;br&gt;";&nbsp;<br />
echo&nbsp;&nbsp;"To:&nbsp;$header[toaddress]&lt;br&gt;";&nbsp;<br />
echo&nbsp;&nbsp;"Date:&nbsp;$header[Date]&lt;br&gt;";&nbsp;<br />
echo&nbsp;&nbsp;"Subject:&nbsp;$header[Subject]&lt;br&gt;&lt;br&gt;";&nbsp;<br />
echo&nbsp;imap_body($link,$num);&nbsp;<br />
<br />
?&gt;<br />
<br />
view.php3&nbsp;opens&nbsp;up&nbsp;the&nbsp;IMAP&nbsp;connection&nbsp;the&nbsp;same&nbsp;as&nbsp;above,&nbsp;and&nbsp;gets&nbsp;the&nbsp;mail&nbsp;message's&nbsp;header&nbsp;information&nbsp;and&nbsp;prints&nbsp;it&nbsp;out.&nbsp;<br />
<br />
It&nbsp;then&nbsp;reads&nbsp;in&nbsp;the&nbsp;body&nbsp;of&nbsp;the&nbsp;mail&nbsp;message&nbsp;and&nbsp;prints&nbsp;that&nbsp;out&nbsp;to&nbsp;the&nbsp;screen.&nbsp;<br />
<br />
Thats&nbsp;it!&nbsp;You&nbsp;now&nbsp;have&nbsp;a&nbsp;functional&nbsp;web&nbsp;based&nbsp;mail&nbsp;reader...Hotmail&nbsp;watch&nbsp;out,&nbsp;here&nbsp;comes&nbsp;php!&nbsp;;^)&nbsp;<br />

        </div>

      </td>
    </tr>
    <tr>
      <td valign="bottom">
          <div class="control">
    <div id='post-forum-bulletin-1'  class='fl'>
    </div>
  <div class="fr">
    <a href="/posts/494022/digg?topic_id=1200" class="red digg" data-method="put" data-remote="true" rel="nofollow">对我有用[
2000
0]</a>
    <a href="/posts/494022/bury?topic_id=1200" class="bury" data-method="put" data-remote="true" rel="nofollow">丢个板砖[0]</a>
    <a href="#quote" class="quote">引用</a> |
    <a href="/posts/494022/report?topic_id=1200" class="fancybox red" rel="nofollow">举报 </a> |
    <span class="manage-toggle">
      <div class="manage" style="display: none;">
          <a href="/posts/494022/edit" class="fancybox" rel="nofollow">编辑</a>
          <a href="/posts/494022/destroy_edit" class="fancybox" rel="nofollow">删除</a>
      </div>
      管理
    </span>
  </div>
</div>

      </td>
  </tr>
</table>
<table border="0" cellspacing="0" cellpadding="0" id="post-494042" class="post  " data-post-id="494042" data-is-topic-locked="false">
  <colgroup><col width="180" /><col /></colgroup>
  <tr>
      <td rowspan="2" valign="top" class="wirter">
                <dl class="user_info ">
          <dt class="user_head" data-username="radish">
            <a href="http://my.csdn.net/radish" target="_blank"><img alt="radish" class="avatar" src="http://avatar.profile.csdn.net/E/1/3/1_radish.jpg" /></a>
          </dt>
          <dd class="username">
            <a href="http://my.csdn.net/radish" target="_blank">radish</a>
            
          </dd>
          <dd class="nickname">
            <span class="name2nick">radish</span>
          </dd>
          <dd title="总技术分：209；总技术排名：80775">等级：<img alt="Blank" class="grade user1" src="/assets/blank.gif" /></dd>
          <dd class="close_rate" title="用户结帖率：100%
总发帖：68
正常结帖：68
未结帖：0">结帖率：100%</dd>
          
        </dl>

      </td>
      <td valign="top" class="post_info " data-username="radish" data-floor="2">
                <div class="data">
            <span class="fr">
              <a href="#post-494042">#2</a>
              得分：0
            </span>
          <span class="time">
              回复于：
            2000-02-02 13:50:00
          </span>
        </div>
        <div class="post_body">
            谢谢了，不过此方法不能读带附件的EMAIL，您能再试试吗
        </div>

      </td>
    </tr>
    <tr>
      <td valign="bottom">
          <div class="control">
    <div id='post-forum-bulletin-2'  class='fl'>
    </div>
  <div class="fr">
    <a href="/posts/494042/digg?topic_id=1200" class="red digg" data-method="put" data-remote="true" rel="nofollow">对我有用[0]</a>
    <a href="/posts/494042/bury?topic_id=1200" class="bury" data-method="put" data-remote="true" rel="nofollow">丢个板砖[0]</a>
    <a href="#quote" class="quote">引用</a> |
    <a href="/posts/494042/report?topic_id=1200" class="fancybox red" rel="nofollow">举报 </a> |
    <span class="manage-toggle">
      <div class="manage" style="display: none;">
          <a href="/posts/494042/edit" class="fancybox" rel="nofollow">编辑</a>
          <a href="/posts/494042/destroy_edit" class="fancybox" rel="nofollow">删除</a>
      </div>
      管理
    </span>
  </div>
</div>

      </td>
  </tr>
</table>
<table border="0" cellspacing="0" cellpadding="0" id="post-494060" class="post  " data-post-id="494060" data-is-topic-locked="false">
  <colgroup><col width="180" /><col /></colgroup>
  <tr>
      <td rowspan="2" valign="top" class="wirter">
                <dl class="user_info ">
          <dt class="user_head" data-username="DOU">
            <a href="http://my.csdn.net/DOU" target="_blank"><img alt="DOU" class="avatar" src="http://avatar.profile.csdn.net/7/D/B/1_dou.jpg" /></a>
          </dt>
          <dd class="username">
            <a href="http://my.csdn.net/DOU" target="_blank">DOU</a>
            
          </dd>
          <dd class="nickname">
            <span class="name2nick">DOU</span>
          </dd>
          <dd title="总技术分：3917；总技术排名：7472">等级：<img alt="Blank" class="grade user1" src="/assets/blank.gif" /></dd>
          <dd class="close_rate" title="用户结帖率：100%
总发帖：2
正常结帖：2
未结帖：0">结帖率：100%</dd>
          <div class="medal_gold " title="2000年2月 总版技术专家分月排行榜第一"></div><div class="medal_red count" title="2000年2月 VC/MFC大版内专家分月排行榜第一
2000年2月 MS-SQL Server大版内专家分月排行榜第一"><div class="medal_count">2</div></div>
        </dl>

      </td>
      <td valign="top" class="post_info pointed" data-username="DOU" data-floor="3">
                <div class="data">
            <span class="fr">
              <a href="#post-494060">#3</a>
              得分：100
            </span>
          <span class="time">
              回复于：
            2000-02-02 15:00:00
          </span>
        </div>
        <div class="post_body">
            http://web.horde.org/上有一个IMAP&nbsp;webmail&nbsp;client,它遵从GPL.&nbsp;你可下载代码研究<br />
我学习PHP时间不长，这个应用我也没研究过，以后还要多向你请教！<br />

        </div>

      </td>
    </tr>
    <tr>
      <td valign="bottom">
          <div class="control">
    <div id='post-forum-bulletin-3'  class='fl'>
    </div>
  <div class="fr">
    <a href="/posts/494060/digg?topic_id=1200" class="red digg" data-method="put" data-remote="true" rel="nofollow">对我有用[0]</a>
    <a href="/posts/494060/bury?topic_id=1200" class="bury" data-method="put" data-remote="true" rel="nofollow">丢个板砖[0]</a>
    <a href="#quote" class="quote">引用</a> |
    <a href="/posts/494060/report?topic_id=1200" class="fancybox red" rel="nofollow">举报 </a> |
    <span class="manage-toggle">
      <div class="manage" style="display: none;">
          <a href="/posts/494060/edit" class="fancybox" rel="nofollow">编辑</a>
          <a href="/posts/494060/destroy_edit" class="fancybox" rel="nofollow">删除</a>
      </div>
      管理
    </span>
  </div>
</div>

      </td>
  </tr>
</table>

</div>
<div class="control_area">
  <form name="form" id="form">
    
    <div class="control">
      <ul>
        <li class="drop_menu_wrap drop_menu_up"><a href="#" class="drop_toggle drop_toggle_up btn_1"><span><img src="/assets/ico_set.gif" alt="" />管理菜单<img src="/assets/arrow_down.gif" alt="" /></span></a>
        <ul class="drop_menu" style="display: none; bottom:26px;">
            <li><a href="/topics/1200/top" class="fancybox" rel="nofollow">置顶</a></li>

  <li><a href="/topics/1200/unrecommend" data-confirm="确定要取消该帖推荐(精华)吗?取消该帖推荐，系统将回收奖励给帖主的88分!" data-method="put" rel="nofollow">取消推荐</a></li>

  <li><a href="/topics/1200/lock" class="fancybox" rel="nofollow">锁定</a></li>

<li><a href="/topics/1200/move" class="fancybox" rel="nofollow">移动</a></li>
<li><a href="/topics/1200/edit" class="fancybox" rel="nofollow">编辑</a></li>
<li><a href="/topics/1200/destroy_edit" class="fancybox" rel="nofollow">删除</a></li>
<li><a href="/topics/1200/add_point" class="fancybox" rel="nofollow">帖子加分</a></li>
  <li><a href="/topics/1200/highlight" class="fancybox" rel="nofollow">帖子高亮</a></li>

        </ul>
        </li>
        <li><a href="/topics/1200/close" class="btn_1"><span><img src="/assets/ico_over.gif" alt="" />结帖</span></a></li>
        <li><a href="/topics/new?forum_id=PHPBase" class="btn_1"><span><img src="/assets/ico_publish.gif" alt="" />发帖</span></a></li>
        <li><a href="#new_post" class="btn_1"><span><img src="/assets/ico_return.gif" alt="" />回复</span></a></li>
      </ul>
    </div>
  </form>
</div>

<div class="comt">
  <div class="ad_l">
    <!-- 回复框文字 (D6) -->
    <ul><li><a href="http://g.csdn.net/5243760" target="_blank">【招】应届生,入职年薪5-10万</a></li><li><a href="http://g.csdn.net/5246043" target="_blank">市面上最出色的刀片式服务器</a></li><li><a href="http://g.csdn.net/5245460" target="_blank">IBM 以高效设计为灵魂</a></li><li><a href="http://g.csdn.net/5239181" target="_blank">首届携程大赛开始报名啦</a></li></ul>
    <ul>
        <li><a href="http://club.csdn.net/cmdn/bbs/to
c32
pic/7282" class="title_style_black" target="_blank">台湾程序员游戏开发经历</a></li>
        <li><a href="http://g.csdn.net/5243630" class="title_style_black" target="_blank">陈勇- 敏捷开发现状及发展之路</a></li>
        <li><a href="http://bbs.csdn.net/topics/390399592" class="title_style_black" target="_blank">分享你的发现 赢下载积分</a></li>
    </ul>
    <div class="ad_new" style='padding: 0 0 50px 0'>
      <h4><img alt="" src="http://csdnimg.cn/www/images/csdn_logo_blue.gif"></h4>
      <p class='title'>
      <a href="http://bbs.csdn.net/topics/390397080" target="_blank">微软MVP申请</a>
      </p>
      <p class='con'>
      <a href="http://bbs.csdn.net/topics/390397080" target="_blank">CSDN与微软合作，长期为用户提供申请“微软最有价值专家”的平台，希望大家积极参与。</a>
      </p>
    </div>
  </div>
  <div class="reply">
      <h3>本帖子已过去太久远了，不再提供回复功能。</h3>
  </div>
</div>



<!-- 对联广告 -->
<div id="ad_left" style="position:absolute;width:120px;top:184px;left:10px;display:none">
  <a style="float:right;" href="#" onclick="javascript:this.parentNode.style.display='none';return false;">[关闭]</a>
  <iframe src="/sda/TopicDaLeft.htm?v201203051313" frameborder="0" height="600" width="120" scrolling="no"></iframe>
</div>
<div id="ad_right" style="position:absolute;width:120px;top:184px;right:10px;display:none">
  <a style="float:left;" href="#" onclick="javascript:this.parentNode.style.display='none';return false;">[关闭]</a>
  <iframe src="/sda/TopicDaRight.htm?v201203051313" frameborder="0" height="600" width="120" scrolling="no"></iframe>
</div>



      <script type="text/javascript" src="http://csdnimg.cn/pubfooter/js/publib_footer.js"></script>
<script type="text/javascript" src="http://www.csdn.net/ui/scripts/Csdn/counter.js"></script>
<script type="text/javascript" src="http://csdnimg.cn/pig/pubjs/cnick.js"></script>

      <img alt="Top_arrow" class="top_arrow" id="top_arrow" src="http://news.csdn.net//images/top_arrow.png" />
    </div>
    <script type="text/javascript" language="javascript" charset="utf-8">
//<![CDATA[
$(function(){
  topics_page_js.show_page();
    var bulletin_link = '<a href="http://blog.csdn.net/csdn_ask/article/details/8751993" class="title_style_blue title_style_bold" target="_blank">CSDN问答频道3月声望排行榜出炉</a>'
    $('#post-forum-bulletin-1').html(bulletin_link);
    var bulletin_link = '<a href="http://download.csdn.net/detail/aa10531239/5231705" class="title_style_red title_style_bold" target="_blank">【免费】全新海外营销策论分享 </a>'
    $('#post-forum-bulletin-2').html(bulletin_link);
    var bulletin_link = '<a href="http://blog.csdn.net/blogdevteam/article/details/8770910" class="title_style_red title_style_bold" target="_blank">Java应用级产品开发平台APDPlat作者杨尚川专访</a>'
    $('#post-forum-bulletin-3').html(bulletin_link);
});
//]]>
</script>
<script type="text/javascript" src="http://ad.csdn.net/scripts/ad-bbs.js"></script>

  </body>
</html>

0

